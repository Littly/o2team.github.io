<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title><![CDATA[Aotu.io]]></title>
  <subtitle><![CDATA[凹凸实验室]]></subtitle>
  <link href="/atom.xml" rel="self"/>
  <link href="http://aotu.io/"/>
  <updated>2015-12-24T09:51:19.000Z</updated>
  <id>http://aotu.io/</id>
  
  <author>
    <name><![CDATA[凹凸实验室]]></name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title><![CDATA[【译】使用Node.js创建命令行脚本工具]]></title>
    <link href="http://aotu.io/notes/2015/12/23/building-command-line-tools-with-node-js/"/>
    <id>http://aotu.io/notes/2015/12/23/building-command-line-tools-with-node-js/</id>
    <published>2015-12-23T13:19:07.000Z</published>
    <updated>2015-12-24T09:51:19.000Z</updated>
    <content type="html"><![CDATA[<blockquote>
<p>本文译自 <a href="https://developer.atlassian.com/blog/2015/11/scripting-with-node/" target="_blank" rel="external">Building command line tools with Node.js</a>，介绍了如何通过Node.js来创建命令行脚本工具，介绍了很多实用的<code>npm</code>包等。翻译水平有限，敬请指正~</p>
</blockquote>
<a id="more"></a>
<p>在我的职业生涯中已经写过了上百个 <code>Bash</code> 脚本，但我的 <code>Bash</code> 依然写得很糟糕，每一次我都不得不去查一些简单逻辑结构的语法。如果我想通过 <code>curl</code> 或者 <code>sed</code> 来做一些事情，我也必须去查找 <code>man</code> 文档。</p>
<p>然后，有一天，我看到六个字母的语言[译者注：这里指NodeJS] — 一门在过去十年里我几乎 <em>每一天</em> 都在使用的语言，这才让我幡然醒悟。结果是你可以使用 <code>JavaScript</code> 来写脚本！</p>
<p>在这篇教程中，我将会在使用 <code>Node.js</code> 和 <code>npm</code> 创建一个脚本或者命令行工具方面给你一些我的想法。特别地我们将会包括以下内容：</p>
<ul>
<li>使用 <code>npm</code> 封装一个新的 <code>shell</code> 命令</li>
<li>解析命令行参数</li>
<li>从输入流中读取文本和密码</li>
<li>发送 snippet</li>
<li>输出错误与代码</li>
<li>终端输出彩色化</li>
<li>渲染 <code>ACSII</code> 进度条</li>
</ul>
<p>我热衷于已经可以工作的例子，所以为了解释这些概念我们将会创建一个新的 <code>shell</code> 命令，它的名字为 <code>snippet</code> ，可以在我们本地磁盘的文件创建一个 <a href="https://confluence.atlassian.com/bitbucket/snippets-719095082.html" target="_blank" rel="external">Bitbucket Snippet</a>。</p>
<p>这是我们的最终目标成果：</p>
<p class="user_img"><img title="snippet用法" class="test_img" src="/img/post/cnt1992/snippet-usage.gif" alt="snippet用法"></p>
<h2 id="封装_shell_命令">封装 shell 命令</h2><p><code>npm</code> 不单单用来管理你的应用和网页的依赖，你还能用它来封装和分发新的 <code>shell</code> 命令。</p>
<p>第一步就是通过 <code>npm init</code> [译者注：可以通过 <code>npm init -f</code>直接快速生成一个<code>package.json</code>]来创建一个新的 <code>npm</code> 项目：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ npm init</span><br><span class="line">name: bitbucket-snippet</span><br><span class="line">version: <span class="number">0.0</span>.<span class="number">1</span></span><br><span class="line">description: A <span class="built_in">command</span>-line tool <span class="keyword">for</span> creating Bitbucket snippets.</span><br><span class="line">entry point: index.js</span><br><span class="line">license: Apache-<span class="number">2.0</span></span><br></pre></td></tr></table></figure>
<p>这会在我们的项目中创建一个新的 <code>package.json</code> 文件，那时我们将需要创建一个 <code>JS</code> 文件包含我们的脚本。让我们根据Node.js的传统命名为 <code>index.js</code>。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env node</span><br><span class="line">console.log('Hello, world!');</span><br></pre></td></tr></table></figure>
<p>注意我们必须加一些 <code>东西</code> 来告诉我们的 <code>shell</code> 如何处理我们的脚本。</p>
<p>接下来我们需要在我们 <code>package.json</code> 里面的最顶级增加 <code>bin</code> 部分。设置的属性（在我们的例子中是 <code>snippet</code>）将会变成用户在他们的终端处理脚本使用的命令，属性值就是相对于 <code>package.json</code> 的脚本位置。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">  "author": "Tim Pettersen",</span><br><span class="line">  "license": "Apache-2.0",</span><br><span class="line">  "bin": &#123;</span><br><span class="line">    "snippet": "./index.js"</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>现在我们已经有一个可以工作的 <code>shell</code> 命令了！让我们安装它并且测试结果。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ npm install -g</span><br><span class="line">$ snippet</span><br><span class="line">Hello, world!</span><br></pre></td></tr></table></figure>
<p>真整洁！ <code>npm install -g</code> 实际上是将我们脚本链接到 <code>path</code> 变量的位置，所以我们能够在任何地方使用它。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">which</span> snippet</span><br><span class="line">/usr/<span class="built_in">local</span>/bin/snippet</span><br><span class="line">$ readlink /usr/<span class="built_in">local</span>/bin/snippet</span><br><span class="line">../lib/node_modules/bitbucket-snippet/index.js</span><br></pre></td></tr></table></figure>
<p>在开发环境中我们实际上使用 <code>npm link</code> 便利地将我们的 <code>index.js</code> 软链接到 <code>path</code> 变量的位置。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ npm link</span><br><span class="line">/usr/<span class="built_in">local</span>/bin/snippet -&gt; /usr/<span class="built_in">local</span>/lib/node_modules/bitbucket-snippet/index.js</span><br><span class="line">/usr/<span class="built_in">local</span>/lib/node_modules/bitbucket-snippet -&gt; /Users/kannonboy/src/bitbucket-snippet</span><br></pre></td></tr></table></figure>
<p>当我们开发完成的时候，我们可以通过 <code>npm publish</code> 将我们的脚本发布到公共 <code>npm</code> 仓库，然后任何人都可以下载安装到他们的机器上：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install -g bitbucket-snippet</span><br></pre></td></tr></table></figure>
<p>但是让我们先让我们的脚本能够工作先！</p>
<h2 id="解析命令行参数">解析命令行参数</h2><p>我们的脚本现在需要一些用户的输入：他们的Bitbucket名字，他们的密码，还有作为 <code>snippet</code>上传的文件位置。典型的方法就是通过命令的参数传输这些值。</p>
<p>你可以通过 <code>process.argv</code> 拿到序列化的参数，但有很多 <code>npm</code> 包在解析参数还有选项方面提供了很好的抽象给你。我最喜欢的就是 <a href="https://www.npmjs.com/package/commander" target="_blank" rel="external">commander</a>，来自 <code>Ruby gem</code>同一个名字的灵感。</p>
<p>一个简单的命令安装它：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install --save commander</span><br></pre></td></tr></table></figure>
<p>上面命令将会把最新版的 <code>commander</code> 加入 <code>package.json</code>。我们这时可以通过简单声明式的方式定义我们的选项：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env node</span><br><span class="line">- console.log('Hello, world!');</span><br><span class="line">+ var program = require('commander');</span><br><span class="line">+</span><br><span class="line">+ program</span><br><span class="line">+  .arguments('&lt;file&gt;')</span><br><span class="line">+  .option('-u, --username &lt;username&gt;', 'The user to authenticate as')</span><br><span class="line">+  .option('-p, --password &lt;password&gt;', 'The user\'s password')</span><br><span class="line">+  .action(function(file) &#123;</span><br><span class="line">+    console.log('user: %s pass: %s file: %s',</span><br><span class="line">+        program.username, program.password, file);</span><br><span class="line">+  &#125;)</span><br><span class="line">+  .parse(process.argv);</span><br></pre></td></tr></table></figure>
<p>上面代码可读性很强。事实上，这是一个保守的说法。相对于那些我们需要通过 <code>switch</code> 来控制的像 <code>Bash</code>，这是一个艺术品。至少，我写的 <code>Bash</code> 是这样子的。</p>
<p>让我们快速测试：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ snippet -u kannonboy -p correcthorsebatterystaple file</span><br><span class="line">user: kannonboy pass: correcthorsebatterystaple file: file</span><br></pre></td></tr></table></figure>
<p>很棒！<code>commander</code> 还提供一些简单的帮助输出给我们，基于我们上面提供的配置。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ snippet --help</span><br><span class="line"></span><br><span class="line">  Usage: snippet [options] &lt;file&gt;</span><br><span class="line"></span><br><span class="line">  Options:</span><br><span class="line"></span><br><span class="line">    -h, --help                 output usage information</span><br><span class="line">    -u, --username &lt;username&gt;  The user to authenticate as</span><br><span class="line">    -p, --password &lt;password&gt;  The user<span class="string">'s password</span></span><br></pre></td></tr></table></figure>
<p>所以我们已经拿到了参数了。但是，让用户在空白的地方输入他们的密码作为选项有一点难用。让我们解决它。</p>
<h2 id="从输入流中读取文本和密码">从输入流中读取文本和密码</h2><p>另一种通用的取回用户的内容的脚本方式是从标准输入流中读。这可以通过 <code>process.stdin</code> 实现，但是再说一次，已经有很多 <code>npm</code> 包提供了非常好的 API 给我们使用。很多都是基于 <code>callback</code> 或者 <code>promises</code>，但是我们将使用 <a href="https://www.npmjs.com/package/co-prompt" target="_blank" rel="external">co-prompt</a> （基于 <a href="https://www.npmjs.com/package/co" target="_blank" rel="external">co</a>），因此我们可以利用 ES6 的 <code>yield</code> 关键词。这让我们写异步的代码而不需要 <code>callbacks</code> ，看起来更加脚本化。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install --save co co-prompt</span><br></pre></td></tr></table></figure>
<p>为了组合使用 <code>yield</code> 和 <code>co-prompt</code> ，我们需要通过一些 <code>co</code> 的魔法来包裹我们的代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">+ <span class="keyword">var</span> co = <span class="built_in">require</span>(<span class="string">'co'</span>);</span><br><span class="line">+ <span class="keyword">var</span> prompt = <span class="built_in">require</span>(<span class="string">'co-prompt'</span>);</span><br><span class="line">  <span class="keyword">var</span> program = <span class="built_in">require</span>(<span class="string">'commander'</span>);</span><br><span class="line">...</span><br><span class="line">  .option(<span class="string">'-u, --username &lt;username&gt;'</span>, <span class="string">'The user to authenticate as'</span>)</span><br><span class="line">  .option(<span class="string">'-p, --password &lt;password&gt;'</span>, <span class="string">'The user\'s password'</span>)</span><br><span class="line">  .action(<span class="function"><span class="keyword">function</span>(<span class="params">file</span>) </span>&#123;</span><br><span class="line">+    co(<span class="function"><span class="keyword">function</span> *(<span class="params"></span>) </span>&#123;</span><br><span class="line">+      <span class="keyword">var</span> username = <span class="keyword">yield</span> prompt(<span class="string">'username: '</span>);</span><br><span class="line">+      <span class="keyword">var</span> password = <span class="keyword">yield</span> prompt.password(<span class="string">'password: '</span>);</span><br><span class="line">       <span class="built_in">console</span>.log(<span class="string">'user: %s pass: %s file: %s'</span>,</span><br><span class="line">-          program.username, program.password, file);</span><br><span class="line">+          username, password, file);</span><br><span class="line">+    &#125;);</span><br><span class="line">  &#125;)</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>现在快速测试一下。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ snippet my_awesome_file</span><br><span class="line">username: kannonboy</span><br><span class="line">password: *************************</span><br><span class="line">user: kannonboy pass: correcthorsebatterystaple file: my_awesome_file</span><br></pre></td></tr></table></figure>
<p>很棒！唯一的窍门就是ES6的 <code>yield</code>，所以这只能在用户运行在 node 4.0.0+上面。但是我们可以通过加入 <code>--harmony</code> 标志让 0.11.2 版本的也可以正常使用。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- #!/usr/bin/env node</span><br><span class="line">+ #!/usr/bin/env node --harmony</span><br><span class="line">  var co = require('co');</span><br><span class="line">  var prompt = require('co-prompt');</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h2 id="发送_snippet">发送 snippet</h2><p>Bitbucket拥有一套非常漂亮的 <a href="https://confluence.atlassian.com/display/BITBUCKET/Snippets+endpoint" target="_blank" rel="external">API</a>。在这个例子中我将关注传输单一的文件，但我们可以发送整个目录，改变我们的入口配置，加一些代码等，如果我们需要的话。我最喜欢的node HTTP 客户端是 <a href="https://www.npmjs.com/package/superagent" target="_blank" rel="external">superagent</a> ，所以让我们把它加入项目中。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install --save superagent</span><br></pre></td></tr></table></figure>
<p>现在就让我们将从用户收集到的数据发送给服务器。 <code>superagent</code> 其中一个优点就是在它在处理文件上拥有非常好的API。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">+ <span class="keyword">var</span> request = <span class="built_in">require</span>(<span class="string">'superagent'</span>);</span><br><span class="line">  <span class="keyword">var</span> co = <span class="built_in">require</span>(<span class="string">'co'</span>);</span><br><span class="line">  <span class="keyword">var</span> prompt = <span class="built_in">require</span>(<span class="string">'co-prompt'</span>);</span><br><span class="line">...</span><br><span class="line">  .action(<span class="function"><span class="keyword">function</span>(<span class="params">file</span>) </span>&#123;</span><br><span class="line">    co(<span class="function"><span class="keyword">function</span> *(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">var</span> username = <span class="keyword">yield</span> prompt(<span class="string">'username: '</span>);</span><br><span class="line">      <span class="keyword">var</span> password = <span class="keyword">yield</span> prompt.password(<span class="string">'password: '</span>);</span><br><span class="line">-     <span class="built_in">console</span>.log(<span class="string">'user: %s pass: %s file: %s'</span>,</span><br><span class="line">-         file, username, password);</span><br><span class="line">+     request</span><br><span class="line">+       .post(<span class="string">'https://api.bitbucket.org/2.0/snippets/'</span>)</span><br><span class="line">+       .auth(username, password)</span><br><span class="line">+       .attach(<span class="string">'file'</span>, file)</span><br><span class="line">+       .set(<span class="string">'Accept'</span>, <span class="string">'application/json'</span>)</span><br><span class="line">+       .end(<span class="function"><span class="keyword">function</span> (<span class="params">err, res</span>) </span>&#123;</span><br><span class="line">+         <span class="keyword">var</span> link = res.body.links.html.href;</span><br><span class="line">+         <span class="built_in">console</span>.log(<span class="string">'Snippet created: %s'</span>, link);</span><br><span class="line">+       &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>现在让我们测试一下。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ snippet my_awesome_file</span><br><span class="line">username: kannonboy</span><br><span class="line">password: *************************</span><br><span class="line">Snippet created: https://bitbucket.org/snippets/kannonboy/yq7r8</span><br></pre></td></tr></table></figure>
<p>我们的 snippet 已经发送了！\o/</p>
<h2 id="输出错误与代码">输出错误与代码</h2><p>到现在为止我们已经处理了一切正确的情况，但是如果我们上传失败或者用户输入错误的信息呢？<code>UNIX-y</code>的方法来处理错误就是将标准的错误信息输出并且以非0的状态码结束程序，所以我们也这样子做。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">  request</span><br><span class="line">    .post(<span class="string">'https://api.bitbucket.org/2.0/snippets/'</span>)</span><br><span class="line">    .auth(username, password)</span><br><span class="line">    .attach(<span class="string">'file'</span>, filename, file)</span><br><span class="line">    .set(<span class="string">'Accept'</span>, <span class="string">'application/json'</span>)</span><br><span class="line">    .end(<span class="function"><span class="keyword">function</span> (<span class="params">err, res</span>) </span>&#123;</span><br><span class="line">+     <span class="keyword">if</span> (!err &amp;&amp; res.ok) &#123;</span><br><span class="line">        <span class="keyword">var</span> link = res.body.links.html.href;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'Snippet created: %s'</span>, link);</span><br><span class="line">+       process.exit(<span class="number">0</span>);</span><br><span class="line">+     &#125;</span><br><span class="line">+</span><br><span class="line">+     <span class="keyword">var</span> errorMessage;</span><br><span class="line">+     <span class="keyword">if</span> (res &amp;&amp; res.status === <span class="number">401</span>) &#123;</span><br><span class="line">+       errorMessage = <span class="string">"Authentication failed! Bad username/password?"</span>;</span><br><span class="line">+     &#125; <span class="keyword">else</span> <span class="keyword">if</span> (err) &#123;</span><br><span class="line">+       errorMessage = err;</span><br><span class="line">+     &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">+       errorMessage = res.text;</span><br><span class="line">+     &#125;</span><br><span class="line">+     <span class="built_in">console</span>.error(errorMessage);</span><br><span class="line">+     process.exit(<span class="number">1</span>);</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>
<p>这样子就可以处理错误了。</p>
<h2 id="终端输出彩色化">终端输出彩色化</h2><p>如果你的用户是在使用体面的 <code>shell</code> ，这里也有一些包提供给你使用让你方便彩色化的输出。我喜欢 <a href="https://www.npmjs.com/package/chalk" target="_blank" rel="external">chalk</a> ，因为它拥有干净可链式的API以及自动检测用户的 <code>shell</code> 支持的颜色。这是有益的提示如果你想将你的脚本分享给 windows 用户的话。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install --save chalk</span><br></pre></td></tr></table></figure>
<p><code>chalk</code> 的命令能够彩色输出同时还能方便跟常规字符串串联起来。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">+ <span class="keyword">var</span> chalk = <span class="built_in">require</span>(<span class="string">'chalk'</span>);</span><br><span class="line">  <span class="keyword">var</span> request = <span class="built_in">require</span>(<span class="string">'superagent'</span>);</span><br><span class="line">  <span class="keyword">var</span> co = <span class="built_in">require</span>(<span class="string">'co'</span>);</span><br><span class="line">...</span><br><span class="line">   .set(<span class="string">'Accept'</span>, <span class="string">'application/json'</span>)</span><br><span class="line">   .end(<span class="function"><span class="keyword">function</span> (<span class="params">err, res</span>) </span>&#123;</span><br><span class="line">     <span class="keyword">if</span> (!err &amp;&amp; res.ok) &#123;</span><br><span class="line">       <span class="keyword">var</span> link = res.body.links.html.href;</span><br><span class="line">-      <span class="built_in">console</span>.log(<span class="string">'Snippet created: %s'</span>, link);</span><br><span class="line">+      <span class="built_in">console</span>.log(chalk.bold.cyan(<span class="string">'Snippet created: '</span>) + link);</span><br><span class="line">       process.exit(<span class="number">0</span>);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">var</span> errorMessage;</span><br><span class="line">     <span class="keyword">if</span> (res &amp;&amp; res.status === <span class="number">401</span>) &#123;</span><br><span class="line">       errorMessage = <span class="string">"Authentication failed! Bad username/password?"</span>;</span><br><span class="line">     &#125; <span class="keyword">else</span> <span class="keyword">if</span> (err) &#123;</span><br><span class="line">       errorMessage = err;</span><br><span class="line">     &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">       errorMessage = res.text;</span><br><span class="line">     &#125;</span><br><span class="line">-    <span class="built_in">console</span>.error(errorMessage);</span><br><span class="line">+    <span class="built_in">console</span>.error(chalk.red(errorMessage));</span><br><span class="line">     process.exit(<span class="number">1</span>);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<p>让我们旋转一下（这里我使用了截图，以便你能看到极好的颜色）。</p>
<p class="user_img"><img title="彩色化输出截图" class="test_img" src="/img/post/cnt1992/terminal-colors.png" alt="彩色化输出截图"></p>
<h2 id="渲染_ACSII_进度条">渲染 <code>ACSII</code> 进度条</h2><p><code>snippets</code>的API实际上支持任何类型的文件（最多10MB），但是当文件比较大或者网速特别慢的时候就需要在命令行界面显示上传文件进度了。命令行解决方案就是优雅的 <code>ASCII</code> 进度条。</p>
<p><a href="https://www.npmjs.com/package/progress" target="_blank" rel="external">progress</a> 是现在最常用的 <code>npm</code> 包用来渲染进度条。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install --save progress</span><br></pre></td></tr></table></figure>
<p><code>progress</code>的API非常简单而且可扩展，唯一的问题就是 <code>superagent</code> 当前node版本没有事件能够订阅我们上传的进度。</p>
<p>我们可以通过创建一个 <a href="https://nodejs.org/api/stream.html#stream_class_stream_readable" target="_blank" rel="external">可读的流</a> 并且增加一个事件来触发请求。然后我们初始化进度条为0，当事件触发的时候不断增加。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">+ <span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line">+ <span class="keyword">var</span> ProgressBar = <span class="built_in">require</span>(<span class="string">'progress'</span>);</span><br><span class="line">  <span class="keyword">var</span> chalk = <span class="built_in">require</span>(<span class="string">'chalk'</span>);</span><br><span class="line">  <span class="keyword">var</span> request = <span class="built_in">require</span>(<span class="string">'superagent'</span>);</span><br><span class="line">...</span><br><span class="line">  <span class="keyword">var</span> username = <span class="keyword">yield</span> prompt(<span class="string">'username: '</span>);</span><br><span class="line">  <span class="keyword">var</span> password = <span class="keyword">yield</span> prompt.password(<span class="string">'password: '</span>);</span><br><span class="line"></span><br><span class="line">+ <span class="keyword">var</span> fileSize = fs.statSync(file).size;</span><br><span class="line">+ <span class="keyword">var</span> fileStream = fs.createReadStream(file);</span><br><span class="line">+ <span class="keyword">var</span> barOpts = &#123;</span><br><span class="line">+   width: <span class="number">20</span>,</span><br><span class="line">+   total: fileSize,</span><br><span class="line">+   clear: <span class="literal">true</span></span><br><span class="line">+ &#125;;</span><br><span class="line">+ <span class="keyword">var</span> bar = <span class="keyword">new</span> ProgressBar(<span class="string">' uploading [:bar] :percent :etas'</span>, barOpts);</span><br><span class="line">+</span><br><span class="line">+ fileStream.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">chunk</span>) </span>&#123;</span><br><span class="line">+   bar.tick(chunk.length);</span><br><span class="line">+ &#125;);</span><br><span class="line"></span><br><span class="line">  request</span><br><span class="line">    .post(<span class="string">'https://api.bitbucket.org/2.0/snippets/'</span>)</span><br><span class="line">    .auth(username, password)</span><br><span class="line">-   .attach(<span class="string">'file'</span>, file)</span><br><span class="line">+   .attach(<span class="string">'file'</span>, fileStream)</span><br><span class="line">    .set(<span class="string">'Accept'</span>, <span class="string">'application/json'</span>)</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>下面是一个比较快的网速下上传大约6MB的文件的截图：</p>
<p class="user_img"><img title="上传文件进度条" class="test_img" src="/img/post/cnt1992/progress-bar.gif" alt="上传文件进度条"></p>
<p>很棒！用户现在就能够看到他们上传的进度并且知道什么时候上传完成。</p>
<h2 id="总结">总结</h2><p>我们只不过接触了用Node开发命令行脚本的冰山一角。在每一期的 <a href="http://blog.codinghorror.com/the-principle-of-least-power/" target="_blank" rel="external">Atwood’s Law</a> 都有很多 <code>npm</code> 包优雅地处理标准输入、管理并行任务、监听文件、管道流、压缩、ssh、git、还有任何你能用 <code>Bash</code> 做到的。更多地，还有非常好的API来处理子进程如果你需要其他shell脚本处理（当JavaScript处理不了的时候）。</p>
<p>我们上面例子的源码是在 <a href="https://bitbucket.org/tpettersen/bitbucket-snippet" target="_blank" rel="external">available on Bitbucket</a> 的license下，并且已经发布到 <a href="https://npmjs.org/package/bitbucket-snippet" target="_blank" rel="external">npm仓库</a>。我这里也提一些上面没有讲到的概念，比如 <code>OAuth</code> ，这样子你就不需要每次都输入用户名跟密码。如果你想自己简单体验一下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ npm install -g bitbucket-snippet</span><br><span class="line">$ snippet --help</span><br></pre></td></tr></table></figure>
<p>如果你觉得本教程有帮助，发现了bug或者有其他更酷的Node.js脚本建议，可以在Twiiter私信我。（我是 <a href="https://twitter.com/kannonboy" target="_blank" rel="external">@kannonboy</a>）</p>
]]></content>
    <summary type="html">
    <![CDATA[<blockquote>
<p>本文译自 <a href="https://developer.atlassian.com/blog/2015/11/scripting-with-node/">Building command line tools with Node.js</a>，介绍了如何通过Node.js来创建命令行脚本工具，介绍了很多实用的<code>npm</code>包等。翻译水平有限，敬请指正~</p>
</blockquote>]]>
    
    </summary>
    
      <category term="Node.js" scheme="http://aotu.io/tags/Node-js/"/>
    
      <category term="command line tools" scheme="http://aotu.io/tags/command-line-tools/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[What's New in Safari 9.0]]></title>
    <link href="http://aotu.io/notes/2015/12/23/new-safari-9/"/>
    <id>http://aotu.io/notes/2015/12/23/new-safari-9/</id>
    <published>2015-12-22T21:42:19.000Z</published>
    <updated>2015-12-24T09:51:19.000Z</updated>
    <content type="html"><![CDATA[<a id="more"></a>
<p>苹果的 OS 在不断发展，Safari 亦越变强大性感，在最新的 9.0 版本当中，Safari 增加了不少新的特性，这里主要介绍一下和 Web 前端密切相关的。</p>
<h2 id="Viewport_Changes">Viewport Changes</h2><p>关于新 Safari 对 Viewport 的影响我们先看下面一段引自苹果开发者官方文档的说明：</p>
<blockquote>
<p>Viewport meta tags using “width = content-width” cause the page to scale down to fit content that overflows the viewport bounds. You can override this behavior by adding “shrink-to-fit = no” to your meta tag as shown below. The added value will prevent the page from scaling to fit the viewport.</p>
</blockquote>
<p>可以看到 Safari 将会对有内容溢出 Viewport 区域的页面进行缩放适配，使溢出的内容完整展示而不出现滚动条，而在 Viewport 设置中引入了一个新属性 <code>shrink-to-fit = no</code>，该属性可以禁止这种缩放行为的发生。</p>
<p>下面我们具体看一下该体贴行为对页面的影响。</p>
<p>在 Safari 9.0 之前的版本，当 viewport meta 标签的 content 属性有设置的时候，<strong>如果页面内容溢出 viewport 的定义区域</strong>，那么页面将会出现滚动条，如下面的页面，该页面的 viewport 设置为：</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta <span class="property">name</span>=<span class="string">"viewport"</span> content=<span class="string">"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"</span> &gt;</span><br></pre></td></tr></table></figure>
<p><a href="http://missoy.me/mihan/h5/shop/index_nofit.html" target="_blank" rel="external">NotFixed</a></p>
<p>截图如下：</p>
<p><img src="/img/post/mihanX/safari-9/fit.jpg" alt="image"></p>
<p>然而在 Safari 9.0 的版本，即使 viewport 设置了 <code>initial-scale=1.0</code> 和 <code>user-scalable=no</code>，Safari 不仅重置了设定好的最小缩放值限制，而且还重新恢复了用户对页面进行缩放的操作权限，<a href="http://missoy.me/mihan/h5/shop/index_nofit.html" target="_blank" rel="external">上述页面</a>在 Safari 9.0 中的截图如下：</p>
<p><img src="/img/post/mihanX/safari-9/notfit.jpg" alt="image"></p>
<p>从上面的截图可以看到，Safari的缩放行为对页面视觉破坏性还是比较厉害的，如果溢出的内容很多的话，页面就会被缩得更小了。</p>
<p>在 viewport 设置添加 <code>shrink-to-fit = no</code> 这个属性后，设置如下：</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta <span class="property">name</span>=<span class="string">"viewport"</span> content=<span class="string">"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no,shrink-to-fit = no"</span> &gt;</span><br></pre></td></tr></table></figure>
<p>Safari 就不会再对页面进行缩放处理，恢复之前版本的处理方式，</p>
<p><a href="http://missoy.me/mihan/h5/shop/index_fit.html" target="_blank" rel="external">Fixed</a></p>
<p>截图如下：</p>
<p><img src="/img/post/mihanX/safari-9/fit.jpg" alt="image"></p>
<p>在日常的需求中，尽管内容溢出页面的情况不会太常见，但为了增强页面的容错能力，保证页面视觉的正常显示，在 viewport 设置中应该加上 <code>shrink-to-fit = no</code> 新属性。</p>
<h2 id="Safari内容拦截扩展">Safari内容拦截扩展</h2><p>Safari 9.0 新增了内容拦截扩展，该扩展程序能够便捷高效地拦截 cookies、图片、资源文件、弹窗等内容，不仅可以在 OS X 上使用，在 iOS 上也同样适用。</p>
<h3 id="iOS">iOS</h3><p>内容拦截扩展程序负责提供一个 JSON 文件给 Safari，这个 JSON 文件包含了一个数组，数组里面可以配置相关规则（主要由 triggers 和 actions 组成 ）拦截指定的内容，Safari 会将该 JSON 文件转换成字节代码，转换后的字节代码被应用到所有加载资源，有效地避免了用户浏览器的信息泄露到扩展程序。</p>
<p>内容拦截扩展程序的核心就是通过 JSON 文件的配置和传送，Safari 接收到之后就可以根据 JSON 的配置对相应的加载资源进行适配完成拦截。</p>
<p>Xcode内设有内容拦截应用模版（Content Blocker App Extension template），里面有一个 <code>blockerList.json</code> JSON 文件，默认设置是这样的：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        "<span class="attribute">action</span>": <span class="value">&#123;</span><br><span class="line">            "<span class="attribute">type</span>": <span class="value"><span class="string">"block"</span></span><br><span class="line">        </span>&#125;</span>,</span><br><span class="line">        "<span class="attribute">trigger</span>": <span class="value">&#123;</span><br><span class="line">            "<span class="attribute">url-filter</span>": <span class="value"><span class="string">"webkit.org/images/icon-gold.png"</span></span><br><span class="line">        </span>&#125;</span><br><span class="line">    </span>&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>表示对站点 webkit.org 的一张名为 icon-gold.png 的图片进行拦截。</p>
<p>除了可以从加载资源上拦截外，还可以通过 CSS 选择器对元素进行隐藏，如下面的配置会将站点所有 class 名为 “ads” 的 div 进行 <code>display: none !important;</code> 样式处理。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        "<span class="attribute">action</span>": <span class="value">&#123;</span><br><span class="line">            "<span class="attribute">selector</span>": <span class="value"><span class="string">"div.ads"</span></span>,</span><br><span class="line">            "<span class="attribute">type</span>": <span class="value"><span class="string">"css-display-none"</span></span><br><span class="line">        </span>&#125;</span>,</span><br><span class="line">        "<span class="attribute">trigger</span>": <span class="value">&#123;</span><br><span class="line">            "<span class="attribute">url-filter</span>": <span class="value"><span class="string">".*"</span></span><br><span class="line">        </span>&#125;</span><br><span class="line">    </span>&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p><strong> 注意：由于 32 位架构的设备性能限制，iOS上的内容拦截扩展只适用在 64 位架构的设备上，苹果从 A7 处理器开始采用 64位架构，因此 iPhone 5s + 的机器才可能使用此扩展应用 </strong></p>
<p>关于参数 action 和 trigger 的更多介绍可以参阅：</p>
<p><img src="/img/post/mihanX/safari-9/blocker_8.jpg" alt="image"> </p>
<p><a href="https://webkit.org/blog/3476/content-blockers-first-look/" target="_blank" rel="external">Introduction to WebKit Content Blockers</a></p>
<p><a href="https://www.hackingwithswift.com/safari-content-blocking-ios9" target="_blank" rel="external">Safari Content Blocking in iOS 9: a tutorial by example</a></p>
<h4 id="一个简单的内容拦截扩展应用">一个简单的内容拦截扩展应用</h4><p>实现一个拦截扩展应用很简单，现在我们以 <a href="http://missoy.me/mihan/h5/shop/index.html" target="_blank" rel="external">拍拍小店首页</a> 为例，拦截顶部广告区域：</p>
<p><img src="/img/post/mihanX/safari-9/blocker_1.jpg" alt="image"></p>
<p>Update Xcode 到最新版本，打开 Xcode，新建立一个 iOS Single View Application 项目（blocker-demo），如图所示：</p>
<p><img src="/img/post/mihanX/safari-9/blocker_2.jpg" alt="image"></p>
<p>然后新建立一个 Target，在 Application Extension 模版中选中 Content Blocker Extension：</p>
<p><img src="/img/post/mihanX/safari-9/blocker_3.jpg" alt="image"></p>
<p>完成之后，就可以在项目中看到刚才新增的 Target 文件夹（blocker），可以找到一个名为 <code>blockerList.json</code>的 JSON 文件，在里面就可以配置需要拦截内容的规则了，如图所示：</p>
<p><img src="/img/post/mihanX/safari-9/blocker_4.jpg" alt="image"></p>
<p>（顶部广告区域的 class 名为 <code>mod_ad</code>， 例子中的配置将会将顶部广告区域隐藏。）</p>
<p>然后以整个项目为编译对象，选择需要测试的模块器（这里选择了 iPhone6）运行程序 ，<strong> 切记不要选中 content blocker 的 Target 为编译对象运行，在模拟器上不能生效 </strong>。</p>
<p>运行后我们看到白茫茫的一片，模拟器默认打开了刚才新建立的应用，这时候我们需要回到主界面（command + shift + h）进入系统设置界面， 到 Safari &gt;Content Blockers 里面启动内容拦截扩展，如图所示：</p>
<p><img src="/img/post/mihanX/safari-9/blocker_5.jpg" alt="image"></p>
<p>启动 Safari，打开<a href="http://missoy.me/mihan/h5/shop/index.html" target="_blank" rel="external">拍拍小店首页</a>，这时候我们可以看到，启动内容拦截扩展之后，顶部的广告区域被隐藏了</p>
<p><img src="/img/post/mihanX/safari-9/blocker_6.jpg" alt="image"></p>
<p>用 Safari 的 Web 检查器看了一下页面，发现用户样式表里针对顶部广告区域多了一个 <code>display: none !important;</code>样式</p>
<p><img src="/img/post/mihanX/safari-9/blocker_7.jpg" alt="image"></p>
<p>最后需要将程序打包，才能在真机运行，貌似需要 688RMB 的开发者帐号，土豪们可以尽情试一试。</p>
<h3 id="OS_X">OS X</h3><p>在 OS X Safari 的扩展创建器（Extension Builder）加入拦截 JSON 文件（如下图）或者在 Safari 扩展对象中使用新增的 setContentBlocker API 就可以实现内容拦截功能了</p>
<p><img src="https://developer.apple.com/library/prerelease/ios/releasenotes/General/WhatsNewInSafari/Art/ExtensionBuilder_AdBlocker_2x.png" alt="image"></p>
<p><strong> 需要注意的是，用于拦截内容的 onbeforeload 事件和 canLoad 信息已被弃用 </strong></p>
<p>更多有关 Safari 内容拦截扩展介绍：</p>
<p><a href="https://www.hackingwithswift.com/safari-content-blocking-ios9" target="_blank" rel="external">Safari Content Blocking in iOS 9: a tutorial by example</a></p>
<p><a href="http://www.cnblogs.com/CocoonJin/p/4701050.html" target="_blank" rel="external">iOS 9之Safari广告拦截器（Content Blocker）</a></p>
<h2 id="System_Font_Support">System Font Support</h2><h3 id="-apple-system">-apple-system</h3><p>苹果操作系统会从两种不同外观和大小的字体进行自动转换去调节系统新字体 “San Francisco”，可以通过 CSS 规则</p>
<pre><code><span class="attribute">font-family</span>: <span class="string">-apple-system, sans-serif;</span>
</code></pre><p>让系统智能选择适配操作系统的字体。</p>
<p>可以看一下下面两张在系统 OS X 10.11.1 下的对比图：</p>
<p>没有添加 <code>-apple-system</code> 属性值：</p>
<p><img src="/img/post/mihanX/safari-9/sys-font-no.png" alt="image"></p>
<p>添加了 <code>-apple-system</code> 属性值：</p>
<p><img src="/img/post/mihanX/safari-9/sys-font-yes.png" alt="image"></p>
<p>可以看到添加了 <code>-apple-system</code>，字体变得更圆润锐利</p>
<p><strong>建议：在 <code>font-family</code> 属性加上 <code>-apple-system</code> 属性值。</strong></p>
<p>图片看不出差别的同学请用 OS X Safari 9.0 打开以下链接：</p>
<p><a href="http://missoy.me/mihan/demo/sys-font.html" target="_blank" rel="external">System Font Support</a></p>
<p><img src="/img/post/mihanX/safari-9/sys-font-qrcode.png" alt="image"></p>
<p>更多关于 System Font Support 介绍 ：<a href="https://webkit.org/blog/3709/using-the-system-font-in-web-content/" target="_blank" rel="external">Using the System Font in Web Content</a></p>
<p>附：<a href="http://www.jiemian.com/article/392197.html" target="_blank" rel="external">《在吐槽iOS 9的新字体之前，你应该了解这些》</a></p>
<h3 id="iOS_text-style_keywords">iOS text-style keywords</h3><p>Safari 9.0除了支持 <code>-apple-system</code> 新字体特性之外，在 iOS 平台提供了更丰富更具活力的文本样式，该文本样式不仅仅是特定的字体，包括所有的 <code>font</code> 样式，如字重和字号，因此只能以 <code>font</code> 来定义：</p>
<ul>
<li>font: -apple-system-body;</li>
<li>font: -apple-system-headline;</li>
<li>font: -apple-system-subheadline;</li>
<li>font: -apple-system-caption1;</li>
<li>font: -apple-system-caption2;</li>
<li>font: -apple-system-footnote;</li>
<li>font: -apple-system-short-body;</li>
<li>font: -apple-system-short-headline;</li>
<li>font: -apple-system-short-subheadline;</li>
<li>font: -apple-system-short-caption1;</li>
<li>font: -apple-system-short-footnote;</li>
<li>font: -apple-system-tall-body;</li>
</ul>
<p>加上这些属性在 iOS 上会有不同的表现：</p>
<p><img src="/img/post/mihanX/safari-9/sys-font.png" alt="image"></p>
<p>有兴趣的同事去 <a href="http://missoy.me/mihan/demo/sys-font.html" target="_blank" rel="external">Demo</a> 页看一下：</p>
<p><img src="/img/post/mihanX/safari-9/sys-font-qrcode.png" alt="image"></p>
<h2 id="CSS_Scroll_Snapping">CSS Scroll Snapping</h2><p>2015年3月26日，W3C的CSS工作组发布了CSS滚动界限点模块（CSS Scroll Snap Points Level 1）的首份工作草案（First Public Working Draft）。在浏览可以连续上下滚动或左右滚动的连续页面或一组图片时，通过触摸屏的触摸滑动或鼠标滚轴的滚动操作可以获得较好用户体验。</p>
<p>Safari 9.0 的新特性支持强大的 CSS Scroll Snap，利用这个特性，我们可以用CSS轻松实现网站常见的轮播图滚动特效</p>
<p>我们先看一下 <a href="http://missoy.me/mihan/demo/scroll-snap.html" target="_blank" rel="external">Demo</a> 感受一下 ，请用 Safari 9.0 打开</p>
<p><img src="/img/post/mihanX/safari-9/scroll-snap_9.jpg" alt="image"></p>
<p>使用 Scroll Snap 需要的结构包含装载滚动元素的容器和需要滚动的元素：</p>
<pre><code>&lt;<span class="keyword">div</span> <span class="type">class</span>=<span class="string">"scroll_container"</span>&gt;
    &lt;<span class="keyword">div</span> <span class="type">class</span>=<span class="string">"scroll_elements"</span>&gt;&lt;/<span class="keyword">div</span>&gt;
    &lt;<span class="keyword">div</span> <span class="type">class</span>=<span class="string">"scroll_elements"</span>&gt;&lt;/<span class="keyword">div</span>&gt;
    &lt;<span class="keyword">div</span> <span class="type">class</span>=<span class="string">"scroll_elements"</span>&gt;&lt;/<span class="keyword">div</span>&gt;
    &lt;<span class="keyword">div</span> <span class="type">class</span>=<span class="string">"scroll_elements"</span>&gt;&lt;/<span class="keyword">div</span>&gt;
&lt;/<span class="keyword">div</span>&gt;
</code></pre><p>Scroll Snap 一共有5个CSS属性可使用，分别是 </p>
<ul>
<li><p>scroll-snap-type：定义滚动界限的类型，有三个属性值可选， <code>none</code> | <code>mandatory</code> | <code>proximity</code>，初始值为 <code>none</code>，<strong>目前 WebKit 只支持 <code>mandatory</code></strong>。</p>
</li>
<li><p>scroll-snap-points-x：定义滚动容器 X 轴方向的 scroll sanp 点，有两个属性值可选，<code>none</code>| <code>repeat(&lt;length&gt;)</code>，初始值为 <code>none</code></p>
</li>
<li><p>scroll-snap-points-y：定义滚动容器 Y 轴方向的 scroll sanp 点，有两个属性值可选，<code>none</code> | <code>repeat(&lt;length&gt;)</code>，初始值为 <code>none</code></p>
</li>
<li><p>scroll-snap-destination：定义滚动元素在滚动容器的对齐坐标点，属性值为 <code>&lt;position&gt;</code>，初始值为：<code>0px 0px</code></p>
</li>
<li><p>scroll-snap-coordinate：定义滚动元素与滚动容器对齐点重合的坐标点，属性值为 <code>none</code> | <code>&lt;position&gt;</code>，初始值为 <code>none</code></p>
</li>
</ul>
<p>属性 <em>scroll-snap-type</em> 、<em>scroll-snap-points-x</em>、<em>scroll-snap-points-y</em> 和 <em>scroll-snap-destination</em> 应用在容器元素</p>
<p>属性 <em>scroll-snap-coordinate</em> 应用在滚动元素</p>
<p>滚动容器 scroll snap 坐标点 和 滚动元素 scroll snap 坐标点分别如下图红色十字和黄色十字所示：</p>
<p><img src="/img/post/mihanX/safari-9/scroll-snap_10.png" alt="image"></p>
<p>此时的设置是：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">.scroll_container</span><span class="rules">&#123;</span><br><span class="line">	<span class="rule"><span class="attribute">-webkit-scroll-snap-type</span>:<span class="value"> mandatory</span></span>;</span><br><span class="line">	<span class="rule"><span class="attribute">-webkit-scroll-snap-destination</span>:<span class="value"> <span class="number">50%</span> <span class="number">50%</span></span></span>;</span><br><span class="line">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="class">.scroll_elements</span><span class="rules">&#123;</span><br><span class="line">	<span class="rule"><span class="attribute">-webkit-scroll-snap-coordinate</span>:<span class="value"> <span class="number">50%</span> <span class="number">50%</span></span></span>;</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<p>属性详细使用情况请参阅 <a href="http://www.w3.org/TR/css-snappoints-1/" target="_blank" rel="external">CSS Scroll Snap Points Module Level 1</a></p>
<h3 id="需要注意的">需要注意的</h3><ul>
<li><p>该草案还在不断修进改进，WebKit 目前只支持带 -webkit- 前辍的写法</p>
</li>
<li><p>要启用 scroll snap 效果，滚动容器必须具有非 <code>none</code> 值的属性 <code>scroll-snap-type</code> </p>
</li>
<li><p>滚动容器 <code>scroll-snap-points-x</code> 和 <code>scroll-snap-points-y</code> 的属性设置会忽略滚动元素 <code>scroll-snap-coordinate</code> 属性设置</p>
</li>
<li><p>滚动容器 <code>scroll-snap-destination</code> 属性与滚动元素 <code>scroll-snap-coordinate</code> 总是成对出现的</p>
</li>
<li><p>滚动内容发生改变（如滚动容器大小、滚动元素大小、节点的改变等）使得滚动元素的 scroll snap 点不在滚动容器的 scroll snap 点的时候，滚动偏移值会发生改变。</p>
</li>
<li><p>不同尺寸的滚动元素混合在一起发生滚动的时候，在 X 或 Y 轴方向上离滚动容器 scroll snap 点最近的滚动元素 scroll snap 点方向轴将会与滚动容器 scroll snap 点的方向轴重合（存在滚动区域的时候）。</p>
</li>
</ul>
<p>更多关于 scroll-snap 属性 Demo 可查看 <a href="https://www.webkit.org/blog/4017/scroll-snapping-with-css-snap-points/" target="_blank" rel="external">Scroll Snapping with CSS Snap Points</a></p>
<h2 id="Initial_Letter_Support">Initial Letter Support</h2><p>Safari 9.0 支持 CSS <code>initial-letter</code>(要带 -webkit- 前辍) 属性了，以前我们通过伪元素 <code>::first-letter</code>实现首字下沉的效果，但是局限性比较多：</p>
<ul>
<li><p>首字母的高度需要通过调整字号大小实现，比较难精确到需要设置的高度</p>
</li>
<li><p>段落字号改变的时候，首字母字号并不能自适应改变，因此并不能自适应实现对齐</p>
</li>
</ul>
<p><img src="/img/post/mihanX/safari-9/initial-letter_2.jpg" alt="image"></p>
<p>CSS <code>initial-letter</code> 属性能很好的解决这些问题，我们先看一下它的属性值： </p>
<ul>
<li><p>normal – 初始值</p>
</li>
<li><p>[&lt;number&gt; &lt;integer&gt;] – 定义首字母的大小和下沉位置</p>
<ul>
<li><p>&lt;number&gt; 首字母的大小，大小值为正数值，字高占据的行数为单位，如 “2” 表示首字母高大小占据段落两行</p>
</li>
<li><p>&lt;integer&gt; 首字母下沉的位置，大小值为不为0的整数，若缺省，则以第一个参数 &lt;number&gt;数值为准</p>
</li>
</ul>
</li>
</ul>
<p><code>initial-letter</code>属性应用在伪元素 <code>::first-letter</code> 或容器第一个行内子元素</p>
<p><a href="http://dev.w3.org/csswg/css-inline/#initial-letter-styling" target="_blank" rel="external">w3文档介绍</a>的 EXAMPLE 截图引用如下：</p>
<blockquote>
<p><img src="/img/post/mihanX/safari-9/initial-letter.jpg" alt="image"></p>
</blockquote>
<p>实验 <a href="http://missoy.me/mihan/demo/initial-letter.html" target="_blank" rel="external">Demo</a> 如下：</p>
<p><img src="/img/post/mihanX/safari-9/initial-letter_3.png" alt="image"></p>
<h2 id="Backdrop_Filters">Backdrop Filters</h2><p>CSS背景滤镜属性 <code>backdrop-filter</code> 可以让元素的背景或元素层级以下的元素加上滤镜效果，以下的属性值在 Safari 9.0 得到了全面支持： </p>
<ul>
<li><p><code>blur(&lt;length&gt;)</code>：模糊，原始效果值为 <code>0px</code>，不接受负值</p>
</li>
<li><p><code>brightness([ &lt;number&gt; | &lt;percentage&gt; ])</code>：亮度，原始效果值为 <code>1</code> 或 <code>100%</code>，不接受负值</p>
</li>
<li><p><code>contrast([ &lt;number&gt; | &lt;percentage&gt; ])</code>：对比度，原始效果值为 <code>1</code> 或 <code>100%</code>，不接受负值</p>
</li>
<li><p><code>drop-shadow( &lt;length&gt;{2,3} &lt;color&gt;?)</code>：投影，原始效果值为所有长度值为 <code>0</code>，长度值至少2个，最多3个，<strong>注意：不支持投影扩展值和混合投影</strong></p>
</li>
<li><p><code>grayscale([ &lt;number&gt; | &lt;percentage&gt; ] )</code>：灰度，原始效果值为 <code>0</code>，最大值为 <code>1</code> 或 <code>100%</code>，不接受负值</p>
</li>
<li><p><code>hue-rotate( &lt;angle&gt;)</code>：相位，原始效果值为 <code>0deg</code></p>
</li>
<li><p><code>invert( [ &lt;number&gt; | &lt;percentage&gt; ])</code>：反相，原始效果值为 <code>0</code>，最大值为 <code>1</code> 或 <code>100%</code>，不接受负值</p>
</li>
<li><p><code>opacity([ &lt;number&gt; | &lt;percentage&gt; ] )</code>：透明度，原始效果值为 <code>1</code>，最大值为 <code>1</code> 或 <code>100%</code>，不接受负值</p>
</li>
<li><p><code>saturate([ &lt;number&gt; | &lt;percentage&gt; ])</code>：饱和度，原始效果值为 <code>1</code>，不接受负值</p>
</li>
<li><p><code>sepia([ &lt;number&gt; | &lt;percentage&gt; ])</code>：乌贼墨，原始效果值为 <code>0</code>，最大值为 <code>1</code> 或 <code>100%</code>，不接受负值 </p>
</li>
</ul>
<p>滤镜属性 <code>filter</code> 同样具有以上的属性值，与背景滤镜<code>backdrop-filter</code> 不同的是，<code>filter</code> 作用于元素本身（文本、背景等）以其子元素，而 <code>backdrop-filter</code> 只作用于元素本身的背景（文本及其子元素不受影响）以及其层级下面的其它元素，具体的测试参考下面的 <a href="http://missoy.me/mihan/demo/filter.html" target="_blank" rel="external">Demo</a></p>
<p><img src="/img/post/mihanX/safari-9/filter2.jpg" alt="image"> </p>
<p><img src="/img/post/mihanX/safari-9/filter.jpg" alt="image"></p>
<p>更多关于 <code>backdrop-filter</code></p>
<p>WebKit.org：<a href="https://webkit.org/blog/3632/introducing-backdrop-filters/" target="_blank" rel="external">Introducing Backdrop Filters</a></p>
<p>w3c文档：<a href="https://drafts.fxtf.org/filters/#typedef-filter-function-list" target="_blank" rel="external">typedef-filter-function-list</a></p>
<h2 id="CSS3_Feature_Queries">CSS3 Feature Queries</h2><p>Safari 9.0 支持了 CSS3 功能查询 <code>@supports</code>，可以对 CSS 属性(包括但不限于带前辍的属性，如 -webkit-,-moz- 等)进行检测</p>
<h3 id="单个条件查询">单个条件查询</h3><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 检测是否支持 display:flexbox，如果支持侧执行中括号的内容 */</span></span><br><span class="line"><span class="at_rule">@supports</span> ( <span class="attribute">display</span>: flexbox ) &#123;</span><br><span class="line">  <span class="class">.selector</span>&#123;</span><br><span class="line">  	...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="多个单件查询">多个单件查询</h3><p>可以使用逻辑关键字 <code>not</code>、<code>and</code>、<code>or</code> 进行多个单件查询</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@supports ( box-shadow: <span class="number">2</span>px <span class="number">2</span>px <span class="number">2</span>px black ) or</span><br><span class="line">          ( -moz-box-shadow: <span class="number">2</span>px <span class="number">2</span>px <span class="number">2</span>px black ) or</span><br><span class="line">          ( -webkit-box-shadow: <span class="number">2</span>px <span class="number">2</span>px <span class="number">2</span>px black ) or</span><br><span class="line">          ( -o-box-shadow: <span class="number">2</span>px <span class="number">2</span>px <span class="number">2</span>px black ) &#123;</span><br><span class="line">  .selector&#123;</span><br><span class="line">  	...</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="需要注意的地方">需要注意的地方</h3><ul>
<li><p><code>@supports</code> 后面总是跟着一个空格符和一个括号，<code>逻辑关键字</code>前后总有一个空格符。因此，写查询条件的时候</p>
  <figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 错误的写法 */</span></span><br><span class="line"><span class="annotation">@supports</span> <span class="string">display:</span> flexbox &#123;</span><br><span class="line"> 	<span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="annotation">@supports</span>(<span class="string">display:</span> flexbox)&#123;</span><br><span class="line"> 	<span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="annotation">@supports</span> (<span class="string">display:</span> flexbox)and(-webkit-scroll-snap-<span class="string">type:</span>mandatory) &#123;</span><br><span class="line"> 	<span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 正确的写法 */</span></span><br><span class="line"><span class="annotation">@supports</span> (<span class="string">display:</span> flexbox) &#123;</span><br><span class="line"><span class="comment">//...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="annotation">@supports</span> (<span class="string">display:</span> flexbox) and (-webkit-scroll-snap-<span class="string">type:</span>mandatory) &#123;</span><br><span class="line"> 	<span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>多个单件查询，当有多个逻辑关键字混合使用的时候，查询语句最外层最多只有一个逻辑关键字：</p>
  <figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 错误的写法 */</span></span><br><span class="line">@supports (A) <span class="operator">or</span> (B) <span class="operator">and</span> (C) &#123;<span class="comment"></span><br><span class="line">//...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 正确的写法 */</span></span><br><span class="line">@supports (A) <span class="operator">or</span> ((B) <span class="operator">and</span> (C)) &#123;<span class="comment"></span><br><span class="line">//...</span></span><br><span class="line">&#125;</span><br><span class="line">@supports ((A) <span class="operator">or</span> (B)) <span class="operator">and</span> (C) &#123;<span class="comment"></span><br><span class="line">//...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><code>@supports</code> 更详细说明可参考：<a href="http://www.w3.org/TR/css3-conditional/#at-supports" target="_blank" rel="external">at-supports</a>。</p>
<p><a href="http://missoy.me/mihan/demo/@supports.html" target="_blank" rel="external">Demo测试</a></p>
<p><img src="/img/post/mihanX/safari-9/@supports2.jpg" alt="image"></p>
<h2 id="CSS4_Selectors">CSS4 Selectors</h2><p>以下 CSS4 选择器在 Safari 9.0 完全支持了：</p>
<ul>
<li>属性选择器忽略大小写标识（Case-insensitive attribute selectors）</li>
<li><code>:any-link</code></li>
<li><code>:lang</code></li>
<li><code>:matches</code></li>
<li><code>:not</code></li>
<li><code>:nth-child</code></li>
<li><code>:placeholder-shown</code></li>
</ul>
<h3 id="Case-insensitive">Case-insensitive</h3><p>一般情况下，选择符中属性名和值的大小写敏感性取决于文档语言的敏感性，为了使其匹配忽略大小写敏感性以及其文档语言的敏感性，可以在属性选择器的关闭符<code>]</code>前加上标识符 <code>i</code>，这样不管在什么文档，都能忽略大小写敏感性，如以下例子：</p>
<p>结构：</p>
<pre><code>&lt;<span class="keyword">div</span> <span class="type">class</span>=<span class="string">"box"</span> title=<span class="string">"BOX"</span>&gt;Box&lt;/<span class="keyword">div</span>&gt;
</code></pre><p>样式：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* .box初始背景色为白色 */</span></span><br><span class="line"><span class="class">.box</span><span class="rules">&#123;</span><br><span class="line">	<span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">100px</span></span></span>;</span><br><span class="line">	<span class="rule"><span class="attribute">height</span>:<span class="value"> <span class="number">100px</span></span></span>;</span><br><span class="line">	<span class="rule"><span class="attribute">margin</span>:<span class="value"> <span class="number">10px</span></span></span>;</span><br><span class="line">	<span class="rule"><span class="attribute">color</span>:<span class="value"> <span class="hexcolor">#fff</span></span></span>;</span><br><span class="line">	<span class="rule"><span class="attribute">text-align</span>:<span class="value"> center</span></span>;</span><br><span class="line">	<span class="rule"><span class="attribute">line-height</span>:<span class="value"> <span class="number">100px</span></span></span>;</span><br><span class="line">	<span class="rule"><span class="attribute">word-break</span>:<span class="value"> break-all</span></span>;</span><br><span class="line">	<span class="rule"><span class="attribute">word-wrap</span>:<span class="value"> break-word</span></span>;</span><br><span class="line">	<span class="rule"><span class="attribute">background</span>:<span class="value"> <span class="hexcolor">#fff</span></span></span>;</span><br><span class="line">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 属性值大小写敏感，完全匹配，.box背景变黑色 */</span></span><br><span class="line"><span class="class">.box</span><span class="attr_selector">[title="BOX"]</span><span class="rules">&#123;</span><br><span class="line">	<span class="rule"><span class="attribute">background</span>:<span class="value"> <span class="hexcolor">#000</span></span></span>;</span><br><span class="line">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 用了 CSS4 的 Case-insensitive 属性选择器，若浏览器支持，大小写不再敏感，能完成匹配，.box背景生效变为灰色 */</span></span><br><span class="line"><span class="class">.box</span><span class="attr_selector">[title="box" i]</span><span class="rules">&#123;</span><br><span class="line">	<span class="rule"><span class="attribute">background</span>:<span class="value"> <span class="hexcolor">#ccc</span></span></span>;</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<p>关于 Case-insensitive 更详细介绍：<a href="http://www.w3.org/TR/selectors4/#attribute-case" target="_blank" rel="external">w3介绍文档 - Case-insensitive</a> </p>
<p>测试 <a href="http://missoy.me/mihan/demo/css4_selector.html" target="_blank" rel="external">Demo</a></p>
<p><img src="/img/post/mihanX/safari-9/css4_selector.jpg" alt="image"></p>
<h3 id="伪类_:any-link">伪类 :any-link</h3><p>w3文档介绍大概的描述是这样的：</p>
<blockquote>
<p>如果元素有定义伪类 <code>:link</code>或 <code>:visited</code> ，<code>:any-link</code>将会对其进行匹配。</p>
</blockquote>
<p>于是写了 Demo 验证了一下</p>
<p>HTML:</p>
<pre><code><span class="tag">&lt;<span class="title">a</span> <span class="attribute">href</span>=<span class="value">"http://aotu.io/"</span> <span class="attribute">title</span>=<span class="value">""</span> <span class="attribute">class</span>=<span class="value">"lk"</span>&gt;</span>凹凸Team链接<span class="tag">&lt;/<span class="title">a</span>&gt;</span>
</code></pre><p>CSS:</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">.lk</span><span class="rules">&#123;</span><br><span class="line">	<span class="rule"><span class="attribute">display</span>:<span class="value"> block</span></span>;</span><br><span class="line">	<span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">100px</span></span></span>;</span><br><span class="line">	<span class="rule"><span class="attribute">height</span>:<span class="value"> <span class="number">30px</span></span></span>;</span><br><span class="line">	<span class="rule"><span class="attribute">line-height</span>:<span class="value"> <span class="number">30px</span></span></span>;</span><br><span class="line">	<span class="rule"><span class="attribute">text-align</span>:<span class="value"> center</span></span>;</span><br><span class="line">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 黑色背景 */</span></span><br><span class="line"><span class="class">.lk</span><span class="pseudo">:link</span><span class="rules">&#123;</span><br><span class="line">	<span class="rule"><span class="attribute">background</span>:<span class="value"> <span class="hexcolor">#000</span></span></span>;</span><br><span class="line">	<span class="rule"><span class="attribute">color</span>:<span class="value"> <span class="hexcolor">#fff</span></span></span>;</span><br><span class="line">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 黄色背景 */</span></span><br><span class="line"><span class="class">.lk</span><span class="pseudo">:visited</span><span class="rules">&#123;</span><br><span class="line">	<span class="rule"><span class="attribute">background</span>:<span class="value"> <span class="hexcolor">#ff0</span></span></span>;</span><br><span class="line">	<span class="rule"><span class="attribute">color</span>:<span class="value"> <span class="hexcolor">#333</span></span></span>;</span><br><span class="line">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 红色背景 */</span></span><br><span class="line"><span class="class">.lk</span><span class="pseudo">:any-link</span><span class="rules">&#123;</span><br><span class="line">	<span class="rule"><span class="attribute">background</span>:<span class="value"> <span class="hexcolor">#ff3737</span></span></span>;</span><br><span class="line">	<span class="rule"><span class="attribute">color</span>:<span class="value"> <span class="hexcolor">#fff</span></span></span>;</span><br><span class="line">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 白色背景 */</span></span><br><span class="line"><span class="class">.lk</span><span class="pseudo">:hover</span><span class="rules">&#123;</span><br><span class="line">	<span class="rule"><span class="attribute">background</span>:<span class="value"> <span class="hexcolor">#fff</span></span></span>;</span><br><span class="line">	<span class="rule"><span class="attribute">color</span>:<span class="value"> <span class="hexcolor">#333</span></span></span>;</span><br><span class="line">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 灰色背景 */</span></span><br><span class="line"><span class="class">.lk</span><span class="pseudo">:active</span><span class="rules">&#123;</span><br><span class="line">	<span class="rule"><span class="attribute">background</span>:<span class="value"> <span class="hexcolor">#ccc</span></span></span>;</span><br><span class="line">	<span class="rule"><span class="attribute">color</span>:<span class="value"> <span class="hexcolor">#333</span></span></span>;</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<p>结果发现：</p>
<ul>
<li><p><code>:any-link</code> Safari 9.0 生效了，Chrome、Firefox 并没有生效。</p>
</li>
<li><p>伪类 <code>:any-link</code> 的确会对已定义有的伪类<code>:link</code> 和 <code>:visited</code>匹配，并重新覆盖元素相同的CSS属性， 而 <code>:hover</code> 和 <code>:active</code> 并没有匹配成功，<code>:hover</code> 和 <code>:active</code> 依然生效</p>
</li>
<li><p>CSS代码解析的时候渲染 <code>:any-link</code> 前就渲染了 <code>:link</code> 和 <code>:visited</code>，因此匹配成功了，而 <code>:hover</code> 和 <code>:active</code> 出现在 <code>:any-link</code> 后面，并不能匹配成功</p>
</li>
</ul>
<p>若加上 <code>-webkit-</code> 前辍，Chrome 亦能生效。</p>
<p>如果将 <code>:any-link</code> 出现位置改变，<code>:any-link</code> 始终匹配出现在他之前的 Link 相关伪类，有兴趣的同学可以试一下。</p>
<p>小小总结了一下：</p>
<ul>
<li><p><code>:any-link</code> Safari 9.0 不需要加前辍，Chrome、Firefox 浏览器需要加 <code>-webkit-</code>、<code>-moz-</code> 前辍。</p>
</li>
<li><p><code>:any-link</code> 匹配有效性和书写顺序有关，<code>:any-link</code> 只对出现在其之前的 Link 伪类匹配生效。</p>
</li>
</ul>
<h4 id="建议">建议</h4><p><strong>写 a 标签样式的时候，在 <code>:hover</code> 和 <code>:active</code> 前应该加上 <code>:any-link</code> 伪类样式，覆盖系统默认的 <code>:link</code> 和 <code>:visited</code>伪类样式。如下所示：</strong></p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">a</span>&#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">a</span><span class="pseudo">:-webkit-any-link</span>&#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">a</span><span class="pseudo">:-moz-any-link</span>&#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">a</span><span class="pseudo">:any-link</span>&#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">a</span><span class="pseudo">:hover</span>&#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="tag">a</span><span class="pseudo">:active</span>&#123;</span><br><span class="line">	...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>关于 <code>:any-link</code> 更详细介绍： <a href="http://www.w3.org/TR/selectors4/#the-any-link-pseudo" target="_blank" rel="external">w3介绍文档 - :any-link</a> </p>
<p>实验 <a href="http://missoy.me/mihan/demo/css4_selector.html" target="_blank" rel="external">Demo</a></p>
<p><img src="/img/post/mihanX/safari-9/css4_selector.jpg" alt="image"></p>
<h3 id="伪类_:matches()">伪类 :matches()</h3><p><code>:matches()</code> 是一种类似函数的伪类，可以将不同的选择器以数组形式混合形成一个选择器组，我们可以将之看作是CSS的一种语法糖，请看下面的例子：</p>
<pre><code><span class="pseudo">:matches(section</span>, <span class="tag">article</span>, <span class="tag">aside</span>, <span class="tag">nav</span>) <span class="tag">h1</span> <span class="rules">{
  <span class="rule"><span class="attribute">color</span>:<span class="value"> <span class="hexcolor">#BADA55</span></span></span>;
}</span>

<span class="comment">/* 相当于下面的代码 */</span>
<span class="tag">section</span> <span class="tag">h1</span>,
<span class="tag">article</span> <span class="tag">h1</span>, 
<span class="tag">aside</span> <span class="tag">h1</span>,
<span class="tag">nav</span> <span class="tag">h1</span> <span class="rules">{
  <span class="rule"><span class="attribute">color</span>:<span class="value"> <span class="hexcolor">#BADA55</span></span></span>;
}</span>
</code></pre><p>更方便书写一些复杂的选择器，如：</p>
<pre><code><span class="pseudo">:matches(section</span>, <span class="tag">article</span>, <span class="tag">aside</span>, <span class="tag">nav</span>) <span class="pseudo">:matches(h1</span>, <span class="tag">h2</span>, <span class="tag">h3</span>, <span class="tag">h4</span>, <span class="tag">h5</span>, <span class="tag">h6</span>) <span class="rules">{
    <span class="rule"><span class="attribute">color</span>:<span class="value"> <span class="hexcolor">#BADA55</span></span></span>;
}</span>

<span class="comment">/* 相当于下面的代码 */</span>
<span class="tag">section</span> <span class="tag">h1</span>, <span class="tag">section</span> <span class="tag">h2</span>, <span class="tag">section</span> <span class="tag">h3</span>, <span class="tag">section</span> <span class="tag">h4</span>, <span class="tag">section</span> <span class="tag">h5</span>, <span class="tag">section</span> <span class="tag">h6</span>, 
<span class="tag">article</span> <span class="tag">h1</span>, <span class="tag">article</span> <span class="tag">h2</span>, <span class="tag">article</span> <span class="tag">h3</span>, <span class="tag">article</span> <span class="tag">h4</span>, <span class="tag">article</span> <span class="tag">h5</span>, <span class="tag">article</span> <span class="tag">h6</span>, 
<span class="tag">aside</span> <span class="tag">h1</span>, <span class="tag">aside</span> <span class="tag">h2</span>, <span class="tag">aside</span> <span class="tag">h3</span>, <span class="tag">aside</span> <span class="tag">h4</span>, <span class="tag">aside</span> <span class="tag">h5</span>, <span class="tag">aside</span> <span class="tag">h6</span>, 
<span class="tag">nav</span> <span class="tag">h1</span>, <span class="tag">nav</span> <span class="tag">h2</span>, <span class="tag">nav</span> <span class="tag">h3</span>, <span class="tag">nav</span> <span class="tag">h4</span>, <span class="tag">nav</span> <span class="tag">h5</span>, <span class="tag">nav</span> <span class="tag">h6</span> <span class="rules">{
    <span class="rule"><span class="attribute">color</span>:<span class="value"> <span class="hexcolor">#BADA55</span></span></span>;
}</span>
</code></pre><p>减少重复的书写：</p>
<pre><code><span class="class">.links</span><span class="pseudo">:matches(</span><span class="pseudo">:hover</span>, <span class="pseudo">:focus</span>, <span class="pseudo">:active)</span> <span class="rules">{
    <span class="rule"><span class="attribute">color</span>:<span class="value"> <span class="hexcolor">#BADA55</span></span></span>;
}</span>

<span class="comment">/* 相当于下面的代码 */</span>
<span class="class">.links</span><span class="pseudo">:hover</span>, <span class="class">.links</span><span class="pseudo">:focus</span>, <span class="class">.links</span><span class="pseudo">:active</span> <span class="rules">{
    <span class="rule"><span class="attribute">color</span>:<span class="value"> <span class="hexcolor">#BADA55</span></span></span>;
}</span>    
</code></pre><p><strong>注意：<code>:matches()</code>不能嵌套而且不能与 <code>:not()</code> 一起使用</strong>，以下的写法都是不允许的：</p>
<pre><code><span class="comment">/* Doesn't work */</span>
:<span class="function"><span class="title">matches</span><span class="params">(:not(...)</span></span>)

<span class="comment">/* Doesn't work */</span>
:<span class="function"><span class="title">not</span><span class="params">(:matches(...)</span></span>)

<span class="comment">/* Doesn't work */</span>
:<span class="function"><span class="title">matches</span><span class="params">(:matches(...)</span></span>)
</code></pre><p>更多关于 <code>:matches()</code> 可参考 </p>
<p>CSS-tricks ：<a href="https://css-tricks.com/almanac/selectors/m/matches/" target="_blank" rel="external">:matches()</a></p>
<p>W3文档：<a href="http://www.w3.org/TR/selectors4/#matches" target="_blank" rel="external">matches</a></p>
<h3 id="伪类_:placeholder-shown">伪类 :placeholder-shown</h3><p>如果元素 E 设置了属性 <code>placeholder</code>，属性值不为空并出现在页面的时候，那么<code>E:placeholder-shown</code> 就能匹配到该元素，当 <code>placeholder</code> 文本在页面消失的时候，匹配到的相应样式也会消失，如以下 <a href="http://missoy.me/mihan/demo/css4_selector.html" target="_blank" rel="external">Demo</a> 所示:</p>
<p><img src="/img/post/mihanX/safari-9/css4_selector.jpg" alt="image"></p>
<h3 id="伪类_:nth-child，:not，:lang">伪类 :nth-child，:not，:lang</h3><p>详细用法有兴趣的同学可以到 w3文档 查阅：</p>
<p><a href="http://www.w3.org/TR/selectors4/#the-lang-pseudo" target="_blank" rel="external">:lang - #the-lang-pseudo</a></p>
<p><a href="http://www.w3.org/TR/selectors4/#negation" target="_blank" rel="external">:not - #negation</a> </p>
<p><a href="http://www.w3.org/TR/selectors4/#the-nth-child-pseudo" target="_blank" rel="external">:nth-child - #the-nth-child-pseudo</a></p>
<h2 id="Unprefixed_CSS_Properties">Unprefixed CSS Properties</h2><p>以下CSS属性在 Safari 9.0 已完全支持，不用再带 <code>-webkit-</code> 前辍：</p>
<ul>
<li>transition</li>
<li>transition-delay</li>
<li>transition-duration</li>
<li>transition-property</li>
<li>transition-timing-function</li>
<li>animation</li>
<li>cursor: zoom-in</li>
<li>cursor: zoom-out</li>
<li>perspective</li>
<li>perspective-origin</li>
<li>transform</li>
<li>transform-origin</li>
<li>transform-style</li>
<li>@keyframes</li>
<li>animation-name</li>
<li>animation-duration</li>
<li>animation-timing-function</li>
<li>animation-iteration-count</li>
<li>animation-direction</li>
<li>animation-play-state</li>
<li>animation-delay</li>
<li>animation-fill-mode</li>
<li>order</li>
<li>align-content</li>
<li>align-items</li>
<li>align-self</li>
<li>justify-content</li>
<li>flex</li>
<li>flex-basis</li>
<li>flex-direction</li>
<li>flex-flow</li>
<li>flex-grow</li>
<li>flex-shrink</li>
<li>flex-wrap</li>
<li>break-after</li>
<li>break-before</li>
<li>break-inside</li>
<li>columns</li>
<li>column-count</li>
<li>column-fill</li>
<li>column-gap</li>
<li>column-rule</li>
<li>column-rule-color</li>
<li>column-rule-style</li>
<li>column-rule-width</li>
<li>column-span</li>
<li>column-width</li>
<li>alt</li>
</ul>
<h2 id="Responsive_Design_Mode">Responsive Design Mode</h2><p>Safari 9.0 推出了响应式设计模式，command + option + R 或在“开发 – 进入响应式设计模式”可以进入，界面如下图：</p>
<p><img src="/img/post/mihanX/safari-9/rdm.png" alt="image"></p>
<p>这里有：</p>
<ul>
<li>现主流 iPhone/iPad 机型尺寸</li>
<li>iOS8.1系统模拟（iphone、ipad、ipod touch）</li>
<li>苹果系主流分辨率</li>
<li>Safari 9.0.1 Mac</li>
<li>Chrome – Mac/Windows</li>
<li>FireFox – Mac/Windows</li>
<li>IE7 - IE10 –Windows（ 好样的！）</li>
<li>页面精度</li>
</ul>
<p>点击选中的机型图标还可以以不同的方式展示，如 iPhone 的横屏，iPad 的分屏等</p>
<p>响应式设计模式 Chrome 浏览器早早就有，但单从苹果产品的调试去看，个人更喜欢 Safari 的响应式设计模式，无论从外观、体验以及专注度，都要优于 Chrome，Safari一直在进步，从不怀疑 Apple Developer 的级数。</p>
<p><img src="/img/post/mihanX/safari-9/chrome.png" alt="image"></p>
<h2 id="Web_Inspector_Redesign">Web Inspector Redesign</h2><p>之前所了解到的 Web Inspector 版本：</p>
<p><img src="/img/post/mihanX/safari-9/web_inspector_1.png" alt="image"></p>
<p>（从苹果开发者文档介绍了解到的，没使用过，目测是 Safari 4.0 or 之前的）</p>
<p><img src="/img/post/mihanX/safari-9/web_inspector_2.png" alt="image"></p>
<p>（直接 google 图片了解到的，没使用过，目测是 Safari 6.0 重新设计那款）</p>
<p>Safari 9.0 的 Web 检查器经过了重新设计，更直观易用，用户体验更棒。</p>
<p>开发任务 Tab 切换更简易快捷，新的渲染时间线框架更容易更细致检测到页面渲染的情况</p>
<p><img src="/img/post/mihanX/safari-9/web_inspector_3.png" alt="image"></p>
<p>元素查看，样式修改调试方便，直接点光标直接处于编辑状态了，不明白 Chrome 的为什么点了默认全选，编辑态还有一个输入框的形态，Apple 的极简设计理念无处不在，处处体现着苹果 Design 的基因</p>
<p><img src="/img/post/mihanX/safari-9/web_inspector_4.png" alt="image"></p>
<p>断点调试器也哗啦啦地好看易用：</p>
<p><img src="/img/post/mihanX/safari-9/web_inspector_5.png" alt="image"></p>
<p>更多的内容有兴趣的同学去体验一下吧，这里就不一一烧图了。</p>
<div style="color:#fff;">如果说 Chrome Web Inspector 是一名角斗士，那么 Safari Web Inspector 就是一名会写诗的角斗士</div>]]></content>
    <summary type="html">
    <![CDATA[<a id="more"></a>
<p>苹果的 OS 在不断发展，Safari 亦越变强大性感，在最新的 9.0 版本当中，Safari 增加了不少新的特性，这里主要介绍一下和 Web 前端密切相关的。</p>
<h2 id="Viewport_Changes">Viewpor]]>
    </summary>
    
      <category term="OS X" scheme="http://aotu.io/tags/OS-X/"/>
    
      <category term="Safari 9.0" scheme="http://aotu.io/tags/Safari-9-0/"/>
    
      <category term="iOS" scheme="http://aotu.io/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[What Does the Foo Mean]]></title>
    <link href="http://aotu.io/notes/2015/12/18/etymology-of-foobar/"/>
    <id>http://aotu.io/notes/2015/12/18/etymology-of-foobar/</id>
    <published>2015-12-17T21:22:23.000Z</published>
    <updated>2015-12-24T09:51:19.000Z</updated>
    <content type="html"><![CDATA[<p>今天在 WebKit 看了 CSS 伪类的文章，其中对 <code>:matches()</code> 的介绍出现了 <code>foo</code> 和 <code>bar</code>：</p>
<pre><code><span class="pseudo">:matches(</span><span class="class">.foo</span>, <span class="class">.bar</span>) <span class="rules">{
    <span class="rule"><span class="attribute">background-color</span>:<span class="value"> green</span></span>;
}</span>
</code></pre><p>随即想起，以前在不少编程书里经常看到 <code>foo</code>、<code>bar</code> 这对 couple，一直不知道他们的具体含义，于是默默去 google 搜了一下，发现结果都几有意思。</p>
<p>首先在 <em>Quora</em> 里发现一位名为 <em>Thom Parkin</em> 的网友回答：</p>
<blockquote>
<p>“foo” has been (until very recently) always used as part of a pair (with “bar”) when representing arbitrary names in computer science.  This is primarily in the instance of examples.</p>
<p>Much like the “Hello World” is a standard for examples in computer programming the use of “foo” and “bar” had grown in popularity.</p>
<p>The origin comes from a common phrase much older than computers and computer programming.</p>
<p>The choice of “foo” coupled with “bar” is derived from the coloquial acronym FUBAR (pronounced FOO-bar).</p>
<p>Legendarily from the military world, it represents the phrase:<br>“Fucked Up Beyond All Recognition” (in ‘mixed company’ the first word could be “Fouled”).</p>
</blockquote>
<p>大概的意思是说：</p>
<p>在计算计领域里，“foo” 和 “bar” 通常会成对出现，在举例的时候用作没有明确意义的命名，就好像 “Hellow World” 例子在计算机编程里面作为标准的例子一样，“foo” 和 “bar” 的使用已经变得很流行。</p>
<p>而该词在常用的习语里面出现的时间远比在计算机或计算机编程里面出现的早，“foo” 和 “bar” 成对出现则起源于口语 “FUBAR” 一词（发音和 Foo-bar 一样）。</p>
<p>来自军事世界的传说中，“FooBar” 的含义则是 “Fucked Up Beyond All Recognition，全句意思是 “糟糕糟到面目全非/真是混乱不堪” ？</p>
<p>看完 <em>Thom Parkin</em> 的解释，隐隐约约觉得此词来头不小，但是啊 <em>Thom</em> 的介绍又不够详细，然后继续 search 一下，发现万能 Wiki Sir 对此有更详细的描述。</p>
<p>Wiki Sir 直接就来一句 “Not to be confused with FUBAR”，心里只想说：666666</p>
<p>Wiki 对 “Foobar” 一词的定义是这样的：</p>
<blockquote>
<p>The terms foobar (/ˈfuːbɑr/), fubar, or foo, bar, baz and qux (alternatively, quux) and sometimes norf[1][2][3][4] and many others[5][6] are sometimes used as placeholder names (also referred to as metasyntactic variables) in computer programming or computer-related documentation.[7] They have been used to name entities such as variables, functions, and commands whose exact identity is unimportant and serve only to demonstrate a concept. The words themselves have no meaning in this usage. Foobar is sometimes used alone; foo, bar, and baz are sometimes used, when multiple entities are needed.</p>
</blockquote>
<p>大概意思是：</p>
<ul>
<li><p>Foobar 还有一群兄弟姐妹，例如 “fubar” 、“baz”、“qux”、“quux”、“norf”，他们很多时候都会作为占位名（或者作为伪变量）被应用在计算机编程或与计算机相关的文档中。</p>
</li>
<li><p>他们被用作变量命名、函数命名、和命令命名，这些命名基本都是不重要的，仅仅作为某个概念阐述的示例，他们本身并没有什么具体含义</p>
</li>
<li><p>Foobar有时候单独使用，而当多个这种用法出现的时候， “foo”，“bar”，“baz” 会组合使用。</p>
</li>
</ul>
<p>嗯~~ 原来是这样~~</p>
<p>那么出处呢？Wiki Sir 介绍得比较详细，有兴趣的同学自己 <a href="https://en.wikipedia.org/wiki/Foobar#History_and_etymology" target="_blank" rel="external">Click Here</a> 去看看原文，在下也试下意译到本文</p>
<p><em>Foo</em> 一词起源于 20 世纪 30 年代的一个并没有任何意义的词（nonsense word）和 20 世界 40 年代军事术语里面的 “FUBAR” 以及大约在 20 世纪 60 年代麻省理工学院铁路模型技术俱乐部（TMRC）在一个程序上下文用到的词汇。然而，这些词汇之间明确的联系仍然不清晰，从而使得一些有趣的理论学说进一步去定义他们。</p>
<p><em>Foo</em> 在文献 《Internet Engineering Task Force (IETF) <a href="https://tools.ietf.org/html/rfc3092" target="_blank" rel="external">RFC 3092</a>》里有定义（文献标题为 Etymology of “Foo”），文献给出了 <em>foo</em> 最早的使用记录，就是出现在 20 世纪 30 年代由美国 <em>Bill Holman</em> 创作的连载漫画 <em>Smokey Stover</em>，<em>foo</em> 被用作没有具体含义的词，如下图的 “foomobile”：</p>
<p><img src="/img/post/mihanX/foo-img-1.jpg" alt="image"></p>
<p><em>(Smokey Stover driving a “foomobile”)</em></p>
<p>作者 <em>Holman</em> 说使用这个词是因为他在旧金山唐人街看到一尊中国玉雕像底部的“福”字，<em>foo</em> 大概是 <em>福（fu）</em> 的音译。而当时像 “福祿壽”、“福满处”等象征上帝的虚构形象在中国非常流行。</p>
<p><em>Smokey Stover</em> 从 1935 连载到 1973，期间一直重点保留着 “foo” 的特征，就好像上面 “foomobile” 的插图。这个词在 20 世纪 30 年代非常流行，除了在 <em>Smokey Stover</em> 出现，还在其它卡通和连载漫画里出现，如由 <em>Bob Clampett</em> 创办的 <em>Looney Tunes（兔巴哥）</em>卡通系列里的 <em>The Daffy Doc</em> 和 <em>Porky in Wackyland</em> 以及漫画 <em>Pogo</em></p>
<p>接着，<em>Foo</em> 走进了军事俚语 “FUBAR”（Fucked Up Beyond All Recognition）一词中，合并到词里的 “FU”。在第二次世界大战里盟军飞行员用词汇 “foo fighter” 描述各种各样的 UFO 或者一些神秘的空中现象</p>
<p><em>Foo</em> 第一次在正式的程序类印刷品作为较为人知的词汇出现于 1965 年 TMRC 的一版印刷品，关于紧急开关（scram switches）方面的内容：</p>
<p>在复杂的模型系统中，一些紧急开关被安装在许多场所附近可以利用的空间里，这些场所有可能会发生突发的不幸事故，如全速前进的火车遇到障碍物。这种模型系统的另一个特性就是调试模拟盘上的数码时钟。当有人按下紧急开关，数码时钟就停止工作，显示屏上亦随之换成 “FOO” 这个词。在 TMRC 里面，紧急开关也因此称作 “Foo开关”（Foo switches）。正因为这样，“foo” 一词录入了 TMRC 语言字典。</p>
<p>有一本书描述了 MIT（麻省理工学院） 列车室靠门侧的两个分别标上 “foo” 和 “bar” 标签的按钮。在那时期，这两个词通常应用到各种按钮上；当 MIT 的黑客们有新奇想法的时候也会反复使用他们。因此，<em>foo</em> 和 <em>bar</em> 被广泛用作变化不定的命名。在 TMRC 语言字典精简版中有这样的描述：</p>
<blockquote>
<p>Multiflush: stop-all-trains-button. Next best thing to the red door button. Also called FOO. Displays “FOO” on the clock when used.</p>
</blockquote>
<p>Multiflush（不知道叫啥）：停下所有列车按钮，门边的红色按钮，也叫做 “FOO”，当使用后，时钟上会显示 “FOO”。</p>
<p>好了，现在终于知道 <em>foo</em>、<em>bar</em> 是什么了，简单总结下就是：</p>
<ol>
<li><p>20 世纪 30 年代，一位美国漫画达人在一尊中国玉雕像上看到一个中国字 – “福” ，然后就将其音译成 “foo”，并应用到他自己的漫画上</p>
</li>
<li><p>漫画大叔将 “foo” 发扬光大不久，唯恐不乱的军事世界将 “foo” 放到了俚语 “FUBAR” 里面，演变成了 “Foobar”</p>
</li>
<li><p>之后 MIT 人才在介绍一项 “complex model system” 的紧急开关中引入了 “foo” 一词，并发表出去，于是乎 MIT 的黑客们一有新奇想法就用 “foo” 一词，并用上了瘾，久而久之大家就对 “foo” 和 “bar” 认识达成了共识</p>
</li>
</ol>
<p>一句话概括就是：<em>Foo</em>、<em>Bar</em> 什么鬼都不是却能代表一切，FUBAR!</p>
<p>The End</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>今天在 WebKit 看了 CSS 伪类的文章，其中对 <code>:matches()</code> 的介绍出现了 <code>foo</code> 和 <code>bar</code>：</p>
<pre><code><span class="pseudo">:matc]]>
    </summary>
    
      <category term="Foo" scheme="http://aotu.io/tags/Foo/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[【译】介绍Sass Maps：用法跟例子]]></title>
    <link href="http://aotu.io/notes/2015/12/09/an-introduction-to-sass-maps/"/>
    <id>http://aotu.io/notes/2015/12/09/an-introduction-to-sass-maps/</id>
    <published>2015-12-09T09:54:16.000Z</published>
    <updated>2015-12-09T11:01:48.000Z</updated>
    <content type="html"><![CDATA[<blockquote>
<p>本文翻译自<a href="http://webdesign.tutsplus.com/tutorials/an-introduction-to-sass-maps-usage-and-examples--cms-22184" target="_blank" rel="external">An Introduction to Sass Maps:Usage and Examples</a></p>
</blockquote>
<a id="more"></a>
<p>对于前端可伸缩页面的编写来说Sass Maps可以说是一个福音，从逻辑模块中抽取出配置是一种非常好的方法。现在就让我跟你解释为什么我认为在Sass 3.3中Sass Maps是最好的特性。</p>
<h2 id="Sass_3-3">Sass 3.3</h2><p>Sass 3.3[<em>注1</em>]即将更新给所有人使用，但是对于很多开发者来说还有很多实用性的特性他们依然不熟悉。新版本的Sass 3.3带给我们新的数据类型称为<code>map</code>。<code>Maps</code>是<code>key/value</code>键值对的集合，能够帮助我们通过简单的代码创建一块配置区域。</p>
<h2 id="如何使用_Sass_Maps">如何使用 Sass Maps</h2><p>首先我们会覆盖Sass Maps的基本用法，后面会看几个实例。</p>
<h3 id="创建一个Map">创建一个Map</h3><p>下面是一个快速创建Sass Maps的语句，创建一个变量（这里用了<code>$map</code>）然后输入一些<code>keys</code>跟<code>values</code>，通过<code>,</code>来分割，这些键值对通过括号包围起来：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$map: (</span><br><span class="line">  key: value,</span><br><span class="line">  nextkey: nextvalue</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h3 id="如何获取Map的值">如何获取Map的值</h3><p>当你定义了很多对<code>key/value</code>键值对之后，有时候你需要取出一些值。你可以通过<code>map-get()</code>方法来找出某个<code>key</code>的<code>value</code>。该方法需要传入两个参数：<code>map</code>的名称还有<code>key</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.element:before &#123;</span><br><span class="line">  content: map-get($map, key);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面编译输出后的结果如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">.element</span><span class="pseudo">:before</span> <span class="rules">&#123;</span><br><span class="line">  <span class="rule"><span class="attribute">content</span>:<span class="value"> value</span><br><span class="line"></span></span></span>&#125;</span><br></pre></td></tr></table></figure>
<h3 id="如何检查某一个key是否存在">如何检查某一个key是否存在</h3><p>在用<code>Sass</code>进行编码的时候强烈建议使用<a href="https://webdesign.tutsplus.com/tutorials/an-introduction-to-error-handling-in-sass--cms-19996" target="_blank" rel="external">可靠的错误处理</a>。在这里<code>Sass</code>给了我们一个方法<code>map-has-key()</code>。这个方法能够检测出某个<code>key</code>是否存在，如果不存在能够输出其他信息给开发者。</p>
<p>可以移步 <code>Hugo Giraudel</code> 写的这篇如何处理错误的文章 <a href="http://webdesign.tutsplus.com/tutorials/an-introduction-to-error-handling-in-sass--cms-19996" target="_blank" rel="external">An Introduction to Error Handing in Sass</a>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$map: (</span><br><span class="line">  key: value,</span><br><span class="line">  nextkey: nextvalue</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">.element &#123;</span><br><span class="line">  @<span class="keyword">if</span> map-has-key($map, key)&#123;</span><br><span class="line">    content: <span class="string">'Map has this key.'</span>;</span><br><span class="line">  &#125; @<span class="keyword">else</span> &#123;</span><br><span class="line">    content: <span class="string">'Map has not this key.'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编译之后结果如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">.element</span> <span class="rules">&#123;</span><br><span class="line">  <span class="rule"><span class="attribute">content</span>:<span class="value"> <span class="string">'Map has this key.'</span></span></span>;</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="如何合并Maps">如何合并Maps</h3><p>这个一个福利：<code>Sass</code>允许我们合并两个甚至更多个<code>maps</code>成一个，这是一个非常实用的功能，通过下面这个例子我们将知道如何使用<code>map-merge()</code>方法：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$colors: (</span><br><span class="line">  light: #ccc,</span><br><span class="line">  dark: #000</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">$brand-colors: (</span><br><span class="line">  main: red,</span><br><span class="line">  alternative: blue</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">// 合并maps</span><br><span class="line">$merged: map-merge($colors, $brand-colors);</span><br><span class="line"></span><br><span class="line">.element &#123;</span><br><span class="line">  content: map-get($merged, alternative);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编译之后结果如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">.element</span> <span class="rules">&#123;</span><br><span class="line">  <span class="rule"><span class="attribute">content</span>:<span class="value"> blue</span></span>;</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="利用Sass_Maps进行实战">利用Sass Maps进行实战</h2><p>上面我们介绍了如何实用<code>Sass Maps</code>，现在我们将通过一些实战训练看看在哪些地方适合使用该特性。</p>
<p>1.如何循环Map生成类</p>
<p>你可以遍历<code>map</code>通过里面的<code>values</code>去定义你需要的变量然后加到<code>map</code>里面的<code>name</code>去，这样子你可以创建出很多种<code>values</code>。</p>
<p>在下面的例子中我将输出<code>classes</code>来展示<code>icons</code>。我将<code>icon</code>的<code>name</code>作为<code>key</code>，让<code>value</code>去替代实际的<code>content</code>(通过伪元素加进去)。</p>
<blockquote>
<p>注意：在项目实战中我们通过会先声明一些基础的样式，这不在本教程的范围内。</p>
</blockquote>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">/* 定义一个sass map名称为$icons */</span><br><span class="line">$icons: (</span><br><span class="line">  checkmark: a,</span><br><span class="line">  plus: b,</span><br><span class="line">  minus: c</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">/* 遍历map的所有key，创建各自的类 */</span><br><span class="line">@each $name, $value in $icons &#123;</span><br><span class="line">  .icon--#&#123;$name&#125; &#123;</span><br><span class="line">    content: $value;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编译之后结果如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 遍历map的所有key，创建各自的类 */</span></span><br><span class="line"><span class="class">.icon--checkmark</span> <span class="rules">&#123;</span><br><span class="line">  <span class="rule"><span class="attribute">content</span>:<span class="value"> <span class="string">"a"</span></span></span>;</span><br><span class="line">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="class">.icon--plus</span> <span class="rules">&#123;</span><br><span class="line">  <span class="rule"><span class="attribute">content</span>:<span class="value"> <span class="string">"b"</span></span></span>;</span><br><span class="line">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="class">.icon--minus</span> <span class="rules">&#123;</span><br><span class="line">  <span class="rule"><span class="attribute">content</span>:<span class="value"> <span class="string">"c"</span></span></span>;</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<p>这是一种非常高效的方法来输出icons的所有类，还有大量情况也会使用这种方法。</p>
<p>2.如何拿出Maps的多个值</p>
<p>让我们继续，给一个<code>key</code>赋予多个<code>value</code>也是可以的。多个<code>value</code>之间通过<code>,</code>来分割。下面的例子能够非常好的输出不同模块的样式。</p>
<p>这里我将定义一系列<code>buttons</code>，每一个<code>key</code>的第一个<code>value</code>是<code>background-color</code>，第二个<code>value</code>是<code>font-color</code>。</p>
<p>然后我将通遍历<code>keys</code>赋值给<code>$colors</code>对象。通过<code>nth($colors,1)</code>（第一个参数是对象的名称，第二个参数是值得位置）拿到第一个<code>key</code>。如果你需要拿第二个<code>value</code>，那将第二个参数改为<code>2</code>。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">// _m-buttons.scss</span><br><span class="line">$buttons: (</span><br><span class="line">  error: (#d82d2d, #666),</span><br><span class="line">  success: (#52bf4a, #fff),</span><br><span class="line">  warning: (#c23435, #fff)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">.m-button &#123;</span><br><span class="line">  display: inling-block;</span><br><span class="line">  padding: .5em;</span><br><span class="line">  background: #ccc;</span><br><span class="line">  color: #666;</span><br><span class="line"></span><br><span class="line">  @each $name, $colors in $buttons &#123;</span><br><span class="line">    $bgcolor: nth($colors, 1);</span><br><span class="line">    $fontcolor: nth($colors, 2);</span><br><span class="line"></span><br><span class="line">    &amp;--#&#123;$name&#125; &#123;</span><br><span class="line">      background-color: $bgcolor;</span><br><span class="line">      color: $fontcolor;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编译之后结果如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">.m-button</span> <span class="rules">&#123;</span><br><span class="line">  <span class="rule"><span class="attribute">display</span>:<span class="value"> inline-block</span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">padding</span>:<span class="value"> .<span class="number">5em</span></span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">background</span>:<span class="value"> <span class="hexcolor">#ccc</span></span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">color</span>:<span class="value"> <span class="hexcolor">#666</span></span></span>;</span><br><span class="line">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="class">.m-button--error</span> <span class="rules">&#123;</span><br><span class="line">  <span class="rule"><span class="attribute">background-color</span>:<span class="value"> <span class="hexcolor">#d82d2d</span></span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">color</span>:<span class="value"> <span class="hexcolor">#666</span></span></span>;</span><br><span class="line">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="class">.m-button--success</span> <span class="rules">&#123;</span><br><span class="line">  <span class="rule"><span class="attribute">background-color</span>:<span class="value"> <span class="hexcolor">#52bf4a</span></span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">color</span>:<span class="value"> <span class="hexcolor">#fff</span></span></span>;</span><br><span class="line">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="class">.m-button--warning</span> <span class="rules">&#123;</span><br><span class="line">  <span class="rule"><span class="attribute">background-color</span>:<span class="value"> <span class="hexcolor">#c23435</span></span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">color</span>:<span class="value"> <span class="hexcolor">#fff</span></span></span>;</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<p>3.处理层(z-index)</p>
<p>在某种程度上来说，我还没有见过不跟<a href="https://webdesign.tutsplus.com/articles/what-you-may-not-know-about-the-z-index-property--webdesign-16892" target="_blank" rel="external">z-index</a>打交道的前端开发。当你在项目中多个地方需要使用到<code>z-index</code>的时候问题通常随之而来，<code>Sass maps</code>能够帮我们解决这些问题。</p>
<p>首先我们定义了一个map名称为<code>$layer</code>，所有的<code>key</code>都应该合理命名以便我们能够知道哪个value是对应哪个element的-比如：<code>offcanvas</code>,<code>lightbox</code>,<code>dropdown</code>等。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// _config.scss</span></span><br><span class="line">$layer: (</span><br><span class="line">  offcanvas: <span class="number">1</span>,</span><br><span class="line">  lightbox: <span class="number">500</span>,</span><br><span class="line">  dropdown: <span class="number">10</span>,</span><br><span class="line">  tooltip: <span class="number">15</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// _m-lightboxes.scss</span></span><br><span class="line">@<span class="function"><span class="keyword">function</span> <span class="title">layer</span>(<span class="params">$name</span>) </span>&#123;</span><br><span class="line">  @<span class="keyword">if</span> map-has-key($layer, $name) &#123;</span><br><span class="line">    @<span class="keyword">return</span> map-get($layer, $name);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @warn <span class="string">"The key #&#123;$name&#125; is not in the map '$layer'"</span>;</span><br><span class="line">  @<span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">.m-lightbox &#123;</span><br><span class="line">  z-index: layer(lightbox);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面我定义了一个方法用来获取特定<code>key</code>的<code>value</code>，但为什么我要这样做？理由很简单：这样子比每次都写<code>map-get()</code>方法要方便快捷。另外一个方面就是你可以创建<code>错误处理</code>给开发者一些错误信息当没有输出期望的信息的时候。</p>
<p>编译结果如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">.m-lightbox</span> <span class="rules">&#123;</span><br><span class="line">  <span class="rule"><span class="attribute">z-index</span>:<span class="value"> <span class="number">500</span></span></span>;</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<p>4.在项目中为字体创建基本样式</p>
<p>每一个项目都拥有自己的配置文件，用来给全局使用。例如在我的项目中我会定义一些字体属性：字体颜色，可选的字体颜色，字体集或者字体大小。我通常都会为每个属性创建一个变量，但是<code>map</code>能够做得更好。</p>
<p>下面是一个简单的例子，先从<em>旧</em>的解决方法开始：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$base-font-color: #666;</span><br><span class="line">$base-font-family: Arial, Heletica, Sans-Serif;</span><br><span class="line">$base-font-size: 16px;</span><br><span class="line">$base-line-height: 1.4;</span><br></pre></td></tr></table></figure>
<p>接下来看通过<code>Sass Map</code>写的<code>新</code>的解决方法：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// _config.scss</span><br><span class="line">$font: (</span><br><span class="line">  color: #666;</span><br><span class="line">  family: (Arial, Helvetica),</span><br><span class="line">  size: 16px,</span><br><span class="line">  line-height: 1.4</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">// _presets.scss</span><br><span class="line">body &#123;</span><br><span class="line">  color: map-get($font, color);</span><br><span class="line">  font-family: map-get($font, family);</span><br><span class="line">  font-size: map-get($font, size);</span><br><span class="line">  line-height: map-get($font, line-height);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>5.Breakpoints &lt; 3</p>
<p>我很喜欢这个使用案例。在你的整个项目中拥有一块专门用来处理断点是非常好的。所以，像这一节中关于处理<code>z-index</code>，你就已经用到了断点。当你改变值得时候，整个项目的行为也随之改变，这多么令人惊讶。</p>
<p>那就先让我们通过一个<code>map</code>名称为<code>$breakpoints</code>开始吧。</p>
<p>我们的目标就是在一个元素中使用断点通过易懂的名字替代那些<code>pixel</code>值，所以需要一个<code>mixin</code>方法来实现占位<code>name</code>，我把mixin命名为<code>respond-to</code>以及传入<code>$brakpoint</code>参数。通过<code>$value</code>我就能得到期望的断点然后后面在<code>媒体查询</code>中使用。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Map with much breakpoints</span></span><br><span class="line">$breakpoints: (</span><br><span class="line">  small: <span class="number">320</span>px,</span><br><span class="line">  medium: <span class="number">600</span>px,</span><br><span class="line">  large: <span class="number">768</span>px</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Respond-To Mixin</span></span><br><span class="line">@mixin respond-to($breakpoint) &#123;</span><br><span class="line">  @<span class="keyword">if</span> map-has-key($breakpoints, $breakpoint) &#123;</span><br><span class="line">    $value: map-get($breakpoints, $breakpoint);</span><br><span class="line"></span><br><span class="line">    @media screen and (min-width: $value) &#123;</span><br><span class="line">      @content;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @warning <span class="string">"Unknown `#&#123;$breakpoint&#125;` in $breakpoints"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>示例：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">// Sass</span><br><span class="line">.m-tabs &#123;</span><br><span class="line">  background-color: #f2f2f2;</span><br><span class="line"></span><br><span class="line">  @include reponse-to(medium) &#123;</span><br><span class="line">    background-color: #666;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Output</span><br><span class="line">.m-tabs &#123;</span><br><span class="line">  background-color: #f2f2f2;</span><br><span class="line">&#125;</span><br><span class="line">@media screen and (min-width: 600px) &#123;</span><br><span class="line">  background-color: #666;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这种使用案例是我最喜欢之一！</p>
<p>6.颜色的高级使用</p>
<p>现在事情变得有一点点困难了，让我们看看通过不同色调定义的颜色计划。</p>
<p>我们的<code>Sass map</code>在这个例子中定义了一个<code>$colorscheme</code>同时里面定义了很多对象拥有<code>keys</code>跟<code>values</code>。项目中拥有不同的灰色调，但我们不想为每一个都声明一个变量。所以我们增加了一个对象<code>gray</code>，然后通过键值对分割。</p>
<p>下面开始这个Map:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// Scheme of colors</span><br><span class="line">$colorscheme: (</span><br><span class="line">  gray: (</span><br><span class="line">    base: #ccc,</span><br><span class="line">    light: #f2f2f2,</span><br><span class="line">    dark: #666</span><br><span class="line">  ),</span><br><span class="line">  brown: (</span><br><span class="line">    base: #ab906b,</span><br><span class="line">    light: #ecdac3,</span><br><span class="line">    dark: #5e421c</span><br><span class="line">  )</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>现在让我们加入<code>setcolor</code>方法来获取颜色的不同选择。第一个参数是Sass map的对象(<code>$scheme</code>)-在这个例子中可能是<code>gray</code>或者<code>brown</code>，第二个参数就是你想要的颜色(<code>$tone</code>)，默认值是<code>base</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@<span class="function"><span class="keyword">function</span> <span class="title">setcolor</span>(<span class="params">$scheme, $tone: base</span>) </span>&#123;</span><br><span class="line">  @<span class="keyword">return</span> map-get(map-get($colorscheme, $scheme), $tone);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后，这里给出了一个例子能够让你从这个map中获取不同颜色，比你想象中的还要简单（也许）！</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// Sass</span><br><span class="line">.element &#123;</span><br><span class="line">  color: setcolor(brown);</span><br><span class="line">&#125;</span><br><span class="line">.element--light &#123;</span><br><span class="line">  color: setcolor(brown, light);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Output</span><br><span class="line">.element &#123;</span><br><span class="line">  color: #ab906b;</span><br><span class="line">&#125;</span><br><span class="line">.element--light &#123;</span><br><span class="line">  color: #ecdac3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>你会完成上面的挑战的，现在你能够创建一组色调而不需要通过为每一种颜色创建一个变量。</p>
<p>这个方法我是受到了<a href="http://erskinedesign.com/blog/friendlier-colour-names-sass-maps/" target="_blank" rel="external">Tom Davies</a>的启发，同时我也建议你看看他这篇文章。</p>
<h2 id="通过Classes定制主题">通过Classes定制主题</h2><p>这是为高级Sass用户准备的。在项目中会经常需要通过一些基础代码创建多套主题，所以这里给出一个建议：在文档的最开始就定义一个 <em>主题类</em> 来满足特定的工作。我们需要一个对象以便能够处理不同名字的主题，同时给出不同的样式模块。</p>
<h3 id="定义themes">定义themes</h3><p>最开始，在你的项目中通过Sass map全局定义themes，<code>value</code>就是主题名字，同时这个类必须附在<code>body</code>元素。在这个例子中我创建了一个map<code>$themes</code>，里面有两个主题：<code>theme-light</code>和<code>theme-dark</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// _config.scss</span></span><br><span class="line">$themes: (</span><br><span class="line">  theme1: theme-light;</span><br><span class="line">  theme2: theme-dark;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h3 id="获取值（捷径）">获取值（捷径）</h3><p>现在我们需要一个方法来快速获取模块的值，这是一个简单的方法包括三个变量如下：</p>
<ul>
<li><code>$map</code>: 定义map的名字确定values是从哪里来的</li>
<li><code>$object</code>: 在这里例子中就是theme的key</li>
<li><code>$style</code>: 需要的样式属性值</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// _functions.scss</span></span><br><span class="line">@<span class="function"><span class="keyword">function</span> <span class="title">setStyle</span>(<span class="params">$map, $object, $style</span>) </span>&#123;</span><br><span class="line">  @<span class="keyword">if</span> map-has-key($map, $object) &#123;</span><br><span class="line">    @<span class="keyword">return</span> map-get(map-get($map, $object), $style);</span><br><span class="line">  &#125;</span><br><span class="line">  @warn <span class="string">"The key `#&#123;$object&#125;` is not available in the map."</span>;</span><br><span class="line">  @<span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="生成模块">生成模块</h3><p>现在我们创建新的<code>Sass Map</code>名称为<code>$config</code>，每一个主题都是一个对象同时名字必须是<code>$themes</code>中的<code>key</code>：不然将会报错。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// _m-buttons.scss</span><br><span class="line">// 1.Config</span><br><span class="line">$config: (</span><br><span class="line">  theme1: (</span><br><span class="line">    background: #f2f2f2,</span><br><span class="line">    color: #000</span><br><span class="line">  ),</span><br><span class="line">  theme2: (</span><br><span class="line">    background: #666,</span><br><span class="line">    color: #fff</span><br><span class="line">  )</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h3 id="遍历主题">遍历主题</h3><p>最后一部分会使用一点点技巧。开始的地方我们定义了一个模块<code>.m-button</code>然后我们期望在每个主题下面外观是不一样的。所以我们使用<code>@each</code>方法遍历Map<code>$themes</code>拿到<code>$key</code>跟<code>$value</code>。遍历之后就能够为不同主题创建map。</p>
<p>在这一节的开始我提到了<code>keys</code>在每个map里面必须是一样的(<code>$themes</code>跟<code>$config</code>)。因此我们必须检查map<code>$config</code>的key是否都来自map<code>$themes</code>，这里使用到了<code>map-has-key()</code>方法。如果包含了key那就继续往下执行，否则抛出错误给开发者。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// _m-buttons.scss</span><br><span class="line">// 2.Base</span><br><span class="line">.m-button &#123;</span><br><span class="line">  @each $key, $value in $themes &#123;</span><br><span class="line">    @if map-has-key($config, $key) &#123;</span><br><span class="line">      .#&#123;$value&#125; &amp; &#123;</span><br><span class="line">        background: setStyle($config, $key, background);</span><br><span class="line">        color: setStyle($config, $key, color);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; @else &#123;</span><br><span class="line">      @warn "The key `#&#123;$key&#125; isn't defined in the map $config`"</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过上面的代码，让我们看看输出的结果。这是非常好的，保证了配置区域跟模块解耦。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">.theme-light</span> <span class="class">.m-button</span> <span class="rules">&#123;</span><br><span class="line">  <span class="rule"><span class="attribute">background</span>:<span class="value"> <span class="hexcolor">#f2f2f2</span></span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">color</span>:<span class="value"> <span class="hexcolor">#000</span></span></span>;</span><br><span class="line">&#125;</span></span><br><span class="line"><span class="class">.theme-dark</span> <span class="class">.m-button</span> <span class="rules">&#123;</span><br><span class="line">  <span class="rule"><span class="attribute">background</span>:<span class="value"> <span class="hexcolor">#666</span></span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">color</span>:<span class="value"> <span class="hexcolor">#fff</span></span></span>;</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<p>最后你可以自己试试上面的代码看能不能运行出结果。也许对于你来说这个方案并不是最好的，你会寻求另外的方案，但是我依然希望这能够帮助你维持代码。</p>
<h2 id="最后思考">最后思考</h2><p>在我看来 <code>Sass Maps</code>是Sass 3.3最值得介绍的特性。理由是我认为它给出了非常好的方式来创建健壮的结构，这只需要少量的配置。Sass maps使得我们可以在不影响整个项目的基础逻辑代码基础上改变值。开始使用它吧，你的伙伴将会感激你！</p>
<p>如果你已经开始使用<code>Sass maps</code>了，让我知道你如何在你的项目中使用它！</p>
<ul>
<li>注1: 截至译文的Sass最新版本是3.4.19</li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<blockquote>
<p>本文翻译自<a href="http://webdesign.tutsplus.com/tutorials/an-introduction-to-sass-maps-usage-and-examples--cms-22184">An Introduction to Sass Maps:Usage and Examples</a></p>
</blockquote>]]>
    
    </summary>
    
      <category term="sass" scheme="http://aotu.io/tags/sass/"/>
    
      <category term="sass maps" scheme="http://aotu.io/tags/sass-maps/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Adobe edge animate制作HTML5动画]]></title>
    <link href="http://aotu.io/notes/2015/12/04/edgeAnimate/"/>
    <id>http://aotu.io/notes/2015/12/04/edgeAnimate/</id>
    <published>2015-12-03T22:05:18.000Z</published>
    <updated>2015-12-07T02:38:28.000Z</updated>
    <content type="html"><![CDATA[<p>Edge Animate是Adobe出品的制作HTML5动画的可视化工具，简单的可以理解为HTML5版本的Flash Pro。Adobe Edge Animate的目的是帮助专业设计师制作网页动画乃至简单游戏。目前该工具的重点放在动画引擎上，将增加更多HTML5功能，比如Canvas、HTML5音频/视频标签等。支持Android、iOS、webOS、黑莓PlayBook、Firefox、Chrome、Safari和IE9等各个平台。</p>
<p>Edge Animate主要使用HTML5,CSS3和JavaScript。HTML5是其用于创建的doctype，2D的transform，translate，rotate，scale，skew等特效都是渲染为CSS3，如果是最新版本的浏览器，可以操作纯粹的CSS3，如果是主流大众浏览器，Edge Animate则会通过JavaScript库的配合来保证HTML和CSS的显示兼容性。<br><a id="more"></a></p>
<h2 id="Adobe_edge_animate_CC功能">Adobe edge animate CC功能</h2><p>1.精确的动画。<br>2.直觉化的使用者界面。<br>3.绘图和文字工具。<br>4.移动路径。<br>5.可重复使用的符号。<br>6.兼容性比较不错，android机也表现良好。<br>单一使用做html5 css3动画，带来了巨大的福音。</p>
<h2 id="Adobe_edge_animate_CC缺点">Adobe edge animate CC缺点</h2><p>1.不太适合，做复杂的动画与游戏，适用场景狭窄。<br>2.操作比较适合设计师，不适合程序员，操作效率不高，调节不是特别可控。<br>3.采用html5 css3相关的动画，频繁产生重排导致效率低下。<br>4.动画元素层级绝对定位，后期维护增加元素，层级覆盖影响较大。<br>5.比较适合pc端动画制作，移动端需要进行二次转换，scale进行缩放已达到多屏适配的问题。</p>
<h2 id="Adobe_edge_animate下载地址">Adobe edge animate下载地址</h2><p><a href="http://example.net/" target="_blank" rel="external">mac 环境下下载</a>  &nbsp;&nbsp;   <a href="http://example.net/" target="_blank" rel="external">window 环境下下载</a> </p>
<p>在开始玩Edge Animate前，你可能有个顾虑，就是Edge Animate如果要做交互动画，生成的内容是否会打破已有的HTML文件代码结构？答案是不会。通过Edge Animate生成的HTML代码少之又少，几乎都可以用下面的代码表达方式来概述：<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="keyword">div</span> <span class="property">id</span>=”Stage” <span class="type">class</span>=”EDGE-xxxxxxxxxx”&gt;&lt;/<span class="keyword">div</span>&gt;</span><br></pre></td></tr></table></figure></p>
<p>Edge Animate使用JSON来存储元素的定义和属性。相关的动画内容则会全部以代码块的形式嵌入上面的div中，修改和删除都不会影响原有的HTML项目代码，对HTML中元素的操作都通过JSON对象和引入的JavaScript来完成。但是有一点，edge动画对html元素的动画操作，会导致浏览器频繁重排，降低效率。</p>
<p>创建edge animation 工程<br>启动Edge Animate，创建一个新项目ctrl＋N/command+N。<br></p><p class="user_img"><img src="/img/post/pfan/edge/1.jpg"></p><br>设定Stage（舞台）宽度为640px, 高度为1136px。Ctrl+S保存为demo.html。打开我们保存的项目目录，一个标准的Edge Animate项目是由一系列html,css,js和相关资源文件组成的。如下图所示：<br><p class="user_img"><img src="/img/post/pfan/edge/2.jpg"></p><br>1)Edge Animate的工程文件: .an 格式文件更像一个空壳文件或者索引文件，标明了项目的必要信息。你可以使用记事本打开.an文件了解其中具体内容。<br>2)edge_includes目录：该目录下是Edge制作的html5所依赖的JS类库：edge.6.0.0.min.js 115kb,还是蛮大的。(之前的版本有依赖jquery，再5.0之后就去掉了，产生了自有库，写法参展jquery)。<br>3)其他.js文件：诸如demo1_edgeActions.js，demo1_edge.js等js文件是专门针对当前动画所生成js文件。<br>4).html文件：主html文件。<p></p>
<p>Edge Animate的工具界面默认情况下包含了7个Window面板，均可以通过菜单的Window选项开启和关闭，分别是Tools工具，Properties属性，Stage场景，Elements元素，Library库，Timeline时间轴，代码管理和lessons课程。接下来，简单的让大家了解一下，edge animation的属性面包，元素面板，时间轴runtime，代码管理器，这些是我们经常会用到的。</p>
<p>edge animation 属性面板<br>Adobe Edge Animate的强大之处在于它能获得舞台中元素的标签（即ID）和这个元素样式属性（CSS）的变化，并将这些变化在时间线上以关键帧的形式“标记”。这样必然导致关键帧之间属性值的变化，这个中间阶段会被转化为一个过渡阶段，或者说一段动画（如图片透明度Opacity的变化，淡入淡出、一个元件的移动Location和缩放Scale等等）。<br></p><p class="user_img"><img src="/img/post/pfan/edge/3.jpg"></p><p></p>
<p>edge animation 元素面板<br>Adobe Edge Animate元素面板显示的是节点式的树形结构，表示元素与父元件Stage的联系。这点与ps，flash都比较类似。<br>放置（或堆叠）在上方的元素具有更高的Z-index值，会显示在其他元素（堆叠在下方的元素）上方。<br></p><p class="user_img"><img src="/img/post/pfan/edge/4.jpg"></p><p></p>
<p>edge animation 时间轴runtime<br>Adobe Edge Animate的时间线融合了元素的节点式树状结构和与元素属性关联的关键帧，这些信息显示在时间线左侧，而右侧则显示时间信息表。元素属性值（关键帧）被标记在时间线确切的时间点，当属性值发生改变时，过渡阶段会产生动画。<br>1.动画标签（Label）和触发器（Trigger）：自定义的时间线动画标签和触发器也可以控制舞台中元素动画的状态和处理方法；使用Ctrl/Command + L可以在播放头所在时间点生成一个动画标签，使用Ctrl/Command + T可以在播放头所在时间点放置一个触发器。<br>2.仅显示具有动画的元素（Filter Animated Elements）<br>3.启用时间线吸附功能（Enable Timeline Snapping）：拖动播放头，播放头将会自动吸附到时间点、动画或关键帧等<br>4.启用时间线网格（Enable Timeline Grid）：时间信息表上将会显示时间网格，方便设计者在确切时间点设定关键帧等，网格的大小可用户自定义。<br>5.自动记录关键帧模式（Auto Keyframe Mode（K））：开启模式下，设计者对元素所做的属性值修改都会以关键帧的形式记录在时间线上。<br>6.自动生成动画模式（Auto Transition Mode（X））：开启模式下，在两个关键帧之间会自动生成动画，默认开启。<br>7.播放标记（Toggle Pin（P））：可以设置播放的起始和终止位置。<br></p><p class="user_img"><img src="/img/post/pfan/edge/5.jpg"></p><p></p>
<p>edge animation 代码管理<br>代码管理器使用一个单独完整的窗口界面来展示所有事件控制代码和时间线触发器。（快捷键Ctrl/Command + E或者通过菜单Window-Code打开）所被编辑的控制代码或触发器会被高亮显示。<br>1.点击“+”图标添加全局、局部、时间线控制代码或者触发器；<br>2.点击“Full Code”按钮可以显示并编辑单个文件的全部代码，而不仅仅是单个功能函数内部代码；<br>3.可以通过下方的代码错误提示窗进行错误快速排除检测。<br></p><p class="user_img"><img src="/img/post/pfan/edge/6.jpg"></p><p></p>
<h2 id="实例操作">实例操作</h2><p>当我们了解以上这些知识点，之后，我们来做一下简单的实例，实现顶部图片我们所看到的界面，人物跑动，背景向前移动。</p><p class="user_img"><img src="/img/post/pfan/edge/7.jpg"></p><p></p>
<h2 id="第一部分_使用SpriteSheet在Edge_Animate中制作人物跑动的动画">第一部分 使用SpriteSheet在Edge Animate中制作人物跑动的动画</h2><p>1.启动Edge Animate，创建一个新项目blackfriday，设置stage大小为640*1136；</p>
<p>2.导入blackfriday SpriteSheet　<br>点击菜单“File-&gt;Import”,或者快捷键Ctrl+I / Command+I，来导入blackfriday_sprite.png到舞台。在舞台上选中导入的图片，在左边栏Position and Size栏目下，设定其X坐标值=160px,y坐标值为330px，保证第一个smurf的位置在舞台最左侧并垂直居中。</p>
<p>3.使用Clip切割Spritesheet，显示单一Sprite元素<br>我们导入的蓝精灵Spritesheet是320*480大小的透明背景png图片，一共描绘了32个蓝精灵行走的姿态。通过序列播放这32个行走姿态，就可以制作一个完整蓝精灵行走动画。<br>首先，要在舞台上只显示一个Sprite元素，比如最左上角的第一个蓝精灵。在Edge Animate左侧属性面板中，倒数第二个栏目是clip子面板。顾名思义，clip功能区可以帮助我们“切割”舞台上的元素，比如图片。该功能区实际上利用了CSS的clip属性。<br>点击clip子面板的开关按钮，可以激活clip功能。使用鼠标，可以在clip属性设定面板上的上、下、左、右属性值上滑动，你可以在舞台上实时看到“切割”的图片情况。如下图。 在本例中，请设定clip的top，right，bottom，left属性值分别为0, 320,480,0。<br></p><p class="user_img"><img src="/img/post/pfan/edge/8.jpg"></p><p></p>
<ol>
<li>创建32个Keyframe，实现行走动作<br>接下来，我们创建32个帧来完成蓝精灵行走的动作。<br>1) 调整帧间隔<br>在舞台下方的时间轴上，Edge Animate用竖线网格标记了每帧间距。在Smurf行走动画中，我们希望在1毫秒的时间左右完成一个行走动作，即32帧。因此，我们需要通过时间轴下方的Gird Size图标调整时间轴为30帧/秒。如下图：<p class="user_img"><img src="/img/post/pfan/edge/9.png"></p>
2) 激活“Auto-Keyframe Mode (自动创建帧)”<br>Edge Animate有三个非常重要的按钮分别开启Auto-Keyframe Mode（自动创建关键帧）、Auto-Transition Mode和Toggle Pin（大头针）。图标如下图：<p class="user_img"><img src="/img/post/pfan/edge/10.png"></p>
Edge Animate Buttons<br>本例中，我们将启用Auto-Keyframe Mode，而关闭Auto-Transition Mode和Pin。在启用Auto-Keyframe Mode的情况下，每当我们在新的一帧修改舞台中元素的属性，Edge Animate会自动在此创建关键帧。由于我们关闭了Auto-Transition Mode，因此Edge Animate将不会自动在关键帧之间创建过渡效果。<br>3) 创建第一个关键帧<br>在时间轴上，把播放头移到0:00秒位置，选中舞台中的蓝精灵，在左边属性面板中的Image子面板下，确认Background Image的x和y属性值为0，然后点击x和y属性边上的小菱形符号（当鼠标移到该菱形符号时，其变为黄色，并显示tips：“Add Keyframe for Background Position”），此时Edge Animate将在时间轴的0:00秒出创建第一个关键帧。如下图<p class="user_img"><img src="/img/post/pfan/edge/11.jpg"></p>
依此方法，在gard线上接着做31个帧。</li>
</ol>
<p>5。创建完成后，预览：<br>使用快捷键Ctrl+Enter/Command+Enter，可以启动默认浏览器看起运行的效果.<br>现在，人物已经实现了行走动作，但是还没有完成行进，还不循环播放，运行完32个帧就停止了。</p>
<p>6.转换为元件在最后一帧，设置trigger触发器，达到帧循环动画<br>在舞台上选中该图片后，快捷键Cmd+Y/Ctrl+Y将其转换成一个元件(Symbol)，叫us，然后删除stage舞台上面的元素，从library面板里面拖动stage舞台上面 。双击元件，进入元件舞台区域，如图，insert trigger：<br></p><p class="user_img"><img src="/img/post/pfan/edge/12.jpg"></p><br><p class="user_img"><img src="/img/post/pfan/edge/13.png"></p><p></p>
<h2 id="第二部分_实现背景的滚动">第二部分 实现背景的滚动</h2><p>1.倒入背景图片，生成元件<br>快捷键Cmd+I/Ctrl+I导入背景图片american.png，在舞台上选中该图片后，快捷键Cmd+Y/Ctrl+Y将其转换成一个元件(Symbol)，命名为americanbg2。<br>2.激活Auto-Keyframe Mode，Auto-transition Mode，平移背景图片形成单循环的过渡动画。<br>但是当背景向左移出舞台的时候，会看到舞台空出了部分<br>3.实现背景图循环滚动的效果<br>再次向舞台导入元件，命名为americanbg4.拷贝americanbg2的运动动画，到americanbg2左移舞台出现空白的临界点帧时间，给americanbg4粘贴动画效果。因为我们不需要americanbg4整体效果，所以需要删除americanbg4运动帧超出americanbg2运动帧的结束点。<br></p><p class="user_img"><img src="/img/post/pfan/edge/14.jpg"></p><br>4.最后一帧，设置trigger触发器，形成循环动效<p></p>
<h2 id="第三部分_增加音乐，闪烁星空">第三部分 增加音乐，闪烁星空</h2><p>这一部分，基本参照第一二部分的我们就可以完成整个动画，有一点需要注意设置playback，做初始延迟。</p>
<h2 id="第四部分_处理移动端的适配，增加loading">第四部分 处理移动端的适配，增加loading</h2><p>由于这里出来的动画是640x1136px出来的效果，实现多终端预览时，需要做适配处理，这里我是采用scale进行缩放，已到达统一的效果。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">var</span> c=<span class="built_in">document</span>.documentElement,d=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">var</span> b=c.getBoundingClientRect().width;s=(<span class="number">640</span>&lt;=b?<span class="number">640</span>:b)/<span class="number">640</span>,<span class="built_in">document</span>.write(<span class="string">'&lt;style id="scaleCon"&gt;.o2-scale&#123;-webkit-transform: scale('</span>+s+<span class="string">"); transform: scale("</span>+s+<span class="string">");-webkit-transform-origin:0% 0%;transform-origin:0% 0%;&#125;&lt;/style&gt;"</span>);<span class="built_in">window</span>.addEventListener(<span class="string">"resize"</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">var</span> e=c.getBoundingClientRect().width;s=(<span class="number">640</span>&lt;=e?<span class="number">640</span>:e)/<span class="number">640</span>;<span class="built_in">document</span>.getElementById(<span class="string">"scaleCon"</span>).innerHTML=<span class="string">".o2-scale&#123;-webkit-transform: scale("</span>+s+<span class="string">"); transform: scale("</span>+s+<span class="string">");-webkit-transform-origin:0% 0%;transform-origin:0% 0%;&#125;"</span>&#125;)&#125;;d()&#125;)();</span><br></pre></td></tr></table></figure></p>
<p>我们只需要把class类o2-scale，添加给舞台就可以，完成适配。</p>
<p><a href="http://pingfan1990.sinaapp.com/jdcase/blackfriday/" target="_blank" rel="external">demo演示效果</a><br>手机扫描：<br></p><p class="user_img"><img src="/img/post/pfan/edge/15.jpg"></p><br>ios，android亲测，效果还是比较流畅的。<p></p>
<h4 id="参考资料：">参考资料：</h4><p><a href="http://www.adobe.com/devnet-docs/edgeanimate/api/current/index.html#audio" target="_blank" rel="external">Adobe Edge Animate CC 2014 JavaScript API 5.0</a><br><a href="https://helpx.adobe.com/edge-animate/how-to/edge-animate-symbols.html" target="_blank" rel="external">Adobe Edge Animate 视频教程</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>Edge Animate是Adobe出品的制作HTML5动画的可视化工具，简单的可以理解为HTML5版本的Flash Pro。Adobe Edge Animate的目的是帮助专业设计师制作网页动画乃至简单游戏。目前该工具的重点放在动画引擎上，将增加更多HTML5功能，比如Canvas、HTML5音频/视频标签等。支持Android、iOS、webOS、黑莓PlayBook、Firefox、Chrome、Safari和IE9等各个平台。</p>
<p>Edge Animate主要使用HTML5,CSS3和JavaScript。HTML5是其用于创建的doctype，2D的transform，translate，rotate，scale，skew等特效都是渲染为CSS3，如果是最新版本的浏览器，可以操作纯粹的CSS3，如果是主流大众浏览器，Edge Animate则会通过JavaScript库的配合来保证HTML和CSS的显示兼容性。<br>]]>
    
    </summary>
    
      <category term="animate" scheme="http://aotu.io/tags/animate/"/>
    
      <category term="edge animate" scheme="http://aotu.io/tags/edge-animate/"/>
    
      <category term="html5" scheme="http://aotu.io/tags/html5/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[使用ThreeJS在浏览器中展示3D物件]]></title>
    <link href="http://aotu.io/notes/2015/11/24/3D-CleaningCream/"/>
    <id>http://aotu.io/notes/2015/11/24/3D-CleaningCream/</id>
    <published>2015-11-24T13:00:35.000Z</published>
    <updated>2015-12-10T02:02:53.000Z</updated>
    <content type="html"><![CDATA[<p>这是一篇介绍如何在浏览器中展示<del style="background-color: #333!important;color: #333 !important;">洗面奶</del>3D物件的文章。<br><a id="more"></a> </p>
<h3 id="前言">前言</h3><p>这篇文章仅仅是向你介绍应对下面这种的场景的方法：如果有人突然跟你说，你的皮肤挺不错的耶，你用的什么洗面奶，我也想买一个，你会怎么回答呢？手头又没法拿出你的洗面奶给他看，光凭言语无法准确地形容出你的洗面奶到底长什么样。作为前端的程序猿，我会想，这种时候如果可以有一个链接让对方自己去看一下把玩一下，对方势必会对你的洗面奶<del style="background-color: #333!important;color: #333 !important;">高Bigger</del>有更深刻的认识。本文的目的，就是向屏幕对面的程序猿介绍这种高效<del style="background-color: #333!important;color: #333 !important;">搞笑</del>的方式。</p>
<h3 id="走进3D的世界">走进3D的世界</h3><p>在页面里面放几个图片是完全无法满足让观看者自己看自己把玩的要求的。所以这里我们将会使用3D的形式来展现我们的洗面奶。老话说得好，同样是山，却有横看成岭侧成峰的不同。比起2D渲染，3D渲染多了一个维度，由于透视效果，物体遮挡、光照角度、光的反射折射等的存在，观看者在不同的角度观看会得到不同的结果。</p>
<p>在浏览器里面，CSS3提供了3D变换的相关属性，但对于光照相关的需求却是无能为力。而使用Canvas进行绘制的话，如果不依赖封装好的图形库，进行图形变换又是相当麻烦的事情。就算是在CSS中一个简单的2D旋转或者是放大，在Canvas的像素操作中，我们还需要通过矩阵计算才能知道变换后每个像素的位置。正因如此，图形库出现了。</p>
<p>说到图形库，我们不得不提到<a href="http://www.opengl.org" target="_blank" rel="external">OpenGL</a>。OpenGL是一个跨平台的图形编程规范，定义了2D与3D绘制中所需要各种接口，进行图形绘制中所需要的变换，纹理映射，光照等。OpenGL定义的接口很多是为硬件加速设计的。有了各大硬件厂商的支持，OpenGL的渲染效率比起软件渲染高了不止一点点。同时，OpenGL不局限于某平台或者是语言，它只是一个关于图形渲染的规范，对外提供关于图形渲染的各种接口，所以有许多的语言绑定，而在浏览器中用到的是Javascript的绑定WebGL。</p>
<h3 id="ThreeJS">ThreeJS</h3><p><a href="http://threejs.org/" target="_blank" rel="external">ThreeJS</a>是一款在浏览器中进行3D绘制的Javascript库，为使用canvas绘制，WebGL渲染等图形操作提供了简便的API。到底有多简便？在<a href="http://www.pixijs.com" target="_blank" rel="external">PixiJS</a>等2D绘制库中，我们需要场景+物件+贴图来搞定一张图，而在ThreeJS中我们只需要在这基础上额外添加适当光照与一台照相机而已，下面是一个最简单的Demo，绘制了一个旋转的绿色立方体。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> scene = <span class="keyword">new</span> THREE.Scene();</span><br><span class="line"><span class="comment">/*创建场景*/</span></span><br><span class="line"><span class="keyword">var</span> camera = <span class="keyword">new</span> THREE.PerspectiveCamera( <span class="number">75</span>, <span class="built_in">window</span>.innerWidth/<span class="built_in">window</span>.innerHeight, <span class="number">0.1</span>, <span class="number">1000</span> );</span><br><span class="line"><span class="comment">/*创建照相机*/</span></span><br><span class="line"><span class="keyword">var</span> renderer = <span class="keyword">new</span> THREE.WebGLRenderer();</span><br><span class="line"><span class="comment">/*创建渲染器*/</span></span><br><span class="line">renderer.setSize( <span class="built_in">window</span>.innerWidth, <span class="built_in">window</span>.innerHeight );</span><br><span class="line"><span class="built_in">document</span>.body.appendChild( renderer.domElement );</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> geometry = <span class="keyword">new</span> THREE.BoxGeometry( <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span> );</span><br><span class="line"><span class="comment">/*创建几何模型*/</span></span><br><span class="line"><span class="keyword">var</span> material = <span class="keyword">new</span> THREE.MeshBasicMaterial( &#123; color: <span class="number">0x00ff00</span> &#125; );</span><br><span class="line"><span class="comment">/*创建材质*/</span></span><br><span class="line"><span class="keyword">var</span> cube = <span class="keyword">new</span> THREE.Mesh( geometry, material );</span><br><span class="line"><span class="comment">/*几何模型与材质合成为物件*/</span></span><br><span class="line">scene.add( cube );</span><br><span class="line"><span class="comment">/*将物件添加入场景*/</span></span><br><span class="line"></span><br><span class="line">camera.position.z = <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> render = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">	requestAnimationFrame( render );</span><br><span class="line">	cube.rotation.x += <span class="number">0.1</span>;</span><br><span class="line">	cube.rotation.y += <span class="number">0.1</span>;</span><br><span class="line">	renderer.render(scene, camera);</span><br><span class="line">	<span class="comment">/*渲染出在相机camera中看到的scene场景*/</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">render();</span><br></pre></td></tr></table></figure>
<p>画出来就像这样子：<br></p><p class="user_img"><img src="/img/post/Littly/rollingCube.png" alt="旋转立方体"></p><p></p>
<p>ThreeJS中提供了少量基础的几何模型，如长方体(Box3)，球体(Sphere)等，但面对我们要实现的洗面奶还是太小儿科了。这是不是说明我们的洗面奶没办法做了？文章都写到这里了，办法肯定是有的。ThreeJS提供了加载外部模型的模块(Loader)，可以加载外部的Obj，json等格式的模型。另外，ThreeJS的<a href="https://github.com/mrdoob/three.js/tree/master/utils/exporters" target="_blank" rel="external">Github仓库</a>中还提供了在3ds Max、Blender等3D绘制软件中导出模型的工具。是的，我们就可以用别的3D建模软件建模再导出成ThreeJS所需要的格式了。</p>
<h3 id="动手">动手</h3><p>我们这里使用的是建模工具是Blender。我们需要先拍下物体的三视图作为建模的参考。导入Blender后，依据三视图，我们很快就可以建出洗面奶的模型。</p>
<p>模型的样子<br></p><p class="user_img"><img src="/img/post/Littly/modeling.png" alt="建模"></p><p></p>
<p>在Blender中加上ThreeJS的插件之后，我们可以在Blender的文件菜单中见到Export/Three.js(.json)选项。点击之后，选择导出的目录，然后记得在左下角勾上我们要导出的元素。在这个例子中，我们需要导出的是Scene，也就是场景本身。<br></p><p class="user_img"><img src="/img/post/Littly/exporting.jpg" alt="导出菜单"></p><p></p>
<p>在ThreeJS中进行导入的操作也十分简单。ThreeJS中提供了许多种类的Loader，分别针对不同的使用需求。比如，JSONLoader针对的是.json格式的模型，OBJLoader针对的是.obj格式的模型等等。翻阅网上资料的时候还可以看到SceneLoader的踪影，这就是用来加载整个场景的.json格式文件的。可是在ThreeJS的新版本中，SceneLoader已经被废弃，取而代之的是更为牛叉更为智能的ObjectLoader。ObjectLoader可以判断导出的模型到底是什么种类，从而将它们转化为ThreeJS中的对应对象便于开发者使用。</p>
<p>在这个例子中，我们导出的.json文件中包含的是场景本身。所以，除了需要添加部分ObjectLoader的代码，其余部分的代码甚至比上面那个例子还要简单：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> scene,</span><br><span class="line">	camera,</span><br><span class="line">	renderer,</span><br><span class="line">	loader,</span><br><span class="line">	wid,</span><br><span class="line">	hei,</span><br><span class="line">	animate;</span><br><span class="line">	</span><br><span class="line">animate = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">	renderer.render(scene, camera);</span><br><span class="line">	requestAnimationFrame(animate);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">wid = <span class="built_in">window</span>.innerWidth;</span><br><span class="line">hei = <span class="built_in">window</span>.innerHeight;</span><br><span class="line">camera = <span class="keyword">new</span> THREE.PerspectiveCamera(<span class="number">45</span>, wid / hei, <span class="number">1</span>, <span class="number">1000</span>);</span><br><span class="line"><span class="comment">/*创建照相机*/</span></span><br><span class="line"></span><br><span class="line">camera.position.set(<span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>);</span><br><span class="line">camera.lookAt(<span class="keyword">new</span> THREE.Vector3(-<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">renderer = <span class="keyword">new</span> THREE.WebGLRenderer();</span><br><span class="line">renderer.setSize(wid, hei);</span><br><span class="line"></span><br><span class="line">loader = <span class="keyword">new</span> THREE.ObjectLoader();</span><br><span class="line"><span class="comment">/*创建ObjectLoader*/</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">document</span>.body.appendChild(renderer.domElement);</span><br><span class="line"></span><br><span class="line">loader.load(<span class="string">'objs/object.json'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">_sce</span>) </span>&#123;</span><br><span class="line">	scene = _sce;</span><br><span class="line">	scene.add(camera);</span><br><span class="line">	animate();</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">/*加载Scene，成功后执行回调开始动画*/</span></span><br></pre></td></tr></table></figure>
<p>浏览器中一看，却不太对劲。形状对了，可是颜色呢？高端黑的洗面奶怎么就变成这么山寨的颜色了，而且每次刷新都变颜色。活了二十几年，小便表示还真没见到过这样的洗面奶。</p>
<p class="user_img"><img src="/img/post/Littly/neverseen.png" alt="跑马灯"></p>
<p>出现这种情况，毫无疑问是材质的问题。原来我们在建模软件中还没给洗面奶加过材质，所以ThreeJS加载完我们的.json文件后，发现只有模型却没有材质，就给模型加上了一个随机颜色的材质。解决办法也很简单，在ThreeJS中手动贴上贴图就好了。而更简单且有效的办法是，在建模软件中上好贴图再一起导出。</p>
<p>回到Blender中，将洗面奶的表面进行UV展开后导出展开图后，我们新建一张图片，将我们要贴的图放到展开图上的相应位置，再回到Blender中将这张新的图片设为瓶身的材质。渲染一下，检查到效果无误后，将模型导出。这次要记得将左下角的Materials勾上，另外还需要勾上texture的复选框。</p>
<p>将这次导出的模型放到先前的目录下，我们会发现，浏览器中并没有出现想象中的场景。在控制台中可以看到，由于我们没有将贴图一起放到一个目录下，贴图加载失败了。按照要求放好后，我们会更惊奇地发现，浏览器中除了一片黑，什么都没有。这是为什么呢？<br></p><p class="user_img"><img src="/img/post/Littly/dark.png" alt="一片黑"></p><p></p>
<blockquote>
<p>神说要有光，所以就有了光。</p>
</blockquote>
<p>在3D的世界中，光是非常重要的存在。我们之所以能看见物体，都是因为有光进入了我们的眼球。除去本身会发光的物体，我们能看见的其他的物体，都是因为这些物体将外界的光反射后进入我们眼球了。换句话说，没有光的话我们就什么都看不到。</p>
<p>在ThreeJS中也是如此。如果没有光，我们就看不到自发光以外的材质，视野中将是一片黑。在ThreeJS中，光照也有很多种：全局光照(AmbientLight),有向光(DirectionalLight)，点光源(PointLight)等。在这个例子中，为了360观看整个物体，我们添加一个全局光照。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> light = <span class="keyword">new</span> THREE.AmbientLight( <span class="number">0xffffff</span> );</span><br><span class="line">scene.add( light );</span><br></pre></td></tr></table></figure>
<p>再刷新一下，就可以看见我们的洗面奶了。大功告成!<br></p><p class="user_img"><img src="/img/post/Littly/completed.png" alt="成功~"></p><p></p>
<h3 id="小结">小结</h3><p>进行3D建模，将物体在浏览器中展示，目前已经有了不少的应用，有的公司在宣传新产品的时候会使用上这样的技术，让消费者可以在浏览器中亲自把玩产品，观察产品的每个小角落，起到了不错的效果。同样的技术并不只是在展示商品的时候能用上。将适当的全景图贴在立方体的内表面，用户视角置于立方体中心点的话，还可以让用户有置身其境的感觉，可以上下左右转动视角观察一个地点周围的景象，做出街景的效果。可以说，浏览器中的3D技术将会有越来越多的用武之地。</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>这是一篇介绍如何在浏览器中展示<del style="background-color: #333!important;color: #333 !important;">洗面奶</del>3D物件的文章。<br>]]>
    
    </summary>
    
      <category term="three.js" scheme="http://aotu.io/tags/three-js/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[精致化页面重构]]></title>
    <link href="http://aotu.io/notes/2015/11/24/project-summary/"/>
    <id>http://aotu.io/notes/2015/11/24/project-summary/</id>
    <published>2015-11-23T20:23:44.000Z</published>
    <updated>2015-12-10T02:02:53.000Z</updated>
    <content type="html"><![CDATA[<a id="more"></a>
<h2 id="一_布局方式">一 布局方式</h2><p>作为一个注重用户体验的 H5 页面，合适的页面布局方式很重要。<br>移动端页面常规布局基本分两种：</p>
<h3 id="1-_流式布局（响应式宽度自适应布局）">1. 流式布局（响应式宽度自适应布局）</h3><p>这是普遍使用的方法，流式布局使用这个标签即可自适应所有尺寸的屏幕。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">meta</span> <span class="attribute">name</span>=<span class="value">"viewport"</span> <span class="attribute">content</span>=<span class="value">"width=device-width,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>优点：响应式、简单、兼容好。<br>缺点：非设计稿尺寸屏幕展现效果可能不是很理想。</p>
<h3 id="2-_版式布局（页面等比缩放布局）">2. 版式布局（页面等比缩放布局）</h3><p><strong>可行方案：</strong></p>
<ol>
<li>页面使用 REM 作为页面数值单位运算。</li>
<li>通过 zoom/scale 整体缩放页面。</li>
</ol>
<p>优点：页面等比缩放，比例与设计稿一致。<br>缺点：大屏手机等比放大后的体验可能不佳。</p>
<h3 id="结论：">结论：</h3><p>两种布局方式各有优劣，项目最终选用流式布局，原因：</p>
<ol>
<li>部分页面还是与现有项目模块共用，版式布局改动成本偏高，不好维护。</li>
<li>考虑到页面在大屏手机等比放大后的体验可能不佳。</li>
<li>流式布局可以针对大屏手机做一些更灵活的排版（配合媒体查询），达到更好的用户体验。</li>
</ol>
<h2 id="二_设计规范">二 设计规范</h2><p>设计规范也是重要元素之一，条件允许情况下，从开发前期就需要跟设计师达成共识制定了一套设计规范。</p>
<p><strong>设计规范需要包括：</strong><br>页面背景色、文字颜色、边框颜色、各种按钮样式、图标等等全局通用样式。</p>
<p class="user_img"><img src="/img/post/liqinuo/1.png"></p>
<p>当然除了前期到设计规范，开发过程中这边也需要分离出一些可复用的组件、公共样式，包括：<br>公共底部、商品组模块、轮播组件等等。</p>
<h2 id="三_技巧">三 技巧</h2><h3 id="1-_还原设计稿的_0-5px">1. 还原设计稿的 0.5px</h3><blockquote>
<p>在 2014 年的 WWDC，“设计响应的 Web 体验” 一讲中，Ted O’Connor 讲到关于“retina hairlines”（retina 极细的线）：在 retina 屏上仅仅显示 1 物理像素的边框。</p>
</blockquote>
<p>简单点说就是：在 Retina 屏的设备上，1px 其实相当于  2 个物理像素，所以 1 个物理像素 = 0.5px。</p>
<p class="user_img"><img src="/img/post/liqinuo/2.png"></p>
<p>实现 0.5px 有很多种方法，这里比较一下各种处理的优缺点：</p>
<h4 id="1-_iOS8_以上支持_0-5px">1. iOS8 以上支持 0.5px</h4><p>实现原理：常规属性。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">.border</span> <span class="rules">&#123;</span><br><span class="line">    <span class="rule"><span class="attribute">border</span>:<span class="value"> <span class="number">0.5px</span> solid red</span></span>;</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<p>优点：原生、简单、常规写法。<br>缺点：目前只有 iOS8 以上系统才能支持，iOS7及以下、安卓系统都显示为 0px，可以通过脚本判断系统然后区分处理。</p>
<h4 id="2-_CSS_渐变模拟">2. CSS 渐变模拟</h4><p>实现原理：设置 1px 通过 css 实现的背景图片，50%有颜色，50%透明。<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">.border</span> <span class="rules">&#123;</span><br><span class="line">    <span class="rule"><span class="attribute">background-image</span>:<span class="value"><span class="function">linear-gradient</span>(<span class="number">180deg</span>, red, red <span class="number">50%</span>, transparent <span class="number">50%</span>), <span class="function">linear-gradient</span>(<span class="number">270deg</span>, red, red <span class="number">50%</span>, transparent <span class="number">50%</span>), <span class="function">linear-gradient</span>(<span class="number">0deg</span>, red, red <span class="number">50%</span>, transparent <span class="number">50%</span>), <span class="function">linear-gradient</span>(<span class="number">90deg</span>, red, red <span class="number">50%</span>, transparent <span class="number">50%</span>)</span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">background-size</span>:<span class="value"> <span class="number">100%</span> <span class="number">1px</span>, <span class="number">1px</span> <span class="number">100%</span>, <span class="number">100%</span> <span class="number">1px</span>, <span class="number">1px</span> <span class="number">100%</span></span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">background-repeat</span>:<span class="value"> no-repeat</span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">background-position</span>:<span class="value"> top, right top, bottom, left top</span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">padding</span>:<span class="value"> <span class="number">10px</span></span></span>;</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure></p>
<p>优点：兼容性较好，单边框、多边框可实现，大小、颜色可配置。<br>缺点：代码量多、无法实现圆角、同时占用了背景样式</p>
<h4 id="3-_阴影">3. 阴影</h4><p>实现原理：利用 css 对阴影处理的方式模拟。<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">.border</span> <span class="rules">&#123;</span><br><span class="line">    <span class="rule"><span class="attribute">-webkit-box-shadow</span>:<span class="value"> <span class="number">0</span> <span class="number">1px</span> <span class="number">1px</span> -<span class="number">1px</span> <span class="function">rgba</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0.5</span>)</span></span>;</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure></p>
<p>优点：兼容性较好，单边框、多边框、圆角可实现，大小、颜色、可配置。<br>缺点：模拟效果强差人意，颜色不好配置。</p>
<h4 id="4-_viewport_+_rem">4. viewport + rem</h4><p>实现原理：通过设置页面 viewport 与对应 rem 基准值。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- devicePixelRatio = 2：--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">meta</span> <span class="attribute">name</span>=<span class="value">"viewport"</span> <span class="attribute">content</span>=<span class="value">"initial-scale=0.5, maximum-scale=0.5, minimum-scale=0.5, user-scalable=no"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- devicePixelRatio = 3：--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">meta</span> <span class="attribute">name</span>=<span class="value">"viewport"</span> <span class="attribute">content</span>=<span class="value">"initial-scale=0.3333333333333333, maximum-scale=0.3333333333333333, minimum-scale=0.3333333333333333, user-scalable=no"</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>优点：兼容比较好，写法跟常规写法无异。<br>缺点：老项目改用 rem 单位成本较高。</p>
<h4 id="5-_border-image">5. border-image</h4><p>实现原理：通过图片配合边框背景模拟。<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">.border-image</span><span class="rules">&#123;</span><br><span class="line">    <span class="rule"><span class="attribute">border-image</span>:<span class="value"> <span class="function">url</span>() <span class="number">2</span> <span class="number">0</span> stretch</span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">border-width</span>:<span class="value"> <span class="number">0</span> <span class="number">0</span> <span class="number">1px</span></span></span>;</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure></p>
<p>优点：无。<br>缺点：图片边缘模糊，大小、颜色更改不灵活。</p>
<h4 id="6-_CSS3_缩放">6. CSS3 缩放</h4><p>实现原理：利用 :before/:after 重做 border，配合 scale 使得伪元素缩小一半<br><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$bor_style</span> <span class="value">: <span class="number">1px</span> solid <span class="hexcolor">#ddd</span>;</span></span><br><span class="line">%<span class="attribute">border-top</span>-1pt &#123;</span><br><span class="line">    <span class="attribute">content</span><span class="value">: <span class="string">''</span>;</span></span><br><span class="line">    <span class="attribute">height</span><span class="value">: <span class="number">0</span>;</span></span><br><span class="line">    <span class="attribute">display</span><span class="value">: block;</span></span><br><span class="line">    <span class="attribute">border-bottom</span><span class="value">: <span class="variable">$bor_style</span>;</span></span><br><span class="line">    <span class="attribute">position</span><span class="value">: absolute;</span></span><br><span class="line">    <span class="attribute">left</span><span class="value">: <span class="number">0</span>;</span></span><br><span class="line">    <span class="attribute">right</span><span class="value">: <span class="number">0</span>;</span></span><br><span class="line">    <span class="attribute">top</span><span class="value">: <span class="number">0</span>;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="at_rule">@<span class="keyword">media</span><span class="preprocessor"> only</span><span class="preprocessor"> screen</span><span class="preprocessor"> and</span> (-webkit-min-device-pixel-ratio:<span class="number">2</span>) &#123;</span></span><br><span class="line">    %<span class="attribute">border-top</span>-1pt &#123;</span><br><span class="line">        -webkit-<span class="attribute">transform</span><span class="value">: <span class="function">scaleY</span>(<span class="number">0.5</span>);</span></span><br><span class="line">        -webkit-<span class="attribute">transform-origin</span><span class="value">: <span class="number">50%</span> <span class="number">0%</span>;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>优点：实现简单、单边框、多边框、圆角可实现，大小、颜色可配置。<br>缺点：代码量多，可通过 sass 预处理器处理。</p>
<h4 id="总结：">总结：</h4><p>经过比较与实操测试，最好的处理方式是 CSS3 缩放，目前项目已经在广泛使用。</p>
<h3 id="2-_Flexbox_布局">2. Flexbox 布局</h3><blockquote>
<p>Flexbox Layout（弹性盒模型）模块（目前W3C工作草案正在最后通过）的目的是为了提供一种更有效的方式来布局，使各模块即使大小是未知或者动态的也可以在项目空间中合理分配位置（就像“弹性”这个词一样）。</p>
</blockquote>
<p>项目哪些地方可以使用 flexbox？比如这些</p>
<p class="user_img"><img src="/img/post/liqinuo/3.png"></p>
<h4 id="基本语法：">基本语法：</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">ul</span> <span class="rules">&#123;</span><br><span class="line">    <span class="rule"><span class="attribute">display</span>:<span class="value"> box</span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">display</span>:<span class="value"> -webkit-box</span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">display</span>:<span class="value"> flex</span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">display</span>:<span class="value"> -webkit-flex</span></span>;</span><br><span class="line">&#125;</span></span><br><span class="line"><span class="tag">ul</span> <span class="tag">li</span> <span class="rules">&#123;</span><br><span class="line">    <span class="rule"><span class="attribute">display</span>:<span class="value"> block</span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">flex</span>:<span class="value"> <span class="number">1</span></span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">-webkit-flex</span>:<span class="value"> <span class="number">1</span></span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">box-flex</span>:<span class="value"> <span class="number">1</span></span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">-webkit-box-flex</span>:<span class="value"> <span class="number">1</span></span></span>;</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="3-_元素水平垂直居中">3. 元素水平垂直居中</h3><p>实现的方法有很多种，下面几种比较常用：</p>
<h4 id="1-_表格方法：">1. 表格方法：</h4><p>实现方法：表格内容本来就是垂直居中的，可以通过模拟表格处理。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"box_center"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"inner"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">.box_center</span> &#123;</span><br><span class="line">    <span class="attribute">display</span><span class="value">: table-cell;</span></span><br><span class="line">    <span class="attribute">width</span><span class="value">: <span class="number">300px</span>;</span></span><br><span class="line">    <span class="attribute">height</span><span class="value">: <span class="number">300px</span>;</span></span><br><span class="line">    <span class="attribute">text-align</span><span class="value">: center;</span></span><br><span class="line">    <span class="attribute">vertical-align</span><span class="value">: middle;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="class">.box_center</span> <span class="class">.inner</span> &#123;</span><br><span class="line">    <span class="attribute">display</span><span class="value">: inline-block;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="2-_vertical-align:_middle">2. vertical-align: middle</h4><p>实现方法：利用空元素占位实现<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"box_center"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"placeholder"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"inner"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">.box_center</span> <span class="rules">&#123;</span><br><span class="line">    <span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">300px</span></span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">height</span>:<span class="value"> <span class="number">300px</span></span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">text-align</span>:<span class="value"> center</span></span>;</span><br><span class="line">&#125;</span></span><br><span class="line"><span class="class">.box_center</span> <span class="class">.inner</span> <span class="rules">&#123;</span><br><span class="line">    <span class="rule"><span class="attribute">display</span>:<span class="value"> inline-block</span></span>;</span><br><span class="line">&#125;</span></span><br><span class="line"><span class="class">.box_center</span> <span class="class">.placeholder</span> <span class="rules">&#123;</span><br><span class="line">    <span class="rule"><span class="attribute">display</span>:<span class="value"> inline-block</span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">0</span></span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">height</span>:<span class="value"> <span class="number">100%</span></span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">vertical-align</span>:<span class="value"> middle</span></span>;</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="3-_绝对定位">3. 绝对定位</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">%<span class="tag">box_center</span> <span class="rules">&#123;</span><br><span class="line">    <span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">300px</span></span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">height</span>:<span class="value"> <span class="number">300px</span></span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">position</span>:<span class="value"> absolute</span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">left</span>:<span class="value"> <span class="number">0</span></span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">right</span>:<span class="value"> <span class="number">0</span></span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">top</span>:<span class="value"> <span class="number">0</span></span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">bottom</span>:<span class="value"> <span class="number">0</span></span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">margin</span>:<span class="value"> auto</span></span>;</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<h4 id="4-_使用_transform_实现">4. 使用 transform 实现</h4><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">%<span class="tag">box_center</span> <span class="rules">&#123;</span><br><span class="line">    <span class="rule"><span class="attribute">position</span>:<span class="value"> absolute</span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">left</span>:<span class="value"> <span class="number">50%</span></span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">top</span>:<span class="value"> <span class="number">50%</span></span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">-webkit-transform</span>:<span class="value"> <span class="function">translate</span>(-<span class="number">50%</span>, -<span class="number">50%</span>)</span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">transform</span>:<span class="value"> <span class="function">translate</span>(-<span class="number">50%</span>, -<span class="number">50%</span>)</span></span>;</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<p>兼容性：Android2.3 系统浏览器不支持容器直接使用 fixed 进行定位，外加 fixed 容器可解决。</p>
<h4 id="结论：-1">结论：</h4><p>经过各种场景的适用型比较，项目使用  transform 实现，兼容性好且使用方便。</p>
<h3 id="4-_图片占位">4. 图片占位</h3><p>图片未加载出来之前浏览器是无法计算出图片实际尺寸的，所以会出现一个问题，页面刚打开各种元素会因为图片未完全加载而跳动/错位。</p>
<p>这里推荐一种兼容性很好做法简单的方法：</p>
<p><strong>实现原理：</strong><br>通过图片宽高比例计算出图片所需占位空间，赋值于外容器，图片再绝对定位在等比缩放的容器当中。<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">.placeholder</span> <span class="rules">&#123;</span><br><span class="line">    <span class="rule"><span class="attribute">position</span>:<span class="value"> relative</span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">overflow</span>:<span class="value"> hidden</span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">100%</span>:</span><br><span class="line">    height: <span class="number">0</span></span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">padding-top</span>:<span class="value"> <span class="number">100%</span>:</span><br><span class="line"></span></span></span>&#125;</span><br><span class="line"><span class="class">.placeholder</span> <span class="tag">img</span> <span class="rules">&#123;</span><br><span class="line">    <span class="rule"><span class="attribute">display</span>:<span class="value"> block</span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">100%</span></span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">height</span>:<span class="value"> auto</span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">position</span>:<span class="value"> absolute</span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">left</span>:<span class="value"> <span class="number">0</span></span></span>;</span><br><span class="line">    <span class="rule"><span class="attribute">top</span>:<span class="value"> <span class="number">0</span></span></span>;</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure></p>
<p><strong>计算公式：</strong><br>padding-top = 图片高度(px)/图片宽度(px) * 100%</p>
<p><strong>比如：</strong><br>1:1 比例的图片 padding-top: 100%;<br>2:1 比例的图片 padding-top: 50%;</p>
<h2 id="四_尽可能减少样式图片">四 尽可能减少样式图片</h2><p>大多图标元素都可以使用 CSS 样式绘制，可以大大减少样式图资源请求还有增强图标可维护性。<br>比如：链接箭头、圆点、优惠券点点、选择框、checkbox等等。</p>
<p class="user_img"><img src="/img/post/liqinuo/4.png"></p>
<h2 id="五_使用_WebP_格式图片">五 使用 WebP 格式图片</h2><blockquote>
<p>WebP 格式，由 google 于 2010 年推出的新一代图片格式，在压缩方面比 JPEG 格式更优越，并能节省大量的服务器带宽资源和数据空间。与 JPEG 相同，WebP 也是一种有损压缩，主要优势在于高效率。在质量相同的情况下，WebP 格式图像的体积要比 JPEG 格式图像小 40%。</p>
</blockquote>
<p>项目中大部分页面素材图都使用了 WebP 格式，兼容方案：</p>
<ol>
<li><p><strong>打开场景是浏览器：</strong>通过 javascript 检测，对支持 WebP 的用户输出 WebP 格式图片。<br>WebP 支持 插件：<a href="http://webpjs.appspot.com/" target="_blank" rel="external">http://webpjs.appspot.com/</a></p>
</li>
<li><p><strong>打开场景是APP：</strong>根据不同系统使用 Android WebP 解析库或iOS WebP 解析库做兼容解析。<br>Android4.0 以下解析库：<a href="https://github.com/alexey-pelykh/webp-android-backport" target="_blank" rel="external">https://github.com/alexey-pelykh/webp-android-backport</a><br>iOS 解析库：<a href="https://github.com/carsonmcdonald/WebP-iOS-example" target="_blank" rel="external">https://github.com/carsonmcdonald/WebP-iOS-example</a></p>
</li>
</ol>
<p>PS：除了 Android4.0 以上提供原生支持</p>
<p>资料参考：<a href="http://isux.tencent.com/introduction-of-webp.html" target="_blank" rel="external">http://isux.tencent.com/introduction-of-webp.html</a></p>
<p><strong>结论：</strong><br>保证图片高清质量的同时，大大压缩了图片大小，节省了服务器带宽资源和数据空间。</p>
<h2 id="六_APP缓存策略">六 APP缓存策略</h2><p>注： APP缓存策略由开发同学提供</p>
<h3 id="1-_缓存方式">1. 缓存方式</h3><ul>
<li><p>模块化的使用 APP 缓存，写入磁盘，包括 HTML、JS、CSS。</p>
</li>
<li><p>图片使用浏览器缓存，稳定后的背景图以及常用图片也使用 APP 缓存。</p>
</li>
</ul>
<h3 id="2-_缓存更新">2. 缓存更新</h3><ul>
<li><p><strong>主模块更新：</strong>APP 打开就发送主模块版本号到服务端，返回有更新的模块内容以及版本号，并且返回所有模块版本索引。</p>
</li>
<li><p><strong>子模块更新：</strong>进去一个主模块，在加载完成后，会检查所有子模块版本索引，并获取需要更新的模块内容。</p>
</li>
<li><p><strong>当前模块更新：</strong>在直接打开模块时（非首页进入），会去 check/更新一下当前版本，然后在加载。</p>
</li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<a id="more"></a>
<h2 id="一_布局方式">一 布局方式</h2><p>作为一个注重用户体验的 H5 页面，合适的页面布局方式很重要。<br>移动端页面常规布局基本分两种：</p>
<h3 id="1-_流式布局（响应式宽度自适应布局）">1. 流式布局（]]>
    </summary>
    
      <category term="summary" scheme="http://aotu.io/tags/summary/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[以电影之眼看CSS3动画（二）]]></title>
    <link href="http://aotu.io/notes/2015/11/23/css3-animation-to-movie-part_2/"/>
    <id>http://aotu.io/notes/2015/11/23/css3-animation-to-movie-part_2/</id>
    <published>2015-11-22T17:27:00.000Z</published>
    <updated>2015-12-10T02:02:53.000Z</updated>
    <content type="html"><![CDATA[<h1 id="以电影之眼看CSS3动画（二）">以电影之眼看CSS3动画（二）</h1><hr>
<pre><code>注：此文非干货聚集地，来找干货的对不住了。
注注：又多又大的图预警！！！
</code></pre><p>上回说到CSS3动画与传统动画之间千丝万缕的联系，现在就让我们来探讨一下用CSS3动画做一部动画电影都需要些什么。</p>
<p>一、</p>
<p><strong>首先你需要一个故事。</strong></p>
<p>即使只是一堆雪花往下掉，也是包含故事的——为什么下雪？是冬天来了？那是冬天的第一场雪吗？第一场雪有什么特点呢？好吧作为一个从没见过雪的南方人我承认我给自己挖了个坑，不过就是类似这种思路，让我们拥有了一个故事，所以，即使只有一秒钟的动画也是有故事的。Use your imagination.</p>
<p>小tip：在做影视题材的专题页时，我会首先根据相关影视的预告片确定入场动画的风格与基调，观看预告片不仅能够了解影片的风格，同时还能学习其字幕出现、消失以及转场的方式，获得一种节奏感，也就是上面所说的时间掌控。在看电影正片时也可留意影片开头与结尾字幕出现的形式，尤其是科幻片，电影字幕的设计与电影风格相辅相成，常常能让你脑洞大开——原来还能这么玩。</p>
<p><img src="/img/post/lyxuncle/2-1_preview_of_overheard_3.gif" alt="preview_of_overheard_3"></p>
<ul>
<li><a href="http://movie.douban.com/trailer/156598/#content" target="_blank" rel="external">[窃听风云3]预告片</a>中字幕出现的方式表现出信号干扰的效果，由此可以将影片相关专题作出这样的开场动画——</li>
</ul>
<p><img src="/img/post/lyxuncle/2-2_animation_design_of_overheard_3_broadcast.gif" alt="animation_design_of_overheard_3_broadcast"></p>
<ul>
<li>视觉设计：吴丹枫</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="at_rule">@<span class="keyword">keyframes</span> peoInner</span>&#123;</span><br><span class="line">	0%, 12<span class="class">.5</span>%, 16<span class="class">.5</span>%, 20<span class="class">.5</span>%<span class="rules">&#123;<span class="rule"><span class="attribute">background</span>:<span class="value">none</span></span>;&#125;</span></span><br><span class="line">	10%, 12%<span class="rules">&#123;<span class="rule"><span class="attribute">background</span>:<span class="value"><span class="function">url</span>(../img_bg/casts_adv_green_red.jpg) no-repeat <span class="number">0</span> <span class="number">0</span></span></span>;&#125;</span></span><br><span class="line">	14%, 16%<span class="rules">&#123;<span class="rule"><span class="attribute">background</span>:<span class="value"><span class="function">url</span>(../img_bg/casts_adv_green_red.jpg) no-repeat <span class="number">0</span> -<span class="number">725px</span></span></span>;&#125;</span></span><br><span class="line">	18%, 20%<span class="rules">&#123;<span class="rule"><span class="attribute">background</span>:<span class="value"><span class="function">url</span>(../img_bg/casts_adv_green_red.jpg) no-repeat <span class="number">0</span> -<span class="number">725px</span></span></span>;&#125;</span></span><br><span class="line">	13%, 17%, 21%, 100%<span class="rules">&#123;<span class="rule"><span class="attribute">background</span>:<span class="value"><span class="function">url</span>(../img_bg/cast_adv_01.jpg) no-repeat top center</span></span>;&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>简单的几个不同色调的图片进行替换就能做出类似效果。（<a href="http://labs.qiang.it/labs/EC_demo/Doing_Movie_by_CSS3.html" target="_blank" rel="external">demo地址</a>）</li>
</ul>
<p>二、</p>
<p>当我们在脑内小剧场构思好动画小故事之后（当然，你也可以将它写下来），我们就可以进行<strong>关键帧与时间轴的设计</strong>了。</p>
<blockquote>
<p>任何人都可以用电脑动画软件将一个物体移动。但是如何赋予物体重量、大小、规模、移动和幽默感，这些都与你如何移动物体相关。电脑不能为动画师创造动画，动画师仍然需要了解时间掌握的原则知识以赋予电脑动画生命力。（《动画的时间掌握》）</p>
</blockquote>
<p>这时需要注意的是因果关系对动画的影响，“一个动画师必须懂得自然界物体运动的力学知识”，这样“才能创造情绪和表达正确的感觉。”我们来看看为了使动画更加流畅真实，迪士尼爷爷想出了什么办法。［白雪公主与七个小矮人］作为80、90后动画电影启蒙，使用了一项革新动画制作的技术——<a href="http://zh.wikipedia.org/wiki/%E8%BD%AC%E6%8F%8F%E6%9C%BA%E6%8A%80%E6%9C%AF" target="_blank" rel="external">转描机</a>。</p>
<ul>
<li>（视频 <a href="http://player.ku6.com/refer/TH-adgFO0MjSKh3i/v.swf" target="_blank" rel="external">http://player.ku6.com/refer/TH-adgFO0MjSKh3i/v.swf</a> ）</li>
</ul>
<p><img src="/img/post/lyxuncle/2-4_sidelights_of_snow_white.gif" alt="sidelights_of_snow_white"></p>
<ul>
<li>视频：[白雪公主与七个小矮人]（1974）幕后花絮</li>
</ul>
<p>视频中有一个细节，迪士尼爷爷让动画师注意那位大叔在跳踢踏舞时重力对裤腿的作用（19分15秒）。是的，迪士尼爷爷强调的就是动画与物理学的关系。其实即使是网页中的动画也能用到牛顿运动定律，将网页元素看作一个有重量、有结构、有柔韧性的物体进行动画设计，会得到意想不到的效果。事实上已经有人这么做了——</p>
<p><img src="/img/post/lyxuncle/2-5_dribbble_form_animation.gif" alt="dribbble_form_animation"></p>
<ul>
<li>dribbble’s stripe checkout（图片来源：<a href="http://markgeyer.com/pres/the-art-of-ui-animations/#/2/9" target="_blank" rel="external">The Art of Animation</a>）</li>
</ul>
<p>Adds a bit of realism to an otherwise static interface. ——<a href="http://markgeyer.com/pres/the-art-of-ui-animations/#/2/5" target="_blank" rel="external">The 12 basic principles of animation - The Art of Animation</a></p>
<p><img src="/img/post/lyxuncle/2-6_bouncejs_example.gif" alt="bouncejs_example"></p>
<ul>
<li>图片来源：<a href="https://medium.com/tictail-makers/giving-animations-life-8b20165224c5" target="_blank" rel="external">Giving Animations Life</a></li>
</ul>
<p>Using Bounce.js and classical animation concepts to bring life to user interfaces. ——<a href="https://medium.com/tictail-makers/giving-animations-life-8b20165224c5" target="_blank" rel="external">Giving Animations Life</a></p>
<p>三、</p>
<p><strong>不断的修改与调整。</strong></p>
<p>这是一个需要细致与耐心的过程，你得在不断的调整中保持大局观，避免陷入细节的纠结，同时又需要有能够将别扭的细节调整好的灵感。说白了就是同时拥有汉子的粗犷与妹子的细腻。节奏是一个很重要的要素，与银幕上的动画类似，CSS3动画创作者的意念必须即时并完全交给观众。</p>
<blockquote>
<p>意念清晰易懂靠两个因素：1、好的表现手法和设计，要使每个主要动作能以最清楚和最有效的方式呈现在银幕上。2、好的时间掌握，要有足够的时间先使用户预感到将有什么事情发生，然后用于表现动作本身，最后要有好的收尾。这三者中，任何一项所占时间太多，便会感觉节奏太慢，用户会感到不耐烦，动画的出现便如同鸡肋。反之，如果时间太短，那么用户在注意到它之前，动作已经结束，创作者的意念未能充分表达，就浪费掉了。——《动画的时间掌握》</p>
</blockquote>
<p>四、</p>
<p>别忘了进行<strong>性能测试</strong>。</p>
<p>这是一步有可能推翻前面两步甚至三步的一个步骤。但是即便发生了这样的事，也不要气馁，这并不意味着之前做的前功尽弃，反而是个宝贵的财富——对于性能的感受又多了一次体验，而其中的一些动画心得或许下次也能用上。</p>
<p>说了这么多，一切都显得辣么抽象，下面就上栗子。</p>
<p><img src="/img/post/lyxuncle/2-7_animation_of_an_eye.gif" alt="animation_of_an_eye"></p>
<ul>
<li>动画来源：<a href="http://tympanus.net/Development/PseudoElementsAnimationsTransitions/index4.html" target="_blank" rel="external">Pseudo-Elements Animations and Transitions</a></li>
</ul>
<p>这是个使用了最简单的css属性——padding、line-height、box-shadow——实现了令人吃了一斤效果的栗子，就像一道脑筋急转弯一样让大家对CSS3的动画的理解不止于CSS3的新属性，我们曾经用烂的CSS2.0属性同样也能开出花儿。</p>
<p>我们看到，CSS3动画并不只是由transform、opacity等等简单组成，它还可以包含许许多多的设计、想法、甚至感情。台上一分钟，台下十年功在动画上也适用，或许在所有事物上都适用。</p>
<p>目前为止用CSS3动画拍电影只是个概念，但想象一下你是这部电影的导演，所有元素都是可调度的场景与角色，用CSS3动画拍电影是不是也没有那么遥远了？</p>
<p>最后，我想将我一直以来没能找到合适实现方法的动画效果放上来，希望能够抛砖引玉、集思广益：</p>
<p><img src="/img/post/lyxuncle/2-8_frames_of_flame_1.jpg" alt="frames_of_flame_1"></p>
<p><img src="/img/post/lyxuncle/2-9_frames_of_flame_2.jpg" alt="frames_of_flame_2"></p>
<ul>
<li>A 冷空气从火的底部冲入，受热后上升。 B 一套火的循环①-⑧，标以×的漩涡一个接一个地向上升起。升得越高，速度越慢。</li>
</ul>
<blockquote>
<p>火焰的动作受火的上部流动着的空气的控制。最热的部分在火的中央，在这之上热空气上升，当热空气上升时，旁边的冷空气冲入取代热空气的位置。这部分冷空气变热后又上升，这个过程重复不已。空气的流通常常使火焰成为粗略的圆锥形，由冷空气的漩涡形成一连串锯齿状火焰，从火的底部向里和向上移动。（《动画的时间掌握》）</p>
</blockquote>
<p>除了空气与火焰的关系外，火焰的运动由于随机性很大，循环动画需要写得看不出动作在循环也是难点之一。如何才能在保证结构、性能的同时做出最佳的火焰效果？</p>
<p>最最后，放上迪士尼爷爷的一段话，在我做动画甚至做任何事时它将不断地在脑海中回响：</p>
<p>曾经有人问迪士尼，[白雪公主]大受欢迎的秘密是什么？他回答说：</p>
<p>“我们只能确定一件事，每一个人都有童年，每次拍一部新片，我们不是为大人而拍，也不只是为小孩子拍，我们是为了唤醒每个人内心深处那种早就被遗忘的纯真世界。”</p>
<h2 id="参考资料：">参考资料：</h2><ul>
<li><p><a href="http://www.amazon.cn/%E5%8A%A8%E7%94%BB%E7%9A%84%E6%97%B6%E9%97%B4%E6%8E%8C%E6%8F%A1-%E5%93%88%E7%BD%97%E5%BE%B7%E2%80%A2%E5%A8%81%E7%89%B9%E5%85%8B/dp/B0094N5III/ref=sr_1_1?ie=UTF8&amp;qid=1420369719&amp;sr=8-1&amp;keywords=%E5%8A%A8%E7%94%BB%E7%9A%84%E6%97%B6%E9%97%B4%E6%8E%8C%E6%8F%A1" target="_blank" rel="external">《动画的时间掌握（修订版）》</a>[英]哈罗德•威特克；[英]约翰•哈拉斯；[美]汤姆•赛图</p>
</li>
<li><p><a href="http://markgeyer.com/pres/the-art-of-ui-animations/#/" target="_blank" rel="external">The Art of UI Animations</a> </p>
</li>
</ul>
<h2 id="推荐：">推荐：</h2><ul>
<li><p><a href="ttp://isux.tencent.com/css3/tools.html" target="_blank" rel="external">ISUX动画工具、动画手册</a></p>
<blockquote>
<p>了解所有与CSS3动画相关的属性，使用动画工具更直观地调整变形。</p>
</blockquote>
</li>
<li><p><a href="http://minyos.its.rmit.edu.au/aim/a_notes/anim_principles.html" target="_blank" rel="external">12 Principles of Animation</a></p>
<blockquote>
<p>最近存在感极强的动画12原则，如果想要做出自然流畅的CSS3动画，这个由迪士尼动画巨头所总结出的经典原则绝对是必读之物。这里附上视频版：<a href="http://vimeo.com/93206523" target="_blank" rel="external">http://vimeo.com/93206523</a></p>
</blockquote>
</li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<h1 id="以电影之眼看CSS3动画（二）">以电影之眼看CSS3动画（二）</h1><hr>
<pre><code>注：此文非干货聚集地，来找干货的对不住了。
注注：又多又大的图预警！！！
</code></pre><p>上回说到CSS3动画与传统动画之间千丝万缕的联系，现]]>
    </summary>
    
      <category term="Animation" scheme="http://aotu.io/tags/Animation/"/>
    
      <category term="CSS3" scheme="http://aotu.io/tags/CSS3/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[以电影之眼看CSS3动画（一）]]></title>
    <link href="http://aotu.io/notes/2015/11/23/css3-animation-to-movie-part_1/"/>
    <id>http://aotu.io/notes/2015/11/23/css3-animation-to-movie-part_1/</id>
    <published>2015-11-22T17:27:00.000Z</published>
    <updated>2015-12-10T02:02:53.000Z</updated>
    <content type="html"><![CDATA[<h1 id="以电影之眼看CSS3动画（一）">以电影之眼看CSS3动画（一）</h1><hr>
<pre><code>注：此文非干货聚集地，来找干货的对不住了。    
注注：又多又大的图预警！！！
</code></pre><p><a href="http://isux.tencent.com/css3/index.html" target="_blank" rel="external">CSS3动画</a>的变形基础（transform）包含4种变形方式（translate、rotate、scale、skew），同时还可设置2D、3D、变形原点（transform-origin）、透视（perspective）、透视原点（perspective-origin）等等特性；动画时间频率包含9种基本模式（ease、linear、ease-in、ease-out、ease-in-out、step-start、step-end、steps），甚至还可以使用cubic-bezier写出任何你想要的模式；再加上动画持续时间（animation-duration）等设定，各种排列组合，CSS3动画简直拥有了整个世界！</p>
<p><img src="/img/post/lyxuncle/1-1_trandition_animation.png" alt="trandition_animation"></p>
<ul>
<li>图片来源《动画的时间掌握》</li>
</ul>
<p>根据<a href="http://zh.wikipedia.org/wiki/%E5%8A%A8%E7%94%BB" target="_blank" rel="external">维基</a>的释义，动画是指由许多帧静止的画面，以一定的速度（如每秒16张）连续播放时，肉眼因视觉残象产生错觉，而误以为画面活动的作品（gif图片正是运用这种原理）。因此最初的动画是通过几张快速翻动的连续画面制作而成，而后经历了电影摄影技术的出现、电脑科技的进步，逐渐转向数字化。</p>
<p><img src="/img/post/lyxuncle/1-2_bouncing_ball.gif" alt="bouncing_ball"><br><img src="/img/post/lyxuncle/1-3_boucing_ball_frames.png" alt="boucing_ball_frames"></p>
<ul>
<li>将gif拖入PS之后打开时间轴窗口即可看到每一帧的画面</li>
</ul>
<p>无论是2D还是3D动画，关键帧，正如其名，是动画制作中最关键的部分，同时也是最难把握的部分。曾经有位设计师告诉我，在大学的第一节flash课的课后作业，老师要求大家上交一份小球动画，包含气球、石头球与皮球，并告诉大家，以相同的外观表现出不同的质感是在考验你对关键帧的悟性，而这一个作业就能体现你是否适合学习动画。</p>
<p><img src="/img/post/lyxuncle/1-4_quality_of_ball.png" alt="quality_of_ball"></p>
<blockquote>
<p>A 需要很大的力才能使一个炮弹移动。一旦它移动了，同样需要很大的力才能阻挡它前进。B 一只汽球只需要很小的力去移动它，但空气阻力使它很快停止动作。这两个例子都画了动作分格线，可以看出在银幕上表现物体的轻重，取决于对它们动作的时间掌握。（图片来源：《动画的时间掌握》）</p>
</blockquote>
<p>在<a href="http://cghappening.blogspot.com/2011/02/blog-post_23.html" target="_blank" rel="external">《動畫製作流程介紹》</a>提供的视频中可以看到关键帧在动画制作中所起的地基般的作用。</p>
<p><img src="/img/post/lyxuncle/1-5_story_board_of_Monster_Inc.gif" alt="story_board_of_Monster_Inc"></p>
<ul>
<li>画面上方的手绘图即为[怪物公司]的关键帧</li>
</ul>
<p>与关键帧紧密关联的即为时间轴（或摄制表），时间轴是补齐中间帧不可或缺的一项，在传统动画制作中，导演就是通过制定时间轴来掌控整部动画的节奏。</p>
<p><img src="/img/post/lyxuncle/1-6_continuity.jpg" alt="continuity"></p>
<ul>
<li>摄制表（图片来源：《动画的时间掌握》）</li>
</ul>
<p>在CSS3中，@keyframes正是动画的关键帧容器。@keyframes中包含的包括transform在内的元素形态设定构成了关键帧的画面。@keyframes中的百分比即为时间轴的体现。中间帧则由浏览器自动完成（就像flash中的补全动画）。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">.people</span><span class="rules">&#123;<span class="rule"><span class="attribute">animation</span>:<span class="value">people linear <span class="number">1.5s</span></span></span>;&#125;</span></span><br><span class="line"><span class="at_rule">@<span class="keyword">keyframes</span> people</span>&#123;</span><br><span class="line">	0%, 95%<span class="rules">&#123;<span class="rule"><span class="attribute">opacity</span>:<span class="value"><span class="number">0</span></span></span>;&#125;</span></span><br><span class="line">	100%<span class="rules">&#123;<span class="rule"><span class="attribute">opacity</span>:<span class="value"><span class="number">1</span></span></span>;&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/img/post/lyxuncle/1-7_css3_animation_2.png" alt="css3_animation"></p>
<ul>
<li>一个简单的动画关键帧示例</li>
</ul>
<p>现在我们知道了CSS3动画的结构与传统动画之间的关系，重点来了， CSS3动画可以做出一部动画电影吗？欲知详情，且听下回分解。</p>
<h2 id="参考资料：">参考资料：</h2><ul>
<li><a href="http://www.amazon.cn/%E5%8A%A8%E7%94%BB%E7%9A%84%E6%97%B6%E9%97%B4%E6%8E%8C%E6%8F%A1-%E5%93%88%E7%BD%97%E5%BE%B7%E2%80%A2%E5%A8%81%E7%89%B9%E5%85%8B/dp/B0094N5III/ref=sr_1_1?ie=UTF8&amp;qid=1420369719&amp;sr=8-1&amp;keywords=%E5%8A%A8%E7%94%BB%E7%9A%84%E6%97%B6%E9%97%B4%E6%8E%8C%E6%8F%A1" target="_blank" rel="external">《动画的时间掌握（修订版）》</a>[英]哈罗德•威特克；[英]约翰•哈拉斯；[美]汤姆•赛图</li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<h1 id="以电影之眼看CSS3动画（一）">以电影之眼看CSS3动画（一）</h1><hr>
<pre><code>注：此文非干货聚集地，来找干货的对不住了。    
注注：又多又大的图预警！！！
</code></pre><p><a href="http://isux.t]]>
    </summary>
    
      <category term="Animation" scheme="http://aotu.io/tags/Animation/"/>
    
      <category term="CSS3" scheme="http://aotu.io/tags/CSS3/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[SVG I Know]]></title>
    <link href="http://aotu.io/notes/2015/11/20/svg-I-know/"/>
    <id>http://aotu.io/notes/2015/11/20/svg-I-know/</id>
    <published>2015-11-20T11:30:45.000Z</published>
    <updated>2015-12-10T02:02:53.000Z</updated>
    <content type="html"><![CDATA[<h2 id="第一章：SVG入门篇">第一章：SVG入门篇</h2><h3 id="SVG简介">SVG简介</h3><p>SVG即Scalable Vector Graphics可缩放矢量图形，使用XML格式定义图形。<br>优点：</p>
<ul>
<li>SVG与其他图片格式相比：主要优势在于可缩放的同时不会影响图片的质量。</li>
<li>与flash相比 ：SVG 最大的优势是与其他标准（比如 XSL 和 DOM）相兼容。而 Flash 则是未开源的私有技术。</li>
</ul>
<h3 id="SVG_in_HTML常用方法">SVG in HTML常用方法</h3><h4 id="使用&lt;img&gt;元素来嵌入SVG图像">使用&lt;img&gt;元素来嵌入SVG图像</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">img</span> <span class="attribute">src</span>=<span class="value">"http://www.w3school.com.cn/svg/rect1.svg"</span>  <span class="attribute">width</span>=<span class="value">"300"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="将SVG图像作为背景图像嵌入">将SVG图像作为背景图像嵌入</h4><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">background: url('http://www.w3school.com.cn/svg/rect1.svg') no-repeat;</span><br></pre></td></tr></table></figure>
<h4 id="使用svg元素，通过代码将SVG图像嵌入到HTML代码中">使用svg元素，通过代码将SVG图像嵌入到HTML代码中</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">body</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">svg</span> <span class="attribute">width</span>=<span class="value">"100%"</span> <span class="attribute">height</span>=<span class="value">"100%"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">		<span class="tag">&lt;<span class="title">rect</span> <span class="attribute">x</span>=<span class="value">"20"</span> <span class="attribute">y</span>=<span class="value">"20"</span> <span class="attribute">width</span>=<span class="value">"250"</span> <span class="attribute">height</span>=<span class="value">"250"</span></span><br><span class="line"><span class="attribute">style</span>=<span class="value">"fill:#fecdddd;"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;/<span class="title">svg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">body</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="svg_sprites">svg sprites</h3><p>svg sprites类似于css sprites，将各个svg合并在一起。<br>最主要的优点就是能减少页面的加载时间，优化开发流程，以及保持页面中图片元素的一致性。<br>实践中我们可以把整块的svg放在head头部， 因此可以在一处地方更新svg即可，而不是让svg的代码块散落在文档的各个地方。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">head</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">meta</span> <span class="attribute">charset</span>=<span class="value">"utf-8"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">title</span>&gt;</span>svg<span class="tag">&lt;/<span class="title">title</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="title">svg</span> <span class="attribute">version</span>=<span class="value">"1.1"</span> <span class="attribute">xmlns</span>=<span class="value">"http://www.w3.org/2000/svg"</span> <span class="attribute">xmlns:xlink</span>=<span class="value">"http://www.w3.org/1999/xlink"</span> <span class="attribute">width</span>=<span class="value">"32"</span> <span class="attribute">height</span>=<span class="value">"158"</span> <span class="attribute">viewBox</span>=<span class="value">"0 0 32 158"</span>&gt;</span></span><br><span class="line">		<span class="comment">&lt;!-- SVG等省略  --&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="title">svg</span>&gt;</span></span><br><span class="line">	</span><br><span class="line"><span class="tag">&lt;/<span class="title">head</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>在这里<a href="https://icomoon.io/app/#/select" target="_blank" rel="external">https://icomoon.io/app/#/select</a>可以设置sprites，可以自己导入svg。</p>
<p class="user_img"><img src="/img/post/Newcandy/svgSprite.jpg" alt="svgSprite"></p>
<h3 id="symbol+use">symbol+use</h3><p>在head头部的svg中使用symbol元素，并使用id属性。其中symbol类似flash中的元件，可多次使用。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">svg</span> <span class="attribute">id</span>=<span class="value">"icon-truck"</span> <span class="attribute">width</span>=<span class="value">"32"</span> <span class="attribute">height</span>=<span class="value">"32"</span> <span class="attribute">viewBox</span>=<span class="value">"0 0 32 32"</span> <span class="attribute">x</span>=<span class="value">"0"</span> <span class="attribute">y</span>=<span class="value">"126"</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="title">symbol</span> <span class="attribute">id</span>=<span class="value">"truck"</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="title">path</span> <span class="attribute">fill</span>=<span class="value">"#fff"</span> <span class="attribute">d</span>=<span class="value">"M24.832 11.445c-0.186-0.278-0.498-0.445-0.832-0.445h-1c-0.553 0-1 0.447-1 1v6c0 0.553 0.447 1 1 1h4c0.553 0 1-0.447 1-1v-1.5c0-0.197-0.059-0.391-0.168-0.555l-3-4.5zM27 18h-4v-6h1l3 4.5v1.5zM31.496 15.336l-4-6c-0.558-0.837-1.492-1.336-2.496-1.336h-4v-2c0-1.654-1.346-3-3-3h-15c-1.654 0-3 1.346-3 3v11c0 1.654 1.346 3 3 3v0 3c0 1.654 1.346 3 3 3h1.142c0.447 1.721 2 3 3.859 3 1.857 0 3.41-1.279 3.857-3h5.282c0.447 1.721 2 3 3.859 3 1.857 0 3.41-1.279 3.857-3h1.144c1.654 0 3-1.346 3-3v-6c0-0.594-0.174-1.17-0.504-1.664zM3 18c-0.552 0-1-0.447-1-1v-11c0-0.553 0.448-1 1-1h15c0.553 0 1 0.447 1 1v11c0 0.553-0.447 1-1 1h-15zM11.001 27c-1.105 0-2-0.896-2-2s0.895-2 2-2c1.104 0 2 0.896 2 2s-0.897 2-2 2zM24 27c-1.105 0-2-0.896-2-2s0.895-2 2-2c1.104 0 2 0.896 2 2s-0.896 2-2 2zM30 23c0 0.553-0.447 1-1 1h-1.143c-0.447-1.721-2-3-3.857-3-1.859 0-3.412 1.279-3.859 3h-5.282c-0.447-1.721-2-3-3.857-3-1.859 0-3.412 1.279-3.859 3h-1.143c-0.552 0-1-0.447-1-1v-3h13c1.654 0 3-1.346 3-3v-7h4c0.334 0 0.646 0.167 0.832 0.445l4 6c0.109 0.164 0.168 0.358 0.168 0.555v6z"</span>&gt;</span><span class="tag">&lt;/<span class="title">path</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="title">symbol</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="title">svg</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>然后在需要用到这个元件的地方使用use元素引用元件。其中xlink:href=”#truck”相当于元件的链接，通过引用元件的id来实现。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">use</span> <span class="attribute">xlink:href</span>=<span class="value">"#truck"</span> <span class="attribute">x</span>=<span class="value">"0"</span> <span class="attribute">y</span>=<span class="value">"0"</span> /&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="兼容性">兼容性</h3><p class="user_img"><img src="/img/post/Newcandy/svgImage1.png" alt="svg兼容性"></p>
<p>兼容性详细情况请点击 <a href="http://caniuse.com/#search=svg" target="_blank" rel="external">此处</a></p>
<h3 id="总结思考">总结思考</h3><p>一般在html中使用SVG有三种方法：使用&lt;img&gt;元素来嵌入SVG图像；将SVG图像作为背景图像嵌入；使用&lt;svg&gt;元素，通过代码将SVG图像嵌入到HTML代码中。<br>使用过程中，可通过svg sprites提高性能，通过symbol以及use元素提高文档的可维护性等。</p>
<h2 id="第二章：SVG形状">第二章：SVG形状</h2><h3 id="矩形_&lt;rect&gt;">矩形 &lt;rect&gt;</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">rect</span> <span class="attribute">x</span>=<span class="value">"20"</span> <span class="attribute">y</span>=<span class="value">"20"</span> <span class="attribute">rx</span>=<span class="value">"20"</span> <span class="attribute">ry</span>=<span class="value">"20"</span> <span class="attribute">width</span>=<span class="value">"250"</span> <span class="attribute">height</span>=<span class="value">"100"</span> <span class="attribute">style</span>=<span class="value">"fill:red;stroke:black; stroke-width:5;opacity:0.5"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>解释：x为x坐标，y为y坐标；width 和 height 分别为形状的高度和宽度；rx 和 ry 属性可使矩形产生圆角。<br>另外，下面三个属性是文章后面会用到的，之后不会过多讲述：</p>
<ul>
<li>fill 属性定义形状的填充颜色</li>
<li>stroke 属性定义图形边框的颜色</li>
<li>stroke-width 属性定义形状边框的宽度</li>
</ul>
<h3 id="圆形_&lt;circle&gt;">圆形 &lt;circle&gt;</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">circle</span> <span class="attribute">cx</span>=<span class="value">"100"</span> <span class="attribute">cy</span>=<span class="value">"50"</span> <span class="attribute">r</span>=<span class="value">"40"</span> <span class="attribute">stroke</span>=<span class="value">"black"</span> <span class="attribute">stroke-width</span>=<span class="value">"2"</span> <span class="attribute">fill</span>=<span class="value">"red"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p> 解释：cx 和 cy分别为圆点的 x 和 y 坐标；r为半径。</p>
<h3 id="椭圆&lt;ellipse&gt;">椭圆&lt;ellipse&gt;</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">ellipse</span> <span class="attribute">cx</span>=<span class="value">"300"</span> <span class="attribute">cy</span>=<span class="value">"150"</span> <span class="attribute">rx</span>=<span class="value">"200"</span> <span class="attribute">ry</span>=<span class="value">"80"</span> <span class="attribute">style</span>=<span class="value">"fill:rgb(200,100,50); stroke:rgb(0,0,100);stroke-width:2"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>解释：cx 圆点的 x 坐标，cy 圆点的 y 坐标；rx 水平半径，ry 垂直半径。</p>
<h3 id="线&lt;line&gt;">线&lt;line&gt;</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">line</span> <span class="attribute">x1</span>=<span class="value">"0"</span> <span class="attribute">y1</span>=<span class="value">"0"</span> <span class="attribute">x2</span>=<span class="value">"300"</span> <span class="attribute">y2</span>=<span class="value">"300"</span> <span class="attribute">style</span>=<span class="value">"stroke:rgb(99,99,99);stroke-width:2"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p> 解释：(x1,y1)为线条的开始坐标；(x2,y2)为线条的结束坐标。</p>
<h3 id="折线&lt;polyline&gt;">折线&lt;polyline&gt;</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">polyline</span> <span class="attribute">points</span>=<span class="value">"0,0 0,20 20,20 20,40 40,40 40,60"</span> <span class="attribute">style</span>=<span class="value">"fill:white;stroke:red;stroke-width:2"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p> 解释：points 属性定义多边形每个角的 x 和 y 坐标。为了可读性，建议x与y坐标用逗号分开，每个角之间的坐标用空格分开。</p>
<h3 id="多边形&lt;polygon&gt;">多边形&lt;polygon&gt;</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">polygon</span> <span class="attribute">points</span>=<span class="value">"220,100 300,210 170,250"</span> <span class="attribute">style</span>=<span class="value">"fill:#cccccc; stroke:#000000;stroke-width:1"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p> 解释：points 属性定义多边形每个角的 x 和 y 坐标。</p>
<h3 id="路径&lt;path&gt;">路径&lt;path&gt;</h3><p>直线指令：<br>M = moveto<br>L = lineto<br>H = horizontal lineto<br>V = vertical lineto<br>Z = closepath<br>注释：以上所有命令均允许小写字母。大写表示绝对定位，小写表示相对定位。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">svg</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="title">path</span> <span class="attribute">d</span>=<span class="value">"M250 150 L150 350 L350 350 Z"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">svg</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>解释：该路径开始于位置 250 150，到达位置 150 350，然后从那里开始到 350 350，最后在 250 150 关闭路径。<br>由于绘制路径的复杂性，建议使用 SVG 编辑器来创建复杂的图形。</p>
<h4 id="svg的贝塞尔曲线">svg的贝塞尔曲线</h4><p>贝塞尔曲线指令：<br>C = curveto<br>S = smooth curveto<br>Q = quadratic Belzier curve<br>T = smooth quadratic Belzier curveto<br>贝塞尔曲线控制小工具<a href="http://dayu.pw/svgcontrol/" target="_blank" rel="external">http://dayu.pw/svgcontrol/</a>，操控多次可加深对贝塞尔曲线的理解。</p>
<p class="user_img"><img src="/img/post/Newcandy/svgImage2.png" alt="三次贝塞尔曲线控制"></p>
<p class="user_img"><img src="/img/post/Newcandy/svgImage3.png" alt="三次贝塞尔曲线控制"></p>
<p>CSQT比较难记，联想记忆法“厕所切图(CSQT)”就比较容易记住了。<br>厕所是3D空间，所以CS是三次曲线噢，切图是平面图，所以是二次曲线，很好记。</p>
<h5 id="C三次贝塞尔曲线">C三次贝塞尔曲线</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C x1 y1, x2 y2, x y (or c dx1 dy1, dx2 dy2, dx dy)</span><br></pre></td></tr></table></figure>
<p>最后一个坐标(x,y)表示的是曲线的终点，另外两个坐标是控制点，(x1,y1)是起点的控制点，(x2,y2)是终点的控制点。小写指令c表示相对坐标。</p>
<h5 id="S光滑三次贝塞尔曲线">S光滑三次贝塞尔曲线</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">S x2 y2, x y (or s dx2 dy2, dx dy)</span><br></pre></td></tr></table></figure>
<p>之所以S命令没有x1 y1，是因为S命令跟在C命令后，x1 y1默认是C命令的第二个控制点的对称点，如下图蓝色线条所示。<br></p><p class="user_img"><img src="/img/post/Newcandy/svgImage4.png" alt="光滑三次贝塞尔曲线控"></p><p></p>
<p>如果前面没有C命令，即S命令单独使用时，S命令画出来的是二次贝塞尔曲线，因为x1 y1和x2 y2默认是同一个控制点了。</p>
<h5 id="Q二次贝塞尔曲线">Q二次贝塞尔曲线</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Q x1 y1, x y (or q dx1 dy1, dx dy)</span><br></pre></td></tr></table></figure>
<h5 id="T光滑二次贝塞尔曲线">T光滑二次贝塞尔曲线</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">T x y (or t dx dy)</span><br></pre></td></tr></table></figure>
<p>T命令的控制点默认是前面C命令的控制点的对称点。<br></p><p class="user_img"><img src="/img/post/Newcandy/svgImage5.png" alt="光滑二次贝塞尔曲线控制"></p><p></p>
<p>如果T命令前面没有C命令，即T命令单独使用时，T命令画出来的是直线。</p>
<h3 id="总结思考-1">总结思考</h3><p>路径比基本形状更强大、更灵活。使用路径绘制复杂图形比较麻烦，但是使用它们来绘制图形的效果大多数时候很赞，一般其他基本图形是做不来的。</p>
<h2 id="第三章：SVG动画">第三章：SVG动画</h2><hr>
<h3 id="svg路径动画">svg路径动画</h3><p>DEMO:<br></p><p class="user_img"><img src="/img/post/Newcandy/svgTruck.gif" alt="路径动画"></p><p></p>
<p>g元素是用于把相关元素进行组合的容器元素。animateMotion使元素沿着动作路径移动，且该路径不可见，path定义的是可见的路径。rotate=”auto”使元素移动得更加自然，会随着路径旋转一定的角度。<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">svg</span> <span class="attribute">width</span>=<span class="value">"1500"</span> <span class="attribute">height</span>=<span class="value">"150"</span> <span class="attribute">class</span>=<span class="value">"truck"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">g</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">use</span> <span class="attribute">xmlns:xlink</span>=<span class="value">"http://www.w3.org/1999/xlink"</span> <span class="attribute">xlink:href</span>=<span class="value">"#truck"</span> <span class="attribute">x</span>=<span class="value">"0"</span> <span class="attribute">y</span>=<span class="value">"0"</span>&gt;</span><span class="tag">&lt;/<span class="title">use</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">animateMotion</span> <span class="attribute">path</span>=<span class="value">"M0 0 C135.5 68 463.5 -8 700 29 S1000 -20 1940,70"</span> <span class="attribute">begin</span>=<span class="value">"-3s"</span> <span class="attribute">dur</span>=<span class="value">"10s"</span> <span class="attribute">rotate</span>=<span class="value">"auto"</span> <span class="attribute">repeatCount</span>=<span class="value">"indefinite"</span>&gt;</span><span class="tag">&lt;/<span class="title">animateMotion</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="title">g</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="title">g</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">use</span> <span class="attribute">xmlns:xlink</span>=<span class="value">"http://www.w3.org/1999/xlink"</span> <span class="attribute">xlink:href</span>=<span class="value">"#truck"</span> <span class="attribute">x</span>=<span class="value">"0"</span> <span class="attribute">y</span>=<span class="value">"0"</span>&gt;</span><span class="tag">&lt;/<span class="title">use</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="title">animateMotion</span> <span class="attribute">path</span>=<span class="value">"M0 0 C135.5 68 463.5 -8 700 29 S1000 -20 1940,70"</span> <span class="attribute">begin</span>=<span class="value">"0s"</span> <span class="attribute">dur</span>=<span class="value">"10s"</span> <span class="attribute">rotate</span>=<span class="value">"auto"</span> <span class="attribute">repeatCount</span>=<span class="value">"indefinite"</span>&gt;</span><span class="tag">&lt;/<span class="title">animateMotion</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="title">g</span>&gt;</span></span><br><span class="line"></span><br><span class="line">      <span class="tag">&lt;<span class="title">path</span> <span class="attribute">d</span>=<span class="value">"M0 30 C135.5 98 463.5 22 700 59 S1000 10 1940,100"</span> <span class="attribute">stroke</span>=<span class="value">"#000"</span> <span class="attribute">stroke-width</span>=<span class="value">"2"</span> <span class="attribute">fill</span>=<span class="value">"none"</span> <span class="attribute">x</span>=<span class="value">"-1000"</span> <span class="attribute">y</span>=<span class="value">"-1000"</span> <span class="attribute">class</span>=<span class="value">"truck_path"</span>&gt;</span><span class="tag">&lt;/<span class="title">path</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">svg</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p><a href="https://github.com/Newcandy/svg/blob/master/path.html" target="_blank" rel="external">点击查看全部代码</a></p>
<h3 id="svg路径描边动画">svg路径描边动画</h3><p>DEMO:<br></p><p class="user_img"><img src="/img/post/Newcandy/svgPhone.gif" alt="路径描边动画"></p><p></p>
<p>在path等元素上必须使用stoke属性，否则动画不执行。stroke 表示描边颜色；stroke-width 表示描边的粗细；<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">svg</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">symbol</span> <span class="attribute">id</span>=<span class="value">"phone"</span> <span class="attribute">viewBox</span>=<span class="value">"0 0 1024 1024"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="title">path</span> <span class="attribute">fill</span>=<span class="value">"none"</span> <span class="attribute">stroke</span>=<span class="value">"#000"</span> <span class="attribute">stroke-width</span>=<span class="value">"3"</span> <span class="attribute">d</span>=<span class="value">"M768 0h-512c-53.056 0-96 42.976-96 96v832c0 53.056 42.976 96 96 96h512c52.992 0 96-43.008 96-96v-832c0-53.056-43.008-96-96-96zM800 928c0 17.632-14.368 32-32 32h-512c-17.664 0-32-14.304-32-32v-64.128h576v64.128zM800 831.872h-576v-639.872h576v639.872zM800 160h-576v-64c0-17.664 14.336-32 32-32h512c17.632 0 32 14.336 32 32v64zM576 112c0 8.832-7.2 16-16 16h-96c-8.864 0-16-7.168-16-16v0c0-8.864 7.136-16 16-16h96c8.8 0 16 7.136 16 16v0zM544 911.872c0 8.8-7.2 16-16 16h-32c-8.832 0-16-7.2-16-16v0c0-8.864 7.168-16 16-16h32c8.8 0 16 7.136 16 16v0z"</span>&gt;</span><span class="tag">&lt;/<span class="title">path</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="title">symbol</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">svg</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>使用CSS3 animation实现，因为内联的svg本身就是Html元素，可以通过CSS3来控制颜色等属性。<br>stroke-dasharray 表示虚线描边；stroke-dashoffset 表示虚线的起始偏移。<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">.device</span> <span class="rules">&#123; <span class="rule"><span class="attribute">position</span>:<span class="value"> absolute</span></span>;<span class="rule"><span class="attribute">top</span>:<span class="value"> <span class="number">43%</span></span></span>;<span class="rule"><span class="attribute">left</span>:<span class="value"> <span class="number">50%</span></span></span>;<span class="rule"><span class="attribute">margin</span>:<span class="value"> -<span class="number">200px</span> <span class="number">0</span> <span class="number">0</span> -<span class="number">200px</span></span></span>;<span class="rule"><span class="attribute">stroke-dasharray</span>:<span class="value"> <span class="number">4000</span></span></span>;<span class="rule"><span class="attribute">stroke-dashoffset</span>:<span class="value"> <span class="number">4000</span></span></span>;<span class="rule"><span class="attribute">-webkit-animation</span>:<span class="value"> dash <span class="number">2s</span> infinite</span></span>;<span class="rule"><span class="attribute">animation</span>:<span class="value"> dash <span class="number">2s</span> infinite</span></span>; &#125;</span></span><br><span class="line">    <span class="at_rule">@<span class="keyword">-webkit-keyframes</span> dash </span>&#123;</span><br><span class="line">      100% <span class="rules">&#123; <span class="rule"><span class="attribute">stroke-dashoffset</span>:<span class="value"> <span class="number">0</span></span></span>; &#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="at_rule">@<span class="keyword">keyframes</span> dash </span>&#123;</span><br><span class="line">      100% <span class="rules">&#123; <span class="rule"><span class="attribute">stroke-dashoffset</span>:<span class="value"> <span class="number">0</span></span></span>; &#125;</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p> <a href="https://github.com/Newcandy/svg/blob/master/stroke.html" target="_blank" rel="external">点击查看全部代码</a></p>
<h3 id="css中的clip-path">css中的clip-path</h3><p> clip-path按照路径内部的尺寸进行裁剪。只有路径内的内容可见。使用方法如下：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">.element</span> <span class="rules">&#123;</span><br><span class="line">    <span class="rule"><span class="attribute">clip-path</span>:<span class="value"> <span class="function">polygon</span>(...)</span></span>; <span class="comment">/* 或者其他的图形函数 */</span></span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 其他图形函数语法 --&gt;</span></span><br><span class="line">circle: circle(radius at x-axis y-axis)</span><br><span class="line">ellipse: ellipse(x-rad y-rad at x-axis y-axis)</span><br><span class="line">polygon: polygon(x-axis y-axis, x-axis y-axis, … )</span><br><span class="line">inset: inset(top right bottom left round top-radius right-radius bottom-radius left-radius)</span><br></pre></td></tr></table></figure>
<p>DEMO1:<br></p><p class="user_img"><img src="/img/post/Newcandy/svgBreakup.gif" alt="clippath"></p><p></p>
<p>利用伪元素:before和:after实现相同大小相同位置的文字，使用clip-path分别裁剪文字：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class">.txt</span> <span class="rules">&#123; <span class="rule"><span class="attribute">display</span>:<span class="value"> inline-block</span></span>;<span class="rule"><span class="attribute">position</span>:<span class="value"> relative</span></span>;<span class="rule"><span class="attribute">font-size</span>:<span class="value"> <span class="number">70px</span></span></span>;<span class="rule"><span class="attribute">text-transform</span>:<span class="value"> uppercase</span></span>;<span class="rule"><span class="attribute">color</span>:<span class="value"> transparent</span></span>; &#125;</span></span><br><span class="line"><span class="comment">/* 此处省略代码 */</span>	</span><br><span class="line"><span class="class">.txt</span><span class="pseudo">:before</span> <span class="rules">&#123; <span class="rule"><span class="attribute">-webkit-clip-path</span>:<span class="value"> <span class="function">polygon</span>(<span class="number">0</span> <span class="number">0</span>,<span class="number">100%</span> <span class="number">0</span>,<span class="number">100%</span> <span class="number">100%</span>)</span></span>;<span class="rule"><span class="attribute">clip-path</span>:<span class="value"> <span class="function">polygon</span>(<span class="number">0</span> <span class="number">0</span>,<span class="number">100%</span> <span class="number">0</span>,<span class="number">100%</span> <span class="number">100%</span>)</span></span>; &#125;</span></span><br><span class="line"><span class="class">.txt</span><span class="pseudo">:after</span> <span class="rules">&#123; <span class="rule"><span class="attribute">-webkit-clip-path</span>:<span class="value"> <span class="function">polygon</span>(<span class="number">0</span> <span class="number">0</span>,<span class="number">0</span> <span class="number">100%</span>,<span class="number">100%</span> <span class="number">100%</span>)</span></span>;<span class="rule"><span class="attribute">clip-path</span>:<span class="value"> <span class="function">polygon</span>(<span class="number">0</span> <span class="number">0</span>,<span class="number">0</span> <span class="number">100%</span>,<span class="number">100%</span> <span class="number">100%</span>)</span></span>; &#125;</span></span><br></pre></td></tr></table></figure></p>
<p><a href="https://github.com/Newcandy/svg/blob/master/clip-path/text.html" target="_blank" rel="external">点击查看全部代码</a></p>
<p>DEMO2：<br></p><p class="user_img"><img src="/img/post/Newcandy/svgLine.gif" alt="clippath"></p><p></p>
<p>如果结合clip-path和keyframes动画，可实现相关元素按照我们的路径逐步出现的效果。clip-path可通过此工具<a href="http://www.bennettfeely.com/clippy/实现复杂的路径。" target="_blank" rel="external">http://www.bennettfeely.com/clippy/实现复杂的路径。</a><br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"> <span class="class">.line</span> <span class="rules">&#123; <span class="rule"><span class="attribute">position</span>:<span class="value"> absolute</span></span>;<span class="rule"><span class="attribute">left</span>:<span class="value"> <span class="number">0</span></span></span>;<span class="rule"><span class="attribute">top</span>:<span class="value"> <span class="number">0</span></span></span>;<span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">28px</span></span></span>;<span class="rule"><span class="attribute">height</span>:<span class="value"> <span class="number">34px</span></span></span>;<span class="rule"><span class="attribute">background</span>:<span class="value"> <span class="function">url</span>(line.png) <span class="number">0</span> <span class="number">0</span> no-repeat</span></span>;<span class="rule"><span class="attribute">-webkit-animation</span>:<span class="value"> moveLine .<span class="number">8s</span> ease infinite</span></span>;<span class="rule"><span class="attribute">animation</span>:<span class="value"> moveLine .<span class="number">8s</span> ease infinite</span></span>; &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="at_rule">@<span class="keyword">-webkit-keyframes</span> moveLine </span>&#123;</span><br><span class="line">  0% <span class="rules">&#123;</span><br><span class="line">    <span class="rule"><span class="attribute">-webkit-clip-path</span>:<span class="value"> <span class="function">polygon</span>(<span class="number">0</span> <span class="number">100%</span>, <span class="number">0</span> <span class="number">100%</span>, <span class="number">0</span> <span class="number">100%</span>)</span></span>;</span><br><span class="line">  &#125;</span></span><br><span class="line">  25% <span class="rules">&#123;</span><br><span class="line">    <span class="rule"><span class="attribute">-webkit-clip-path</span>:<span class="value"> <span class="function">polygon</span>(<span class="number">0</span> <span class="number">82%</span>, <span class="number">100%</span> <span class="number">81%</span>, <span class="number">100%</span> <span class="number">100%</span>, <span class="number">0</span> <span class="number">100%</span>)</span></span>;</span><br><span class="line">  &#125;</span></span><br><span class="line">  50% <span class="rules">&#123;</span><br><span class="line">    <span class="rule"><span class="attribute">-webkit-clip-path</span>:<span class="value"> <span class="function">polygon</span>(<span class="number">20%</span> <span class="number">0%</span>, <span class="number">80%</span> <span class="number">0%</span>, <span class="number">73%</span> <span class="number">47%</span>, <span class="number">74%</span> <span class="number">64%</span>, <span class="number">99%</span> <span class="number">100%</span>, <span class="number">0</span> <span class="number">100%</span>, <span class="number">56%</span> <span class="number">77%</span>, <span class="number">64%</span> <span class="number">58%</span>)</span></span>;</span><br><span class="line">  &#125;</span></span><br><span class="line">  60% <span class="rules">&#123;</span><br><span class="line">    <span class="rule"><span class="attribute">-webkit-clip-path</span>:<span class="value"> <span class="function">polygon</span>(<span class="number">50%</span> <span class="number">0%</span>, <span class="number">72%</span> <span class="number">48%</span>, <span class="number">75%</span> <span class="number">70%</span>, <span class="number">100%</span> <span class="number">100%</span>, <span class="number">0</span> <span class="number">100%</span>, <span class="number">55%</span> <span class="number">78%</span>, <span class="number">5%</span> <span class="number">68%</span>)</span></span>;</span><br><span class="line">  &#125;</span></span><br><span class="line">  75% <span class="rules">&#123;</span><br><span class="line">    <span class="rule"><span class="attribute">-webkit-clip-path</span>:<span class="value"> <span class="function">polygon</span>(<span class="number">28%</span> <span class="number">0</span>, <span class="number">100%</span> <span class="number">34%</span>, <span class="number">79%</span> <span class="number">100%</span>, <span class="number">0</span> <span class="number">100%</span>, <span class="number">0</span> <span class="number">0</span>)</span></span>;</span><br><span class="line">  &#125;</span></span><br><span class="line">  100% <span class="rules">&#123;</span><br><span class="line">    <span class="rule"><span class="attribute">-webkit-clip-path</span>:<span class="value"> <span class="function">polygon</span>(<span class="number">100%</span> <span class="number">0</span>, <span class="number">100%</span> <span class="number">100%</span>, <span class="number">0</span> <span class="number">100%</span>, <span class="number">0</span> <span class="number">0</span>)</span></span>;</span><br><span class="line">  &#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><a href="https://github.com/Newcandy/svg/blob/master/clip-path/line.html" target="_blank" rel="external">点击查看全部代码</a></p>
<h3 id="总结思考-2">总结思考</h3><p>本章主要介绍svg路径动画，svg路径描边动画以及css中的clip-path，从中我们也发现了路径的强大之处，如若能在项目中灵活使用，无非给动画添加更生动的效果。</p>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="第一章：SVG入门篇">第一章：SVG入门篇</h2><h3 id="SVG简介">SVG简介</h3><p>SVG即Scalable Vector Graphics可缩放矢量图形，使用XML格式定义图形。<br>优点：</p>
<ul>
<li>SVG与其他图片]]>
    </summary>
    
      <category term="svg" scheme="http://aotu.io/tags/svg/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Git常用操作总结]]></title>
    <link href="http://aotu.io/notes/2015/11/17/Git-Commands/"/>
    <id>http://aotu.io/notes/2015/11/17/Git-Commands/</id>
    <published>2015-11-17T12:44:25.000Z</published>
    <updated>2015-12-10T02:02:53.000Z</updated>
    <content type="html"><![CDATA[<p>用Git比较久了，之前一直在Win用的TortoiseGit，现在命令行用的比较多，所以把一些指令总结一下，以便回顾和查询。<br>理解这些指令，觉得最重要的是理解Git的内部原理，比如Git的分布式版本控制，分清楚工作区、暂存区、版本库，还有就是理解Git跟踪并管理的是修改，而非文件。</p>
<a id="more"></a>
<h3 id="设置">设置</h3><pre><code>$ git config --global user<span class="class">.name</span> <span class="string">"Your Name"</span>
$ git config --global user<span class="class">.email</span> <span class="string">"email@example.com"</span>
</code></pre><h3 id="提交">提交</h3><p>git tracked的是修改，而不是文件</p>
<p><img src="/img/post/mamboer/git-trees.jpg" alt="git-track"></p>
<pre><code><span class="comment">#将“当前修改”移动到暂存区(stage)</span>
<span class="variable">$ </span>git add somfile.txt
<span class="comment">#将暂存区修改提交</span>
<span class="variable">$ </span>git commit -m <span class="string">"Add somfile.txt."</span>
</code></pre><h3 id="状态">状态</h3><pre><code><span class="variable">$ </span>git status
<span class="variable">$ </span>git diff
</code></pre><h3 id="回退">回退</h3><pre><code># 放弃工作区修改
$ git checkout <span class="comment">-- file.name</span>
$ git checkout <span class="comment">-- .</span>

# 取消<span class="operator"><span class="keyword">commit</span>(比如需要重写<span class="keyword">commit</span>信息)
$ git <span class="keyword">reset</span> <span class="comment">--soft HEAD</span>

# 取消<span class="keyword">commit</span>、<span class="keyword">add</span>(重新提交代码和<span class="keyword">commit</span>)
$ git <span class="keyword">reset</span> <span class="keyword">HEAD</span>
$ git <span class="keyword">reset</span> <span class="comment">--mixed HEAD</span>

# 取消<span class="keyword">commit</span>、<span class="keyword">add</span>、工作区修改(需要完全重置)
$ git <span class="keyword">reset</span> <span class="comment">--hard HEAD</span></span>
</code></pre><h3 id="记录">记录</h3><pre><code><span class="variable">$ </span>git reflog
<span class="variable">$ </span>git log
</code></pre><h3 id="删除">删除</h3><pre><code>$ <span class="keyword">rm</span> <span class="keyword">file</span>.name
$ git <span class="keyword">rm</span> <span class="keyword">file</span>.name
$ git commit -<span class="keyword">m</span> <span class="string">"Del"</span>
</code></pre><h3 id="远程操作">远程操作</h3><pre><code>$ git remote add origin git@github.com:michaelliao/learngit.git
<span class="comment"># 第一次推送，-u(--set-upstream)指定默认上游</span>
$ git push -u origin <span class="keyword">master</span>
<span class="title">$</span> git push origin <span class="literal">master</span>
</code></pre><h3 id="克隆">克隆</h3><pre><code>$ git clone https:<span class="comment">//github.com/Yikun/yikun.github.com.git path</span>
$ git clone git@github<span class="class">.com</span>:Yikun/yikun<span class="class">.github</span><span class="class">.com</span><span class="class">.git</span> path
</code></pre><h3 id="分支操作">分支操作</h3><p><img src="/img/post/mamboer/git-merge.png" alt="about-merge"></p>
<pre><code><span class="comment"># 查看当前分支</span>
<span class="variable">$ </span>git branch

<span class="comment"># 创建分支</span>
<span class="variable">$ </span>git branch dev
<span class="comment"># 切换分支</span>
<span class="variable">$ </span>git checkout dev

<span class="comment"># 创建并checkout分支</span>
<span class="variable">$ </span>git checkout -b dev

<span class="comment"># 合并分支</span>
<span class="variable">$ </span>git merge dev

<span class="comment"># 删除分支</span>
<span class="variable">$ </span>git branch -d dev
</code></pre><h3 id="标签">标签</h3><pre><code>$ git <span class="keyword">tag</span> <span class="title">0</span>.<span class="number">1.1</span>
$ git push origin --tags
</code></pre><p>注意：本文Fork自 <a href="http://yikun.github.io/" target="_blank" rel="external">yikun.github.io</a>，<a href="http://aotu.io">凹凸实验室</a>作进一步完善。</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>用Git比较久了，之前一直在Win用的TortoiseGit，现在命令行用的比较多，所以把一些指令总结一下，以便回顾和查询。<br>理解这些指令，觉得最重要的是理解Git的内部原理，比如Git的分布式版本控制，分清楚工作区、暂存区、版本库，还有就是理解Git跟踪并管理的是修改，而非文件。</p>]]>
    
    </summary>
    
      <category term="Fork" scheme="http://aotu.io/tags/Fork/"/>
    
      <category term="Git" scheme="http://aotu.io/tags/Git/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[101%还原]]></title>
    <link href="http://aotu.io/notes/2015/11/16/101-percent/"/>
    <id>http://aotu.io/notes/2015/11/16/101-percent/</id>
    <published>2015-11-15T21:39:14.000Z</published>
    <updated>2015-12-10T02:02:53.000Z</updated>
    <content type="html"><![CDATA[<p><em>100%还原设计稿，还原误差不超1像素</em> 是重构工程师入行的最基本要求，而在实际工作中，这100%是远远不够的。</p>
<p> 记得曾经带我的师傅说过一句话：</p>
<blockquote>
<p>重构工程师不应该满足100%还原设计稿，更应该去追求101%还原度。</p>
</blockquote>
<p>101%还原是重构工程师在还原设计稿的过程中，发挥自身的主观能动性，对设计稿进行修正或向产品、视觉、交互提出合理的建议，让最终还原出来的视觉设计稿更接近设计本意。</p>
<p>101%的还原可以归为两类，一类是<strong>对视觉稿的主动修正</strong>，不包括具有信息传达的内容；另一类是<strong>对视觉稿深入思考并提出合理建议</strong>，包括但不限于具有信息传达的内容。</p>
<h2 id="对视觉稿的主动修正">对视觉稿的主动修正</h2><p>视觉设计师有时候会比较忙，设计稿中可能会出现像素之间的误差而造成不对齐的情况，如下面的设计稿：</p>
<p><img src="http://missoy.me/wp-content/uploads/2015/07/img1.jpg" alt="image"></p>
<p><em>（Retina 2X图）</em></p>
<p>很明显，视觉设计师原意是想让右则的按钮垂直居中对齐的，我们在还原的时候可以去微调边距让之对齐，得到下面的重构稿：</p>
<p><img src="http://missoy.me/wp-content/uploads/2015/07/img2.jpg" alt="image"></p>
<p><em>（重构稿1X图）</em></p>
<p>可以看到，还原出来的设计稿虽然和原设计稿并没有100%吻合，但是出来的效果确实更符合垂直居中对齐的准则，更接近设计的本意，而且节省了沟通的成本。</p>
<p>有些同学许会问，在没有周知视觉设计师的情况下私下改动设计稿貌似有点不太尊重视觉设计师的工作吧?</p>
<p><strong>对视觉稿的主动修正有一个很重要的原则，就是在没有信发生息传达的情况下修正，所作的修正不能违背设计本意。</strong>拿刚才的例子来说，如果我个人不喜欢按钮的边角是方角的，就私下把方角还原成圆角，如下图：</p>
<p><img src="http://missoy.me/wp-content/uploads/2015/07/img3.jpg" alt="image"></p>
<p>那就产生了还原稿与设计原稿之间的信息传达内容了，因为方角和圆角是两个不一样的设计风格，圆角按钮明显不是视觉设计师的设计本意，如果圆角按钮在视觉设计师完全不知情的情况下上了线，那就是真正的不尊重视觉设计师的工作了。</p>
<p>当然视觉设计师都希望自己输出的设计稿完美无缺，但一些客观因素（交接模块）或主观上的操作（工作太忙，拖动元素排版的时候手抖）难免会让设计稿存在一些像素级的误差，对视觉稿的主动修正，是和视觉设计师协作的一种默契，如果每一项这样的修正都要让视觉设计师重新去调整再生成新的PSD文件的话，沟通成本未免过高</p>
<h2 id="对视觉稿深入思考并提出合理建议">对视觉稿深入思考并提出合理建议</h2><p>我们先看一下下面的设计稿：</p>
<p><img src="http://missoy.me/wp-content/uploads/2015/07/img4.jpg" alt="image"></p>
<p>从视觉稿来看，视觉设计师把“关注本店”、“关注公众号”和“联系卖家”这三项的按钮所占的区域作了等分处理，按钮里面的文案和icon水平居中</p>
<p>等分的排版，虽然个体之间的内容不一样会出现内容与分隔线边距不相等的情况，但是在按钮所占展示区域比例相等的情况下，三个按钮整体看上去是非常整齐的，排版逻辑很清晰：</p>
<p><img src="http://missoy.me/wp-content/uploads/2015/07/img5.jpg" alt="image"></p>
<p>可以看出，让三个按钮在页面上的排版整体看起来是整齐的是设计师的设计本意，那么问题来了：</p>
<p>在还原设计稿中，我们通常会考虑到布局的扩展性，会考虑到不足三个按钮或者多于三个按钮的排版情况，如果按照等分的排版型去还原，按钮出现增减的话，就会出现下面的情况：</p>
<p><img src="http://missoy.me/wp-content/uploads/2015/07/img6.jpg" alt="image"></p>
<p><em>（等分四个按钮）</em></p>
<p><img src="http://missoy.me/wp-content/uploads/2015/07/img7.jpg" alt="image"></p>
<p><em>（等分：三个按钮）</em></p>
<p><img src="http://missoy.me/wp-content/uploads/2015/07/img8.jpg" alt="image"></p>
<p><em>（等分：两个按钮）</em></p>
<p><img src="http://missoy.me/wp-content/uploads/2015/07/img9.jpg" alt="image"></p>
<p><em>（等分：一个按钮）</em></p>
<p>可以看到，大于3个按钮的时候，文案的展示出现了问题，小于3个按钮的时候按钮的大小和文案与分隔线的间距就略显夸张了，特别是只有一个按钮的情况，几种情况的排版在视觉上变化都很大，而且视觉稿里是没有相应的展示的，那么这里面包含了排版之间的信息传达。</p>
<p><strong>在还原过程中，当发生信息传达的时候，任何疑问和建议都应该周知相关的负责人，这是101%还原中的基本原则</strong></p>
<p>把刚才上面的几种情况，写好demo向产品和视觉设计师展示，反馈并确认两个问题：</p>
<ul>
<li><p>按钮在不同的场景中最多展示的个数和最少展示的个数</p>
</li>
<li><p>如果按钮展示个数有变，用等分自适应排版的话，以上情况的排版方式能否接受</p>
</li>
</ul>
<p>然后得到的答复是：</p>
<p><em>产品：最多展示3个，最少展示1个，排版看还有没有更好的</em></p>
<p><em>视觉：按钮不用等分自适应，用定宽展示的</em></p>
<p>可以get到信息：</p>
<p>等分自适应的排版在这里不适用：<em>对视觉设计稿排版信息的理解与视觉设计师的原意有出入</em></p>
<p>与产品和视觉设计师对相应的信息进行确认后，于是给到了定宽的效果：</p>
<p><img src="http://missoy.me/wp-content/uploads/2015/07/img10.jpg" alt="image"></p>
<p><em>（定宽：三个按钮）</em></p>
<p><img src="http://missoy.me/wp-content/uploads/2015/07/img11.jpg" alt="image"></p>
<p><em>（定宽：两个按钮）</em></p>
<p><img src="http://missoy.me/wp-content/uploads/2015/07/img12.jpg" alt="image"></p>
<p><em>（定宽：一个按钮）</em></p>
<p>定宽排版与等分排版两个方式对比来看：</p>
<ul>
<li><p>定宽排版的3个按钮与等分排版的效果一样</p>
</li>
<li><p>定宽排版的2个按钮比等分排版的效果差。</p>
</li>
<li><p>定宽排版的时候，按钮所占空间并没有等分展示区域，而文案离分隔线的间距又不相等，排版逻辑不清晰，显得很不整齐</p>
</li>
<li><p>定宽排版的1个按钮比等分排版的效果好。</p>
</li>
</ul>
<p>等分排版的时候，虽然按钮在展示区域中是居中对齐了，但是考虑到上下文的对齐，按钮并没有和星星的对齐，相反，等宽排版的文案更接近与星星的左对齐，虽然并没有绝对对齐，只是展现出来的排版效果、与上下文的排版逻辑显得更严谨。</p>
<p>其实两种排版的文案都没有办法100%保证与星星左对齐的，因为文案长度不一样，居中的位置就不一样：</p>
<p><img src="http://missoy.me/wp-content/uploads/2015/07/img13.jpg" alt="image"></p>
<p><em>（定宽、等分的居中文案）</em></p>
<p>综合以上，向产品和视觉设计师提出建议：按钮的文案与分隔线间距相等，并且第一个按钮的文案与星星左对齐。于是得到了最终的效果：</p>
<p><img src="http://missoy.me/wp-content/uploads/2015/07/img14.jpg" alt="image"></p>
<p><em>（优化后的）</em></p>
<p><img src="http://missoy.me/wp-content/uploads/2015/07/img15.jpg" alt="image"></p>
<p><em>（优化后的）</em></p>
<p><img src="http://missoy.me/wp-content/uploads/2015/07/img16.jpg" alt="image"></p>
<p><em>（优化后的）</em></p>
<p>这与原有的设计稿相比，扩展性更强，排版逻辑更严谨性、更趋向设计本意，建议是合理的。</p>
<p>优化的地方虽然不大，但我们需要对设计稿进行认真深入的分析，从产品层面、视觉层面、开发层面甚至交互层面去尽可能地解读设计稿，深入思考才能发现问题，提出合理的建议，101% 中的 1% 威力就会慢慢的程现出来。</p>
<h3 id="一个特殊的例子">一个特殊的例子</h3><p><img src="http://missoy.me/wp-content/uploads/2015/07/img17.jpg" alt="image"></p>
<p>由于项目快速迭代，视觉设计资源紧缺的原因，于是有了这张没有经过视觉流程的设计稿，是一位产品GG给到的，如果我们拿到设计稿，不加以思考的话，100%还原出来，那么</p>
<p>得到了第一稿：</p>
<p><img src="http://missoy.me/wp-content/uploads/2015/07/img18.jpg" alt="image"></p>
<p>其实认真思考一下，可优化的地方还是有的：</p>
<p><strong>交互上</strong></p>
<ul>
<li><img src="http://missoy.me/wp-content/uploads/2015/07/img19.jpg" alt="image"> 和 <img src="http://missoy.me/wp-content/uploads/2015/07/img20.jpg" alt="image"> 这两个其实只是文案中的一部分，并没有任何交互，设计稿上却做成了和文本形成强烈对比的看上去可点击的按钮，容易误导用户去点</li>
</ul>
<p><strong>视觉上</strong></p>
<ul>
<li><p>复制按钮的配色欠恰当，复制的操作并不会引起用户警告或错误的提示，而红色恰好有让人警惕的意味</p>
</li>
<li><p>输入框和复制按钮的高度不一样，显得不够整齐美观</p>
</li>
<li><p>内容和顶部的间距太小，内容视觉焦点欠佳</p>
</li>
</ul>
<p>交互和视觉上都涉及到不同的信息传达，因此不能用对视觉稿进行主动修正，将以上信息和产品反馈</p>
<p>最终建议：</p>
<ul>
<li><p>“添加朋友” 和 “关注” 采用文本加色强调形式表现</p>
</li>
<li><p>复制按钮的颜色采取常用的给人友好感觉的绿色</p>
</li>
<li><p>调整复制按钮的调试使之与输入框的调试一样</p>
</li>
<li><p>调整内容与顶部的间距大小</p>
</li>
</ul>
<p>得到了第二稿：</p>
<p><img src="http://missoy.me/wp-content/uploads/2015/07/img21.jpg" alt="image"></p>
<p><em>（第二稿）</em></p>
<p>第二稿中“您已收藏店铺，可在个人中心查看”的收藏反馈提示是产品新增的内容，一开始要求放在上图的位置，虽然第二稿在交互和视觉上得到了一定的优化，但还有优化的空间，特别是</p>
<p><strong>产品上</strong></p>
<ul>
<li>文字左对齐可显页面排版整齐，但从内容的亲密性上看，最底部的已收藏文字反馈提示并不属于引导操作的内容</li>
</ul>
<p>最终建议：</p>
<ul>
<li><p>让反馈内容居中对齐</p>
</li>
<li><p>增加与操作内容的边距，让用户可以一目了然看到反馈内容的归属</p>
</li>
<li><p>调整文案强调色的色系，让其不至于过重而显得太突眼。</p>
</li>
</ul>
<p>最终得到101%的还原效果：</p>
<p><img src="http://missoy.me/wp-content/uploads/2015/07/img22.jpg" alt="image"></p>
<p>这个例子中，最终还原出来的效果也许没有视觉设计师那么专业，但至少还原稿上多了一份思考，多了一份心思，在这过程中也能让大家去探讨一些非自己职位上的知识，互相学习，互相提高。</p>
<p>从100%到101%的过程，其实就是一个主动思考，积极执行的过程，是一个追求极致的过程，是一个把事做好的过程。在还原设计稿的过程中，1%在100%中占的比例不多，但是如果能把这1%处理得好，还原出来的设计稿会更具级数。</p>
]]></content>
    <summary type="html">
    <![CDATA[<p><em>100%还原设计稿，还原误差不超1像素</em> 是重构工程师入行的最基本要求，而在实际工作中，这100%是远远不够的。</p>
<p> 记得曾经带我的师傅说过一句话：</p>
<blockquote>
<p>重构工程师不应该满足100%还原设计稿，更应该去追求10]]>
    </summary>
    
      <category term="设计理念还原" scheme="http://aotu.io/tags/%E8%AE%BE%E8%AE%A1%E7%90%86%E5%BF%B5%E8%BF%98%E5%8E%9F/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[基于phantomJs的网络爬虫]]></title>
    <link href="http://aotu.io/notes/2015/11/11/phantomJs-crawler/"/>
    <id>http://aotu.io/notes/2015/11/11/phantomJs-crawler/</id>
    <published>2015-11-11T09:59:33.000Z</published>
    <updated>2015-12-10T02:02:53.000Z</updated>
    <content type="html"><![CDATA[<h1 id="基于phantomJs2-0的网络爬虫">基于phantomJs2.0的网络爬虫</h1><p><strong>phantomJs</strong>是一个基于WebKit的服务器端JavaScript API。它全面支持web而不需浏览器支持，其快速，原生支持各种Web标准： DOM 处理, CSS 选择器, JSON, Canvas, 和 SVG。PhantomJS可以用于页面自动化，网络监测，网页截屏，以及无界面测试等。</p>
<h3 id="用途概述：">用途概述：</h3><ul>
<li><strong>屏幕快照</strong> ：官方提供的API中<a href="http://phantomjs.org/api/webpage/method/render.html" target="_blank" rel="external">page.render</a> 提供了强大的屏幕快照功能；</li>
<li><strong>网络爬虫</strong> ：<a href="http://phantomjs.org/api/webpage/method/evaluate.html" target="_blank" rel="external">page.evaluate</a> 方法提供了一个沙箱来帮助你像用js操作dom一样简单的获取你想要的内容，避免了使用复杂的正则匹配内容；</li>
<li><strong>网络情况监控</strong> ：定期对网站进行pageSpeed检查、可用于打开速度缓慢短信报警等服务(本文暂不做深入介绍)。</li>
<li><strong>页面自动化操作</strong> ：phantomJs2.0 提供了丰富的API用于页面自动化操作</li>
</ul>
<hr>
<h2 id="关于安装">关于安装</h2><blockquote>
<p>网络上有大量的安装教程，如果你用的osx，建议直接<code>brew update &amp;&amp; brew install phantomjs</code>。此处只叙述下在安装过程中遇到的一个坑。</p>
</blockquote>
<p>在Mac OS Yosemite  版本可能都会遇到这样一个问题：<br>运行 <code>phantomjs hello.js</code> 后得到了报错信息：<code>Killed: 9</code><br>这个问题的原始链接在这里<a href="https://github.com/ariya/phantomjs/issues/12928" target="_blank" rel="external">github:issue/12928</a> 解决方案如下：<a href="http://stackoverflow.com/questions/28267809/phantomjs-getting-killed-9-for-anything-im-trying" target="_blank" rel="external">stackoverflow</a></p>
<ol>
<li>Install UPX. UPX is an executable packer and unpacker<br> <code>$ brew install upx</code></li>
<li>Unpack the phantomjs executable<br> <code>$ upx -d phantomjs-2.0.0-macosx/bin/phantomjs</code></li>
<li>Run the phantomjs executable<br> <code>$ ./phantomjs-2.0.0-macosx/bin/phantomjs</code></li>
</ol>
<h2 id="先感受下phantomJs的强大">先感受下phantomJs的强大</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> page = <span class="keyword">require</span>(<span class="string">'webpage'</span>).create();</span><br><span class="line">page.open(<span class="string">'http://jd.com'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">page.render(<span class="string">'jd.png'</span>);</span><br><span class="line">phantom.<span class="keyword">exit</span>();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>把以上代码保存到screen.js，切到terminal：<br><code>$ phantomejs screen.js</code></p>
<p><strong>可以得到如下的网站截图：</strong><br><img src="http://ww1.sinaimg.cn/large/80c4aaf9gw1ey49t6wl41j20rb0d1jxj.jpg" alt="Alt text"></p>
<blockquote>
<p>当然还可以继续<a href="http://phantomjs.org/api/webpage/property/scroll-position.html" target="_blank" rel="external">page.scrollPosition</a>以及Js脚本做延时截图，来避免截图中出现图片未加载完全等问题。</p>
</blockquote>
<h2 id="页面自动化操作">页面自动化操作</h2><h3 id="自动登录京东">自动登录京东</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> page = <span class="built_in">require</span>(<span class="string">'webpage'</span>).create();</span><br><span class="line"></span><br><span class="line">page.onLoadStarted =<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    loadInProgress =<span class="literal">true</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"load started"</span>);</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line">page.onLoadFinished = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    loadInProgress = <span class="literal">false</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"load finished"</span>);</span><br><span class="line">&#125;;</span><br><span class="line">page.onUrlChanged = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"onUrlChanged"</span>);</span><br><span class="line">&#125;;</span><br><span class="line"> page.open(<span class="string">'https://passport.jd.com/new/login.aspx'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    page.includeJs(<span class="string">"http://apps.bdimg.com/libs/jquery/1.6.4/jquery.js"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> rect = page.evaluate(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            $(<span class="string">'#loginname'</span>).val(<span class="string">'username'</span>);</span><br><span class="line">            $(<span class="string">'#nloginpwd'</span>).val(<span class="string">'passwd'</span>);</span><br><span class="line">            $(<span class="string">'#loginsubmit'</span>)[<span class="number">0</span>].click();</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">document</span>.title;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">//若引入jQuery 则用这种方法来实现click</span></span><br><span class="line">        page.sendEvent(<span class="string">'click'</span>, rect.left + rect.width / <span class="number">2</span>, rect.top + rect.height / <span class="number">2</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(rect);</span><br><span class="line">        <span class="keyword">var</span> clock =setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            page.render(<span class="string">'jdlogin.png'</span>);</span><br><span class="line">            phantom.exit();</span><br><span class="line">        &#125;,<span class="number">2000</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>phantomJs2.0中click事件不是标准事件<br> 若 <code>page.evaluate</code>中操作dom时并未引入jQuery，则应自己实现一个click事件如下：</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">click</span>(<span class="params">el</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> ev = <span class="built_in">document</span>.createEvent(<span class="string">"MouseEvent"</span>);</span><br><span class="line">    ev.initMouseEvent(</span><br><span class="line">        <span class="string">"click"</span>,</span><br><span class="line">        <span class="literal">true</span> <span class="comment">/* bubble */</span>, <span class="literal">true</span> <span class="comment">/* cancelable */</span>,</span><br><span class="line">        <span class="built_in">window</span>, <span class="literal">null</span>,</span><br><span class="line">        <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="comment">/* coordinates */</span></span><br><span class="line">        <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="literal">false</span>, <span class="comment">/* modifier keys */</span></span><br><span class="line">        <span class="number">0</span> <span class="comment">/*left*/</span>, <span class="literal">null</span></span><br><span class="line">    );</span><br><span class="line">    el.dispatchEvent(ev);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>解决方案来自<a href="http://stackoverflow.com/questions/15739263/phantomjs-click-an-element" target="_blank" rel="external">stackoverflow:questions/15739263</a></p>
<p><strong>登录后截屏</strong><br><img src="http://ww3.sinaimg.cn/large/80c4aaf9gw1ey49s5j9pjj20rd0hiaic.jpg" alt="Alt text"></p>
<blockquote>
<p>可以看到此登录并未触发验证，若用别的网站被脱库的账号密码来批量查询的话，有很大概率撞库。</p>
</blockquote>
<h2 id="网络爬虫">网络爬虫</h2><h3 id="数据抓取的快感">数据抓取的快感</h3><blockquote>
<p>众所周知知乎的搜索如此之烂，刚看过的问题，再搜就搜不到了，那把知乎上你想要的分类的问题抓取下来，自己搜索咯。（当然想这么一个烂理由来抓人家的数据也是醉人）。随便抓人家的数据不好，此处只做技术分享，切勿用于商业用途。</p>
</blockquote>
<h5 id="批量抓取知乎某个分类下的所有问题">批量抓取知乎某个分类下的所有问题</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> page = <span class="built_in">require</span>(<span class="string">'webpage'</span>).create(),</span><br><span class="line">    testindex = <span class="number">0</span>,</span><br><span class="line">    finalAns = [],</span><br><span class="line">    fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line">page.onLoadStarted =<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    loadInProgress =<span class="literal">true</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"load started"</span>);</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line">page.onLoadFinished = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    loadInProgress = <span class="literal">false</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"load finished"</span>);</span><br><span class="line">&#125;;</span><br><span class="line">page.onUrlChanged = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"onUrlChanged"</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> circle = setInterval(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    testindex++;</span><br><span class="line">    <span class="keyword">if</span>(testindex === <span class="number">51</span>)&#123;</span><br><span class="line">        clearInterval(circle);</span><br><span class="line">        phantom.exit();</span><br><span class="line">    &#125;</span><br><span class="line">    page.open(<span class="string">'http://www.zhihu.com/topic/19559937?page='</span>+testindex, <span class="function"><span class="keyword">function</span>(<span class="params">status</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(status == <span class="string">'fail'</span>)&#123;</span><br><span class="line">            testindex--;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> rect = page.evaluate(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> titleArr = [];</span><br><span class="line">            <span class="built_in">window</span>.scrollTo(<span class="number">0</span>,<span class="built_in">document</span>.body.scrollHeight);</span><br><span class="line">                <span class="keyword">var</span> title = $(<span class="string">'.feed-item .question_link'</span>);</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; title.length; j++)&#123;</span><br><span class="line">                    titleArr[j] = title[j].text;</span><br><span class="line">                &#125;</span><br><span class="line">            <span class="keyword">return</span> titleArr;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">if</span>(rect == <span class="literal">null</span>)&#123;</span><br><span class="line">            testindex--;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        file = fs.open(<span class="string">"liuxue.txt"</span>, <span class="string">'a'</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> h = <span class="number">0</span>; h &lt; rect.length; h++)&#123;</span><br><span class="line">            file.write(rect[h]+<span class="string">'\n'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        file.close();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;,<span class="number">2000</span>);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>其中用到了批量page.open 页面来控制翻页到所有的问题，然后将查询到的数据写入文件中，用到了File System API.</p>
</blockquote>
<h3 id="运用场景畅想">运用场景畅想</h3><ol>
<li>网络性能测试可用于批量、定期对竞品网站做查询，进行竞品分析如打开速度、改版频率等等。</li>
<li>网络爬虫可批量获取数据进行竞品分析、行业报告等。</li>
<li>页面自动化操作可用于网站自动化测试等。</li>
</ol>
]]></content>
    <summary type="html">
    <![CDATA[<h1 id="基于phantomJs2-0的网络爬虫">基于phantomJs2.0的网络爬虫</h1><p><strong>phantomJs</strong>是一个基于WebKit的服务器端JavaScript API。它全面支持web而不需浏览器支持，其快速，原生支持各种]]>
    </summary>
    
      <category term="Crawler" scheme="http://aotu.io/tags/Crawler/"/>
    
      <category term="PhantomJS" scheme="http://aotu.io/tags/PhantomJS/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[css层叠顺序探究]]></title>
    <link href="http://aotu.io/notes/2015/11/08/css-stack-order/"/>
    <id>http://aotu.io/notes/2015/11/08/css-stack-order/</id>
    <published>2015-11-08T11:44:25.000Z</published>
    <updated>2015-12-10T02:02:53.000Z</updated>
    <content type="html"><![CDATA[<p>嗯~一个比较基础但容易混乱的知识点~<br>首先上一大段文绉绉的w3c规范以表明这是一篇严肃的学术文章（觉得太长可先跳过~）：</p>
<blockquote>
<p>In CSS 2.1, each box has a position in three dimensions. In addition to their horizontal and vertical positions, boxes lie along a “z-axis” and are formatted one on top of the other. Z-axis positions are particularly relevant when boxes overlap visually.<br>The order in which the rendering tree is painted onto the canvas is described in terms of stacking contexts. Stacking contexts can contain further stacking contexts. A stacking context is atomic from the point of view of its parent stacking context; boxes in other stacking contexts may not come between any of its boxes.<br>Each box belongs to one stacking context. Each positioned box in a given stacking context has an integer stack level, which is its position on the z-axis relative other stack levels within the same stacking context. Boxes with greater stack levels are always formatted in front of boxes with lower stack levels. Boxes may have negative stack levels. Boxes with the same stack level in a stacking context are stacked back-to-front according to document tree order.<br>——<a href="http://www.w3.org/TR/CSS2/visuren.html#propdef-z-index" target="_blank" rel="external">W3C</a></p>
</blockquote>
<p>其实说人话，大致意思就是：<br><strong>每个盒模型的位置是三维的，除了x轴和y轴，还有一个表示层叠的z轴；<br>z轴上的位置决定了我们看到的盒模型之间的层叠效果（谁盖住谁）。</strong></p>
<p>上述规范还解释了层叠上下文的特点以及盒模型的层叠级别，下面我们通过栗子慢慢探究。</p>
<h2 id="1-_浮动与行内">1. 浮动与行内</h2><p><em>eg.1-1/eg.1-2共同结构与样式：</em><br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"div1"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"div2"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"div3"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"div4"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"div5"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">div</span><span class="rules">&#123;<span class="rule"><span class="attribute">border</span>:<span class="value"> <span class="number">1px</span> <span class="hexcolor">#000</span> dashed</span></span>;<span class="rule"><span class="attribute">height</span>:<span class="value"><span class="number">200px</span></span></span>;<span class="rule"><span class="attribute">width</span>:<span class="value"><span class="number">300px</span></span></span>;<span class="rule"><span class="attribute">text-align</span>:<span class="value"> center</span></span>;&#125;</span></span><br><span class="line"><span class="class">.div1</span><span class="rules">&#123;<span class="rule"><span class="attribute">background-color</span>:<span class="value"> <span class="hexcolor">#FF4363</span></span></span>;<span class="rule"><span class="attribute">margin</span>:<span class="value"><span class="number">0</span> <span class="number">0</span></span></span>;&#125;</span></span><br><span class="line"><span class="class">.div2</span><span class="rules">&#123;<span class="rule"><span class="attribute">background-color</span>:<span class="value"> <span class="hexcolor">#FC9D99</span></span></span>;<span class="rule"><span class="attribute">margin</span>:<span class="value">-<span class="number">170px</span> <span class="number">20px</span></span></span>;&#125;</span></span><br><span class="line"><span class="class">.div3</span><span class="rules">&#123;<span class="rule"><span class="attribute">background-color</span>:<span class="value"> <span class="hexcolor">#F9CCAD</span></span></span>;<span class="rule"><span class="attribute">margin</span>:<span class="value">-<span class="number">160px</span> <span class="number">40px</span></span></span>;&#125;</span></span><br><span class="line"><span class="class">.div4</span><span class="rules">&#123;<span class="rule"><span class="attribute">background-color</span>:<span class="value"> <span class="hexcolor">#C7C7A8</span></span></span>;<span class="rule"><span class="attribute">margin</span>:<span class="value">-<span class="number">150px</span> <span class="number">60px</span></span></span>;&#125;</span></span><br><span class="line"><span class="class">.div5</span><span class="rules">&#123;<span class="rule"><span class="attribute">background-color</span>:<span class="value"> <span class="hexcolor">#84AF9B</span></span></span>;<span class="rule"><span class="attribute">margin</span>:<span class="value">-<span class="number">140px</span> -<span class="number">10px</span></span></span>;&#125;</span></span><br></pre></td></tr></table></figure>
<hr>
<p><em>eg.1-1：常规流中非定位非行内元素的层叠情况</em><br></p><p class="user_img"><img src="/img/post/Yettyzyt/1-1-normal-order.png"></p><p></p>
<p><strong>结论： 常规流中非定位非行内的元素根据html顺序，按照“后来居上”的规则层叠。</strong></p>
<hr>
<p><em>eg.1-2：定位元素／行内元素／浮动元素之间的层叠关系</em><br></p><p class="user_img"><img src="/img/post/Yettyzyt/1-2-change-order.png"></p><p></p>
<p><strong>结论： 层叠顺序如下（高➡低）：<br>z-index为auto的定位元素；<br>常规流内行内非定位元素；<br>非定位的浮动元素；<br>常规流内非行内非定位元素；<br>z-index为负的定位元素。</strong></p>
<h2 id="2-_为定位元素设置z-index">2. 为定位元素设置z-index</h2><p>首先，你必须了解以下两点：</p>
<ul>
<li>每个定位元素都有一个整型的层叠级别（stack level）；</li>
<li>z-index属性只对定位元素有效。</li>
</ul>
<hr>
<p><em>eg.2-1/eg.2-2共同结构与样式：</em><br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"div1"</span> <span class="attribute">style</span>=<span class="value">"position:relative"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"div2"</span> <span class="attribute">style</span>=<span class="value">"position:relative"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"div3"</span> <span class="attribute">style</span>=<span class="value">"position:relative"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"div4"</span> <span class="attribute">style</span>=<span class="value">"position:relative"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"div5"</span> <span class="attribute">style</span>=<span class="value">"position:relative"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">div</span><span class="rules">&#123;<span class="rule"><span class="attribute">border</span>:<span class="value"> <span class="number">1px</span> <span class="hexcolor">#000</span> dashed</span></span>;<span class="rule"><span class="attribute">height</span>:<span class="value"><span class="number">200px</span></span></span>;<span class="rule"><span class="attribute">width</span>:<span class="value"><span class="number">300px</span></span></span>;<span class="rule"><span class="attribute">text-align</span>:<span class="value"> center</span></span>;&#125;</span></span><br><span class="line"><span class="class">.div1</span><span class="rules">&#123;<span class="rule"><span class="attribute">background-color</span>:<span class="value"> <span class="hexcolor">#FF4363</span></span></span>;<span class="rule"><span class="attribute">margin</span>:<span class="value"><span class="number">0</span> <span class="number">0</span></span></span>;&#125;</span></span><br><span class="line"><span class="class">.div2</span><span class="rules">&#123;<span class="rule"><span class="attribute">background-color</span>:<span class="value"> <span class="hexcolor">#FC9D99</span></span></span>;<span class="rule"><span class="attribute">margin</span>:<span class="value">-<span class="number">170px</span> <span class="number">20px</span></span></span>;&#125;</span></span><br><span class="line"><span class="class">.div3</span><span class="rules">&#123;<span class="rule"><span class="attribute">background-color</span>:<span class="value"> <span class="hexcolor">#F9CCAD</span></span></span>;<span class="rule"><span class="attribute">margin</span>:<span class="value">-<span class="number">160px</span> <span class="number">40px</span></span></span>;&#125;</span></span><br><span class="line"><span class="class">.div4</span><span class="rules">&#123;<span class="rule"><span class="attribute">background-color</span>:<span class="value"> <span class="hexcolor">#C7C7A8</span></span></span>;<span class="rule"><span class="attribute">margin</span>:<span class="value">-<span class="number">150px</span> <span class="number">60px</span></span></span>;&#125;</span></span><br><span class="line"><span class="class">.div5</span><span class="rules">&#123;<span class="rule"><span class="attribute">background-color</span>:<span class="value"> <span class="hexcolor">#84AF9B</span></span></span>;<span class="rule"><span class="attribute">margin</span>:<span class="value">-<span class="number">140px</span> -<span class="number">10px</span></span></span>;&#125;</span></span><br></pre></td></tr></table></figure>
<hr>
<p><em>eg.2-1: 5个定位元素在未设置z-index时的层叠情况</em><br></p><p class="user_img"><img src="/img/post/Yettyzyt/2-1-normal-order.png"></p><p></p>
<p><strong>结论： z-index为auto的定位元素根据html顺序，按照“后来居上”的规则层叠。</strong></p>
<hr>
<p><em>eg.2-2: 5个定位元素设置不同z-index时的层叠情况</em><br></p><p class="user_img"><img src="/img/post/Yettyzyt/2-2-change-order.png"></p><p></p>
<p><strong>结论：<br>定位元素的层叠级别由z-index的值决定，z-index为auto则其层叠级别为0（注意：只是层级为0，其z-index值仍为auto）；<br>同一层叠上下文中，层叠级别大的元素位于层叠级别小的元素之上；<br>同一层叠上下文中，层叠级别相同的元素根据html顺序决定元素的层叠关系，遵循“后来居上”原则。</strong></p>
<h2 id="3-_层叠顺序（stack_order）">3. 层叠顺序（stack order）</h2><p>结合上面的例子进行总结，可得每一个层叠上下文内的层叠顺序：</p>
<blockquote>
<p>Within each stacking context, the following layers are painted in back-to-front order:</p>
<ol>
<li>the background and borders of the element forming the stacking context.</li>
<li>the child stacking contexts with negative stack levels (most negative first).</li>
<li>the in-flow, non-inline-level, non-positioned descendants.</li>
<li>the non-positioned floats.</li>
<li>the in-flow, inline-level, non-positioned descendants, including inline tables and inline blocks.</li>
<li>the child stacking contexts with stack level 0 and the positioned descendants with stack level 0.</li>
<li>the child stacking contexts with positive stack levels (least positive first).<br>—<a href="http://www.w3.org/TR/CSS2/visuren.html#propdef-z-index" target="_blank" rel="external">W3C</a></li>
</ol>
</blockquote>
<p>规范中的描述比较乏味，可结合<a href="http://www.w3help.org/zh-cn/kb/013" target="_blank" rel="external">w3help</a>中的一张图片进行理解：</p>
<blockquote>
<p class="user_img"><img src="/img/post/Yettyzyt/3-1-summay-order.png"></p>
</blockquote>
<h2 id="4-_层叠上下文（stacking_context）">4. 层叠上下文（stacking context）</h2><p>看完上述的例子，对于层叠顺序应该大致了解了。但突然冒出一个“层叠上下文”，这又是个什么鬼？</p>
<h3 id="4-1_层叠上下文的特点">4.1 层叠上下文的特点</h3><blockquote>
<ol>
<li>stacking context可以嵌套</li>
<li>每个stacking context相对于兄弟元素是完全独立的，其内部规则不会影响到外部</li>
<li>每个stacking context元素都会被父stacking context当做一个元素施加stacking规则<br>——<a href="http://blog.angular.in/css-stacking-contextli-na-xie-xian-wei-ren-zhi-de-keng/" target="_blank" rel="external">Abruzzi</a></li>
</ol>
</blockquote>
<h3 id="4-2_层叠上下文的创建">4.2 层叠上下文的创建</h3><h4 id="4-2-1_css2">4.2.1 css2</h4><blockquote>
<p>The root element forms the root stacking context. Other stacking contexts are generated by any positioned element (including relatively positioned elements) having a computed value of ‘z-index’ other than ‘auto’. Stacking contexts are not necessarily related to containing blocks.<br>——<a href="http://www.w3.org/TR/CSS2/visuren.html#propdef-z-index" target="_blank" rel="external">W3C</a></p>
</blockquote>
<p><strong>CSS2中规定创建层叠上下文的两种情况：<br>根元素（html）；<br>定位元素（absolute/relative）且z-index的值不为auto。</strong></p>
<p>注：在同一层叠上下文中，父元素、子元素与自身都被当作是并级关系进行层叠级别的比较。他们之间可能互相层叠。</p>
<hr>
<p><em>eg.4-1：z-index为auto的定位元素没有创建层叠上下文</em><br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"div1"</span> <span class="attribute">style</span>=<span class="value">"position:relative"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"div1_1"</span> <span class="attribute">style</span>=<span class="value">"position:relative;z-index:9"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">div</span> <span class="attribute">class</span>=<span class="value">"div2"</span> <span class="attribute">style</span>=<span class="value">"position:relative"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">div</span><span class="rules">&#123;<span class="rule"><span class="attribute">border</span>:<span class="value"> <span class="number">1px</span> <span class="hexcolor">#000</span> dashed</span></span>;<span class="rule"><span class="attribute">height</span>:<span class="value"><span class="number">200px</span></span></span>;<span class="rule"><span class="attribute">width</span>:<span class="value"><span class="number">400px</span></span></span>;<span class="rule"><span class="attribute">text-align</span>:<span class="value"> center</span></span>;&#125;</span></span><br><span class="line"><span class="class">.div1</span><span class="rules">&#123;<span class="rule"><span class="attribute">background-color</span>:<span class="value"> <span class="hexcolor">#FF4363</span></span></span>;&#125;</span></span><br><span class="line"><span class="class">.div1_1</span><span class="rules">&#123;<span class="rule"><span class="attribute">background-color</span>:<span class="value"> <span class="hexcolor">#FC9D99</span></span></span>;<span class="rule"><span class="attribute">margin</span>:<span class="value"><span class="number">100px</span> <span class="number">0</span> <span class="number">0</span> <span class="number">50px</span></span></span>;<span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">300px</span></span></span>;&#125;</span></span><br><span class="line"><span class="class">.div2</span><span class="rules">&#123;<span class="rule"><span class="attribute">background-color</span>:<span class="value"> <span class="hexcolor">#F9CCAD</span></span></span>;<span class="rule"><span class="attribute">line-height</span>:<span class="value"> <span class="number">300px</span></span></span>;&#125;</span></span><br></pre></td></tr></table></figure>
<p class="user_img"><img src="/img/post/Yettyzyt/4-1-normal-order.png"></p>
<p>分析上述例子：</p>
<ul>
<li><strong>前提：</strong>div1、div1_1、div2都是定位元素；div1、div2都没有设置z-index值。</li>
<li><strong>假设：</strong>div1与div2创建了层叠上下文。不同层叠上下文之间是相对独立的，div1_1属于div1所创建的层叠上下文，与div2所创建的层叠上下文无关；根据“后来居上”原则，则div2应该在div1及其子元素div1_1之上。</li>
<li><strong>由上述例子可得：</strong>div1的子元素div1_1在div2之上。</li>
<li><strong>因此：</strong>div1、div2没有创建层叠上下文。</li>
</ul>
<p><strong>结论： z-index为auto的定位元素不会创建新的层叠上下文。</strong></p>
<hr>
<p><strong>IE中的BUG：</strong><br><em>在IE6-7浏览器中测试eg.4-1：</em><br></p><p class="user_img"><img src="/img/post/Yettyzyt/4-2-ie-bug.png"></p><p></p>
<p><strong>结论： ie6-7中，z-index为auto的定位元素也会创建新的层叠上下文。</strong></p>
<h4 id="4-2-2_css3">4.2.2 css3</h4><blockquote>
<p>A stacking context is formed, anywhere in the document, by any element which is either</p>
<ul>
<li>the root element (HTML),</li>
<li>positioned (absolutely or relatively) with a z-index value other than “auto”,</li>
<li>a flex item with a z-index value other than “auto”,that is the parent element display: flex|inline-flex,</li>
<li>elements with an opacity value less than 1. (See the specification for opacity),</li>
<li>elements with a transform value other than “none”,</li>
<li>elements with a mix-blend-mode value other than “normal”,</li>
<li>elements with a filter value other than “none”,</li>
<li>elements with isolation set to “isolate”,</li>
<li>position: fixed</li>
<li>specifying any attribute above in will-change even if you don’t specify values for these attributes directly (See this post)</li>
<li>elements with -webkit-overflow-scrolling set to “touch”<br>——<a href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Positioning/Understanding_z_index/The_stacking_context" target="_blank" rel="external">MDN</a></li>
</ul>
</blockquote>
<p><strong>CSS3中规定创建层叠上下文的十种情况：</strong></p>
<ul>
<li><strong>根元素 (HTML)</strong></li>
<li><strong>绝对（absolute）定位或相对（relative）定位且 z-index 值不为”auto”</strong></li>
<li><strong>一个 flex 项目(flex item)，且 z-index 值不为 “auto”，也就是父元素 display: flex|inline-flex</strong></li>
<li><strong>元素的 opacity 属性值小于 1（参考 the specification for opacity）</strong></li>
<li><strong>元素的 transform 属性值不为 “none”</strong></li>
<li><strong>元素的 mix-blend-mode 属性值不为 “normal”</strong></li>
<li><strong>元素的 isolation 属性被设置为 “isolate”</strong></li>
<li><strong>在 mobile WebKit 和 Chrome 22+ 内核的浏览器中，position: fixed 总是创建一个新的层叠上下文, 即使 z-index 的值是 “auto”</strong></li>
<li><strong>在 will-change 中指定了任意 CSS 属性，即便你没有定义该元素的这些属性</strong></li>
<li><strong>元素的 -webkit-overflow-scrolling 属性被设置 “touch”</strong></li>
</ul>
<hr>
<p><em>eg.4-2：opacity创建新的层叠上下文</em><br></p><p class="user_img"><img src="/img/post/Yettyzyt/4-3-opacity-order.png"></p><br>分析：<p></p>
<blockquote>
<p>If an element with opacity less than 1 is not positioned, implementations must paint the layer it creates, within its parent stacking context, at the same stacking order that would be used if it were a positioned element with ‘z-index: 0’ and ‘opacity: 1’.<br>If an element with opacity less than 1 is positioned, the ‘z-index’ property applies as described in [CSS21], except that ‘auto’ is treated as ‘0’ since a new stacking context is always created.<br>——<a href="http://www.w3.org/TR/css3-color/#transparency" target="_blank" rel="external">W3C</a></p>
</blockquote>
<p><strong>结论：<br>如果元素设置opacity小于1但未定位，视为css2中元素定位／z-index:0且opacity:1的情况；<br>如果元素设置opacity小于1且定位，z-index为auto，视为css2中元素定位且z-index:0的情况；<br>如果元素设置opacity小于1且定位，z-index不为auto，则根据css2的描述层叠。</strong><br>（其他CSS3创建层叠上下文的元素情况与opacity相同，故不赘述。）</p>
<hr>
<p>至此，应该能够明白：</p>
<ul>
<li>根元素（html）会创建一个新的层叠上下文；</li>
<li>上述CSS2／CSS3中的元素会创建新的层叠上下文；</li>
<li>在每一个层叠上下文中都遵循上文中提到的层叠顺序；</li>
<li>每一个层叠上下文（除根元素）在它的父层叠上下文中都以一个普通元素来对待，其内部的层叠规则不影响其本身在父层叠上下文（即其所属层叠上下文）中的层叠顺序。</li>
</ul>
<h3 id="4-3_层叠上下文的层级">4.3 层叠上下文的层级</h3><ul>
<li>z-index值为auto的层叠上下文（z-index未设置的定位元素）层级为0；</li>
<li>z-index值为0（根元素／z-index为0的定位元素／css3中提到的除根元素与定位元素之外的其他会创建层叠上下文的未定位或已定位无设置z-index的元素）的层叠上下文层级为0；</li>
<li>z-index值已设置且不为0的层叠上下文层级（z-index已设置且不为0的定位元素）与z-index的值相等；</li>
<li>相同层级的层叠上下文遵循“后来居上”的规则层叠。</li>
</ul>
<h2 id="5-_小结">5. 小结</h2><ul>
<li><strong>属于同一层叠上下文的元素（无论它们在结构上是兄弟或父子，甚至是祖孙），都遵循上文所述的层叠顺序；</strong></li>
<li><strong>不同的层叠上下文之间，层级较大的层叠上下文元素及其内部元素位于层级小的层叠上下文元素及其内部元素之上；</strong></li>
<li><strong>不同的层叠上下文之间互相独立；</strong></li>
<li><strong>层叠上下文可嵌套，内部规则不影响外部。</strong></li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<p>嗯~一个比较基础但容易混乱的知识点~<br>首先上一大段文绉绉的w3c规范以表明这是一篇严肃的学术文章（觉得太长可先跳过~）：</p>
<blockquote>
<p>In CSS 2.1, each box has a position in three dimensio]]>
    </summary>
    
      <category term="CSS" scheme="http://aotu.io/tags/CSS/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[Service Workers：采用WebP动态响应图片]]></title>
    <link href="http://aotu.io/notes/2015/11/06/webp-responsive-image/"/>
    <id>http://aotu.io/notes/2015/11/06/webp-responsive-image/</id>
    <published>2015-11-05T18:44:25.000Z</published>
    <updated>2015-12-10T02:02:53.000Z</updated>
    <content type="html"><![CDATA[<blockquote>
<p>译文地址：<a href="http://deanhume.com/Home/BlogPost/service-workers--dynamic-responsive-images-using-webp-images/10132/" target="_blank" rel="external">http://deanhume.com/Home/BlogPost/service-workers--dynamic-responsive-images-using-webp-images/10132/</a></p>
</blockquote>
<p>图片在如今的站点上不可或缺。试想一下，在我们网页上没有图片会怎样？高质量的图片能够使你的站点更加出色，但同时伴随着一定的性能损耗。由于图片文件较大，下载时间相对较长并且会减缓页面的加载。如果是一个带宽较低的用户，用户体验将会特别差。</p>
<p>在移动设备上面，这种现象会更加明显。在移动设备上加载大型图片消耗时间取决你的网络以及连接速度。如果你是一个不耐心的用户，你将会变得沮丧。幸运的是，我们有能力处理 <a href="https://responsiveimages.org/" target="_blank" rel="external">响应式图片</a> 。通过使用 <a href="https://html.spec.whatwg.org/multipage/embedded-content.html#the-picture-element" target="_blank" rel="external">picture</a> 标签，我们可以根据用户的设备为用户提供不同大小、设备像素比（DPR）以及格式的图片。例如，下面的代码就可以做到这一点。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">picture</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">source</span></span><br><span class="line">        <span class="attribute">media</span>=<span class="value">"(min-width: 1024px)"</span></span><br><span class="line">        <span class="attribute">srcset</span>=<span class="value">"./images/brooklyn.jpg, ./images/brooklyn-2x.jpg 2x, ./images/brooklyn-3x.jpg 3x"</span></span><br><span class="line">        <span class="attribute">type</span>=<span class="value">"image/jpeg"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">source</span></span><br><span class="line">        <span class="attribute">media</span>=<span class="value">"(min-width: 320px)"</span></span><br><span class="line">        <span class="attribute">srcset</span>=<span class="value">"./images/brooklyn-small.jpg, ./images/brooklyn-small-2x.jpg 2x, ./images/brooklyn-small-3x.jpg 3x"</span></span><br><span class="line">        <span class="attribute">type</span>=<span class="value">"image/jpeg"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">picture</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在上面的代码中，我们指定不同的图像大小及其相应的设备像素比给给定的屏幕宽度。使用 <strong>picture</strong> 标签，浏览器可以基于设备决定最佳的内容。以上的代码可以完美运行，我们可以进一步扩展，以适应更多的场景。</p>
<p>你可能听过<strong>WebP</strong>图片格式。相比于PNG图片，其文件大小能够节省26％；相比于JPEG图片，能够节省大约25％-34%。目前，Chrome、Opera以及Android能够支持WebP格式，但Safari和IE尚未支持。既然我们能够用picture标签来处理响应式图片，我们也能够使用WebP格式的图片并且允许浏览器在不支持WebP时进行回退。</p>
<p><img src="http://a43d55f6a02c4be185ce-9cfa4cf7c673a59966ad8296f4c88804.r44.cf3.rackcdn.com/WebP/logo-webp.png" alt="webp"></p>
<p>让我们在上面代码的基础上，添加WebP图片的支持。同时，我们要确保能够根据不同的DPR使用最佳视觉效果的图片。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">picture</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- JPEG Images --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">source</span></span><br><span class="line">        <span class="attribute">media</span>=<span class="value">"(min-width: 1024px)"</span></span><br><span class="line">        <span class="attribute">srcset</span>=<span class="value">"./images/brooklyn.jpg, ./images/brooklyn-2x.jpg 2x, ./images/brooklyn-3x.jpg 3x"</span></span><br><span class="line">        <span class="attribute">type</span>=<span class="value">"image/jpeg"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">source</span></span><br><span class="line">        <span class="attribute">media</span>=<span class="value">"(min-width: 320px)"</span></span><br><span class="line">        <span class="attribute">srcset</span>=<span class="value">"./images/brooklyn-small.jpg, ./images/brooklyn-small-2x.jpg 2x, ./images/brooklyn-small-3x.jpg 3x"</span></span><br><span class="line">        <span class="attribute">type</span>=<span class="value">"image/jpeg"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- WebP Images --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">source</span></span><br><span class="line">        <span class="attribute">media</span>=<span class="value">"(min-width: 1024px)"</span></span><br><span class="line">        <span class="attribute">srcset</span>=<span class="value">"./images/brooklyn.webp, ./images/brooklyn-2x.webp 2x, ./images/brooklyn-3x.webp 3x"</span></span><br><span class="line">        <span class="attribute">type</span>=<span class="value">"image/webp"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">source</span></span><br><span class="line">        <span class="attribute">media</span>=<span class="value">"(min-width: 320px)"</span></span><br><span class="line">        <span class="attribute">srcset</span>=<span class="value">"./images/brooklyn-small.webp, ./images/brooklyn-small-2x.webp 2x, ./images/brooklyn-small-3x.webp 3x"</span></span><br><span class="line">        <span class="attribute">type</span>=<span class="value">"image/webp"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- The fallback image --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">img</span></span><br><span class="line">        <span class="attribute">src</span>=<span class="value">"./images/brooklyn.jpg"</span> <span class="attribute">alt</span>=<span class="value">"Brooklyn Bridge - New York"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">picture</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在上面的代码中，我们已经创建了能够同时使用JPEG和WebP图片的picture标签。浏览器将根据设备决定最佳的选项。由于WebP并不支持IE和Safari，使用WebP图片意味着你需要在服务器上同时保存WebP和JPEG格式的图片副本。上面的代码足够满足我们当前的需求，但试想一下如果每张采用这种方式来编写，代码将会变得非常臃肿。当你的站点开始增长时，为每张图片编写上面的代码将会变得非常乏味。这时候，便可以采用Service Workers来解决这个问题。</p>
<p><img src="http://a43d55f6a02c4be185ce-9cfa4cf7c673a59966ad8296f4c88804.r44.cf3.rackcdn.com/Service-Workers-WebP/accept-headers-webp.png" alt="webp"></p>
<p>我们采用开发者工具观察HTTP请求头部，可以看出可以根据Accept头部来判断我们的浏览器是否支持WebP图片。为了利用这一点，并开始提供WebP图片，我们需要注册一个Service Worker。Service Worker的一大特性就是，它们能够拦截网络请求，这样子，我们就能够完全控制响应内容。使用这个特性，我们能够监听HTTP头部，并决定如何做。如果你想了解更多关于Service Workers的内容，可以看看这个<a href="https://github.com/slightlyoff/ServiceWorker" target="_blank" rel="external">Github</a>库获取更多的信息。</p>
<p>我们在html页面添加如下代码用于注册Service Worker。以下的代码引用service-worker.js文件。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript"></span><br><span class="line"><span class="comment">// Register the service worker</span></span><br><span class="line"><span class="keyword">if</span> (<span class="string">'serviceWorker'</span> <span class="keyword">in</span> navigator) &#123;</span><br><span class="line">	navigator.serviceWorker.register(<span class="string">'/service-worker.js'</span>).then(<span class="function"><span class="keyword">function</span>(<span class="params">registration</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Registration was successful</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'ServiceWorker registration successful with scope: '</span>, registration.scope);</span><br><span class="line">&#125;).catch(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// registration failed :(</span></span><br><span class="line">    	<span class="built_in">console</span>.log(<span class="string">'ServiceWorker registration failed: '</span>, err);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在上面的代码中，我们做了一个简单的检查，判断浏览器是否支持Service Worker，如果支持，注册并安装Service Worker。这段代码代码最好的地方就是做了兼容处理，如果浏览器不支持Service Workers，它们会自动回退并且用户不会注意到其中差别。</p>
<p>接下来，我们需要创建Service Worker文件‘service-worker.js‘，用于拦截正在传递到服务器的请求。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">"use strict"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Listen to fetch events</span></span><br><span class="line">self.addEventListener(<span class="string">'fetch'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Check if the image is a jpeg</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="regexp">/\.jpg$|.png$/</span>.test(event.request.url)) &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Inspect the accept header for WebP support</span></span><br><span class="line">  <span class="keyword">var</span> supportsWebp = <span class="literal">false</span>;</span><br><span class="line">  <span class="keyword">if</span> (event.request.headers.has(<span class="string">'accept'</span>))&#123;</span><br><span class="line">	supportsWebp = event.request.headers</span><br><span class="line">        	                    .get(<span class="string">'accept'</span>)</span><br><span class="line">                                    .includes(<span class="string">'webp'</span>);</span><br><span class="line">      	&#125;</span><br><span class="line"></span><br><span class="line">  	<span class="comment">// If we support WebP</span></span><br><span class="line">  	<span class="keyword">if</span> (supportsWebp)</span><br><span class="line">  	&#123;</span><br><span class="line">		<span class="comment">// Clone the request</span></span><br><span class="line">		<span class="keyword">var</span> req = event.request.clone();</span><br><span class="line"></span><br><span class="line">	        <span class="comment">// Build the return URL</span></span><br><span class="line">	    	<span class="keyword">var</span> returnUrl = req.url.substr(<span class="number">0</span>, req.url.lastIndexOf(<span class="string">"."</span>)) + <span class="string">".webp"</span>;</span><br><span class="line"></span><br><span class="line">		event.respondWith(</span><br><span class="line">		  fetch(returnUrl, &#123;</span><br><span class="line">		     mode: <span class="string">'no-cors'</span></span><br><span class="line">		   &#125;)</span><br><span class="line">		);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>上面的示例代码做了一系列的事情，让我们来一步步分解。</p>
<p>在前面几行，我添加一个事件监听器来监听任何一个fetch事件。当每个请求发生时，先判断当前的请求是否是获取JPEG或者PNG格式的图片。如果当前的请求是获取图片，我就能根据HTTP请求头部来决定最佳的响应。在这种情况下，我通过检查Accept头部并且查找是否存在“image/webp“ Mime类型。一旦查询完头部的值，我就能确定浏览器是否支持WebP图片，如果浏览器支持WebP图片，就返回相应的WebP图片。</p>
<p>现在，我们的HTML看起来比较整洁，能够支持WebP图片而并不臃肿。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">picture</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">source</span></span><br><span class="line">        <span class="attribute">media</span>=<span class="value">"(min-width: 1024px)"</span></span><br><span class="line">        <span class="attribute">srcset</span>=<span class="value">"./images/brooklyn.jpg, ./images/brooklyn-2x.jpg 2x, ./images/brooklyn-3x.jpg 3x"</span></span><br><span class="line">        <span class="attribute">type</span>=<span class="value">"image/jpeg"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="title">source</span></span><br><span class="line">        <span class="attribute">media</span>=<span class="value">"(min-width: 320px)"</span></span><br><span class="line">        <span class="attribute">srcset</span>=<span class="value">"./images/brooklyn-small.jpg, ./images/brooklyn-small-2x.jpg 2x, ./images/brooklyn-small-3x.jpg 3x"</span></span><br><span class="line">        <span class="attribute">type</span>=<span class="value">"image/jpeg"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">picture</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>Service Workers给了我们无限的可能。在这个例子中，我们可以扩展到包括其他图片格式，甚至是缓存。你还能轻松地添加支持IE的<a href="http://caniuse.com/#feat=jpegxr" target="_blank" rel="external">JPEGXR</a>。这样子，我们能够更快地给我们的用户展示我们的页面。</p>
<p>如果你想看看示例代码运行的效果，请移步到<a href="https://deanhume.github.io/Service-Workers-WebP" target="_blank" rel="external">deanhume.github.io/Service-Workers-WebP</a>。打开支持这些特性的浏览器，如Chrome，打开开发者工具，就可以看到页面的运行。</p>
<h3 id="参考资料">参考资料</h3><ul>
<li><a href="https://html.spec.whatwg.org/multipage/embedded-content.html#the-picture-element" target="_blank" rel="external">https://html.spec.whatwg.org/multipage/embedded-content.html#the-picture-element</a></li>
<li><a href="http://scottjehl.github.io/picturefill/" target="_blank" rel="external">http://scottjehl.github.io/picturefill/</a></li>
<li><a href="https://developers.google.com/speed/webp/" target="_blank" rel="external">https://developers.google.com/speed/webp/</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API" target="_blank" rel="external">https://developer.mozilla.org/en-US/docs/Web/API/Service_Worker_API</a></li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<blockquote>
<p>译文地址：<a href="http://deanhume.com/Home/BlogPost/service-workers--dynamic-responsive-images-using-webp-images/10132/" target=]]>
    </summary>
    
      <category term="Fork" scheme="http://aotu.io/tags/Fork/"/>
    
      <category term="WebP" scheme="http://aotu.io/tags/WebP/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[使用Adobe FLASH CC制作Canvas动画]]></title>
    <link href="http://aotu.io/notes/2015/11/02/flash-canvas/"/>
    <id>http://aotu.io/notes/2015/11/02/flash-canvas/</id>
    <published>2015-11-01T18:44:25.000Z</published>
    <updated>2015-12-10T02:02:53.000Z</updated>
    <content type="html"><![CDATA[<p>flash可以导出canvas动画，大大缩短制作动画所需要的时间。它是一个可视化IDE，可以让我们写少很多代码。做出来的动画，可以更加精确。同时，可以通用使用帧脚本中的 Javascript，为资源添加交互性。</p>
<a id="more"></a>
<h2 id="新建HTML5_Canvas项目">新建HTML5 Canvas项目</h2><p class="user_img"><img src="/img/post/youing/1.png"></p>
<h3 id="舞台设置">舞台设置</h3><p>舞台大小修改为：600x600 (<em>这里可以根据设计稿调整所需要的舞台大小</em>)</p>
<h3 id="帧频">帧频</h3><p>是指每秒钟放映或显示的帧或图像的数量，这个数值设置越大，动画越快，但同时也是性能消耗大户。这里我们设置为36</p>
<p class="user_img"><img src="/img/post/youing/2.png"></p>
<h2 id="导入资源">导入资源</h2><p>文件 &gt; 导入 &gt; 导入到库</p>
<h2 id="布局">布局</h2><p>快捷键Ctrl + L或者窗口菜单下 &gt; 库</p>
<p>从资源库中把资源拖到舞台进去,通过移动拖拽的形式进行布局</p>
<p class="user_img"><img src="/img/post/youing/3.png"></p>
<h2 id="图形与影片剪辑">图形与影片剪辑</h2><p>我们可以将单独的动画，放到一个独立的影片剪辑里，这样可以更好的控制动画。几个独立的剪片剪辑，可以组成一个完整的动画。</p>
<p>当我们把图片从资源库拖到舞台时，它这个时候，只是普通的位图，并不能做补帧动画，所以我们必须把它转换成元件。</p>
<ul>
<li><strong>图形</strong>由矢量图或者是位图组成。</li>
<li><strong>影片剪辑</strong>包含在动画影片中的影片片段，有自己的时间轴和属性。具有交互性，是用途最广、功能最多的部分。</li>
</ul>
<p>下面制作以飘动的钱，做个例子说明</p>
<p>选择位图，右键 &gt; 转换为元件，这个时候，弹出一个对话窗口，我们首先选择“影片剪辑”，保存。双击进入刚才创始的影片剪辑，这个时候，由于刚才我们只是把位图转成了影片剪辑，但实际上，它里面，仍然是一个位图，所以并不能做动画操作。所以我们需要在影片剪辑里，把图片转换了“图形”。</p>
<p class="user_img"><img src="/img/post/youing/4.png"></p>
<h2 id="时间轴">时间轴</h2><p>上面已经把图片转成图形元件，所以我们现在需要时间轴某个地方中插入关键帧。这里我们在30,60帧处插入关键帧。然后在30帧处，移动元件的位置，然后在每个关键帧的中间右键，选择“创建传统补间”。速度可以通过删除或者增加两个关键帧的补间动画时间长度来控制。</p>
<p class="user_img"><img src="/img/post/youing/5.png"></p>
<p class="user_img"><img src="/img/post/youing/6.png"></p>
<h2 id="动作播放控制">动作播放控制</h2><p>如果我们希望动画可以连续从头再播放，可以在动画的最后一帧插入一个空白关键帧，打开动作面板，然后写上</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">this.<span class="function"><span class="title">gotoAndPlay</span><span class="params">(<span class="number">0</span>)</span></span></span><br></pre></td></tr></table></figure>
<p class="user_img"><img src="/img/post/youing/7.png"></p>
<p>即可回到第一帧重新播放，如果希望停止动画，则</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.stop();</span><br></pre></td></tr></table></figure>
<p>如果希望跳到某帧去播放</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">this.<span class="function"><span class="title">gotoAndPlay</span><span class="params">(n)</span></span></span><br></pre></td></tr></table></figure>
<p>如果希望跳到某帧并停止</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">this.<span class="function"><span class="title">gotoAndStop</span><span class="params">(n)</span></span></span><br></pre></td></tr></table></figure>
<h2 id="发布">发布</h2><p>文件 &gt; 发布设置</p>
<h3 id="文件输出">文件输出</h3><ul>
<li>循环时间轴(<em>表示是否循环整个动画</em>)</li>
<li>覆盖HTML(<em>第一次发布时可以选上，如果对html有修改，记得把这个选项去掉,否则会对文件进行覆盖操作</em>)</li>
</ul>
<h3 id="资源导出选项">资源导出选项</h3><ul>
<li>图像(<em>是否导出雪碧图</em>)</li>
<li>javascript命名空间(<em>基本上不需要修改</em>)，这几个属于全局变量，可以在发布后的js文件中再修改。</li>
</ul>
<p class="user_img"><img src="/img/post/youing/8.png"></p>
<h2 id="生成html">生成html</h2><p>最终会生成一个html文件和一个js文件</p>
<h3 id="生成的html文件">生成的html文件</h3><ul>
<li>框架自带的preloadjs,可以轻松管理资源预加载，它提供了相关api可以进行loading等操作。</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="doctype">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">meta</span> <span class="attribute">charset</span>=<span class="value">"UTF-8"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">title</span>&gt;</span>people<span class="tag">&lt;/<span class="title">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"http://code.createjs.com/easeljs-0.8.1.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"http://code.createjs.com/tweenjs-0.6.1.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"http://code.createjs.com/movieclip-0.8.1.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"http://code.createjs.com/preloadjs-0.6.1.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">script</span> <span class="attribute">src</span>=<span class="value">"people.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript"></span><br><span class="line"><span class="keyword">var</span> canvas, stage, exportRoot;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">init</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	canvas = <span class="built_in">document</span>.getElementById(<span class="string">"canvas"</span>);</span><br><span class="line">	images = images||&#123;&#125;;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> loader = <span class="keyword">new</span> createjs.LoadQueue(<span class="literal">false</span>);</span><br><span class="line">	loader.addEventListener(<span class="string">"fileload"</span>, handleFileLoad);</span><br><span class="line">	loader.addEventListener(<span class="string">"complete"</span>, handleComplete);</span><br><span class="line">	loader.loadManifest(lib.properties.manifest);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleFileLoad</span>(<span class="params">evt</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (evt.item.type == <span class="string">"image"</span>) &#123; images[evt.item.id] = evt.result; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleComplete</span>(<span class="params">evt</span>) </span>&#123;</span><br><span class="line">	exportRoot = <span class="keyword">new</span> lib.people();</span><br><span class="line"></span><br><span class="line">	stage = <span class="keyword">new</span> createjs.Stage(canvas);</span><br><span class="line">	stage.addChild(exportRoot);</span><br><span class="line">	stage.update();</span><br><span class="line"></span><br><span class="line">	createjs.Ticker.setFPS(lib.properties.fps);</span><br><span class="line">	createjs.Ticker.addEventListener(<span class="string">"tick"</span>, stage);</span><br><span class="line">&#125;</span><br><span class="line"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="title">body</span> <span class="attribute">onload</span>=<span class="value">"init();"</span> <span class="attribute">style</span>=<span class="value">"background-color:#D4D4D4"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="title">canvas</span> <span class="attribute">id</span>=<span class="value">"canvas"</span> <span class="attribute">width</span>=<span class="value">"600"</span> <span class="attribute">height</span>=<span class="value">"620"</span> <span class="attribute">style</span>=<span class="value">"background-color:#FFFFFF"</span>&gt;</span><span class="tag">&lt;/<span class="title">canvas</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="title">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="生成的js文件">生成的js文件</h3><ul>
<li>生成的动画配置及脚本都在这个js文件里面，如果需要，可以手动修改相关数据。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">lib, img, cjs, ss</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> p; <span class="comment">// shortcut to reference prototypes</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// library properties:</span></span><br><span class="line">lib.properties = &#123;</span><br><span class="line">	width: <span class="number">600</span>,</span><br><span class="line">	height: <span class="number">620</span>,</span><br><span class="line">	fps: <span class="number">36</span>,</span><br><span class="line">	color: <span class="string">"#FFFFFF"</span>,</span><br><span class="line">	manifest: [</span><br><span class="line">		&#123;src:<span class="string">"images/bigband.png"</span>, id:<span class="string">"bigband"</span>&#125;,</span><br><span class="line">		&#123;src:<span class="string">"images/Bitmap1.png"</span>, id:<span class="string">"Bitmap1"</span>&#125;,</span><br><span class="line">		&#123;src:<span class="string">"images/body.png"</span>, id:<span class="string">"body"</span>&#125;,</span><br><span class="line">		&#123;src:<span class="string">"images/eye1.png"</span>, id:<span class="string">"eye1"</span>&#125;,</span><br><span class="line">		&#123;src:<span class="string">"images/eye2.png"</span>, id:<span class="string">"eye2"</span>&#125;,</span><br><span class="line">		&#123;src:<span class="string">"images/face1.png"</span>, id:<span class="string">"face1"</span>&#125;,</span><br><span class="line">		&#123;src:<span class="string">"images/face2.png"</span>, id:<span class="string">"face2"</span>&#125;,</span><br><span class="line">		&#123;src:<span class="string">"images/face3.png"</span>, id:<span class="string">"face3"</span>&#125;,</span><br><span class="line">		&#123;src:<span class="string">"images/hair.png"</span>, id:<span class="string">"hair"</span>&#125;,</span><br><span class="line">		&#123;src:<span class="string">"images/hand2.png"</span>, id:<span class="string">"hand2"</span>&#125;,</span><br><span class="line">		&#123;src:<span class="string">"images/hand3.png"</span>, id:<span class="string">"hand3"</span>&#125;,</span><br><span class="line">		&#123;src:<span class="string">"images/hand4.png"</span>, id:<span class="string">"hand4"</span>&#125;,</span><br><span class="line">		&#123;src:<span class="string">"images/index30.png"</span>, id:<span class="string">"index30"</span>&#125;,</span><br><span class="line">		&#123;src:<span class="string">"images/index302.png"</span>, id:<span class="string">"index302"</span>&#125;,</span><br><span class="line">		&#123;src:<span class="string">"images/index40.png"</span>, id:<span class="string">"index40"</span>&#125;,</span><br><span class="line">		&#123;src:<span class="string">"images/index5.png"</span>, id:<span class="string">"index5"</span>&#125;,</span><br><span class="line">		&#123;src:<span class="string">"images/shadow.png"</span>, id:<span class="string">"shadow"</span>&#125;</span><br><span class="line">	]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// symbols:</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">(lib.bigband = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.initialize(img.bigband);</span><br><span class="line">&#125;).prototype = p = <span class="keyword">new</span> cjs.Bitmap();</span><br><span class="line">p.nominalBounds = <span class="keyword">new</span> cjs.Rectangle(<span class="number">0</span>,<span class="number">0</span>,<span class="number">295</span>,<span class="number">538</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">(lib.Bitmap1 = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.initialize(img.Bitmap1);</span><br><span class="line">&#125;).prototype = p = <span class="keyword">new</span> cjs.Bitmap();</span><br><span class="line">p.nominalBounds = <span class="keyword">new</span> cjs.Rectangle(<span class="number">0</span>,<span class="number">0</span>,<span class="number">543</span>,<span class="number">577</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">(lib.body = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.initialize(img.body);</span><br><span class="line">&#125;).prototype = p = <span class="keyword">new</span> cjs.Bitmap();</span><br><span class="line">p.nominalBounds = <span class="keyword">new</span> cjs.Rectangle(<span class="number">0</span>,<span class="number">0</span>,<span class="number">521</span>,<span class="number">242</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">(lib.eye1 = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.initialize(img.eye1);</span><br><span class="line">&#125;).prototype = p = <span class="keyword">new</span> cjs.Bitmap();</span><br><span class="line">p.nominalBounds = <span class="keyword">new</span> cjs.Rectangle(<span class="number">0</span>,<span class="number">0</span>,<span class="number">73</span>,<span class="number">58</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">(lib.eye2 = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.initialize(img.eye2);</span><br><span class="line">&#125;).prototype = p = <span class="keyword">new</span> cjs.Bitmap();</span><br><span class="line">p.nominalBounds = <span class="keyword">new</span> cjs.Rectangle(<span class="number">0</span>,<span class="number">0</span>,<span class="number">72</span>,<span class="number">35</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">(lib.face1 = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.initialize(img.face1);</span><br><span class="line">&#125;).prototype = p = <span class="keyword">new</span> cjs.Bitmap();</span><br><span class="line">p.nominalBounds = <span class="keyword">new</span> cjs.Rectangle(<span class="number">0</span>,<span class="number">0</span>,<span class="number">297</span>,<span class="number">368</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// stage content:</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">(lib.people = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="keyword">this</span>.initialize();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// people</span></span><br><span class="line">	<span class="keyword">this</span>.instance = <span class="keyword">new</span> lib.peoplemc();</span><br><span class="line">	<span class="keyword">this</span>.instance.setTransform(<span class="number">295</span>,<span class="number">312.5</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// qpmask (mask)</span></span><br><span class="line">	<span class="keyword">var</span> mask = <span class="keyword">new</span> cjs.Shape();</span><br><span class="line">	mask._off = <span class="literal">true</span>;</span><br><span class="line">	mask.graphics.p(<span class="string">"EgpUgqAMBU1AAAMAAABaIMhU1AAAg"</span>);</span><br><span class="line">	mask.setTransform(<span class="number">278.5</span>,<span class="number">308.1</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// qp</span></span><br><span class="line">	<span class="keyword">this</span>.instance_1 = <span class="keyword">new</span> lib.qpmc();</span><br><span class="line">	<span class="keyword">this</span>.instance_1.setTransform(<span class="number">291.5</span>,<span class="number">263.5</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">this</span>.instance_1.mask = mask;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">this</span>.addChild(<span class="keyword">this</span>.instance_1,<span class="keyword">this</span>.instance);</span><br><span class="line">&#125;).prototype = p = <span class="keyword">new</span> cjs.Container();</span><br><span class="line">p.nominalBounds = <span class="keyword">new</span> cjs.Rectangle(<span class="number">263</span>,<span class="number">31.5</span>,<span class="number">617</span>,<span class="number">905.5</span>);</span><br><span class="line"></span><br><span class="line">&#125;)(lib = lib||&#123;&#125;, images = images||&#123;&#125;, createjs = createjs||&#123;&#125;, ss = ss||&#123;&#125;);</span><br><span class="line"><span class="keyword">var</span> lib, images, createjs, ss;</span><br></pre></td></tr></table></figure>
<h2 id="附上最终效果">附上最终效果</h2><p><a href="http://b.gengshu.net/doc/flash/people.html" target="_blank" rel="external">点我看效果</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>flash可以导出canvas动画，大大缩短制作动画所需要的时间。它是一个可视化IDE，可以让我们写少很多代码。做出来的动画，可以更加精确。同时，可以通用使用帧脚本中的 Javascript，为资源添加交互性。</p>]]>
    
    </summary>
    
      <category term="Canvas" scheme="http://aotu.io/tags/Canvas/"/>
    
      <category term="Flash" scheme="http://aotu.io/tags/Flash/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[前方有坑，请绕道——Zepto 中使用 CORS]]></title>
    <link href="http://aotu.io/notes/2015/10/26/zepto-cors/"/>
    <id>http://aotu.io/notes/2015/10/26/zepto-cors/</id>
    <published>2015-10-26T12:24:22.000Z</published>
    <updated>2015-12-10T02:02:53.000Z</updated>
    <content type="html"><![CDATA[<p>众所周知，现在移动 Web 开发中，<code>Zepto.js</code> 是使用频率比较高的库之一。由于它的体积小，加载速度快，有着和 <code>jquery</code> 类似的 API，而备受开发者喜爱。可随着时间的推移，我们遇到了不少 <code>Zepto</code> 的坑，而且文件体积的大小跟代码的执行效率并没有什么关系，最后我们发现 <code>Zepto</code> 并没有太大的卵用。</p>
<p>jsperf 上有个 <code>zepto</code> 和 <code>jquery</code> DOM 操作的对比测试，有兴趣可以看一下：<a href="http://jsperf.com/zepto-vs-jquery-2013/25" target="_blank" rel="external">zepto vs jquery - selectors</a></p>
<blockquote>
<p>开源项目好坏的一个评判标准之一：是否有一个强大的社区和一批积极的贡献者</p>
</blockquote>
<p>我们简单的看一个对比：<br><img src="http://jdc.jd.com/fd/blog_image/cors_pic_01.jpg" alt="zepto github"><br><img src="http://jdc.jd.com/fd/blog_image/cors_pic_02.jpg" alt="jquery github"></p>
<p>很明显，<code>Zepto</code> 的活跃度远远没有 <code>jquery</code> 高。不过言归正传，还是回到 <code>Zepto</code> 的话题上。</p>
<hr>
<p>一直以来，我们在移动端上面使用 <code>zepto</code>并没有出现太大的问题。直至我们将 Ajax 跨域请求从 iframe 的方式切换成 <code>CORS</code> 之后，一个比较隐蔽的 Bug 出现了。</p>
<h3 id="问题描述">问题描述</h3><ol>
<li>页面在Webview中，点击按钮无效</li>
<li>页面在部分浏览器中，无法拉取到用户的信息</li>
</ol>
<h3 id="问题定位">问题定位</h3><p>我通过 <code>Fiddler</code> 或 <code>Charles</code> 抓包发现，在 webview 中，点击按钮之后的 Ajax 请求并未发出，但是页面在手机QQ浏览器和 PC 上表现都是正常的。因为是在切换 CORS 之后，页面才出现异常的，在此之前并没有版本迭代。所以 CORS 代码首当其冲要进行深层次的 code-review，于是我直接在 <code>CORS</code> 的代码块上进行 <code>try-catch</code>，结果捕获到异常：</p>
<p><code>INVALID_STATE_ERR: DOM Exception 11</code></p>
<h3 id="问题深入剖析">问题深入剖析</h3><p>先来看看测试代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (options.withCredentials) &#123;</span><br><span class="line">    options = $.extend(options, &#123;</span><br><span class="line">        xhr: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="keyword">var</span> xhr = <span class="keyword">new</span> <span class="built_in">window</span>.XMLHttpRequest()</span><br><span class="line">         xhr.withCredentails = <span class="literal">true</span></span><br><span class="line">         <span class="keyword">return</span> xhr</span><br><span class="line">     &#125;</span><br><span class="line">&#125;&#125;</span><br><span class="line"><span class="keyword">delete</span> options.withCredentails</span><br><span class="line"></span><br><span class="line">$.ajax(options)</span><br></pre></td></tr></table></figure>
<p>这段代码在大多数浏览器中都可以正常执行，但是在 Android 的 webview 和一些旧版本的手机浏览器中会抛出错误。</p>
<p>以上代码和普通的 Ajax 请求不同的地方在于设置了 <code>CORS</code> 的 <code>withCredentials</code> 属性。（<code>CORS</code> 请求默认是不会带上 <code>cookies</code> 等身份信息的，如果需要在请求中带上 <code>cookies</code>，则需要设置 <code>XMLHttpRequest</code> 的 <code>withCredentials</code> 属性值为 true）</p>
<p>下面通过两个例子来分析一下：</p>
<p>例一：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">var</span> xhr = new <span class="function"><span class="title">XMLHttpRequest</span><span class="params">()</span></span></span><br><span class="line">xhr<span class="class">.withCrendentials</span> = true</span><br><span class="line">xhr.<span class="function"><span class="title">open</span><span class="params">(<span class="string">'POST'</span>, <span class="string">'url'</span>, true)</span></span></span><br><span class="line">xhr.<span class="function"><span class="title">send</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure>
<p>这段代码在部分浏览器中依旧会抛出异常：<code>INVALID_STATE_ERR: DOM Exception 11</code></p>
<p>例二：</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">var</span> xhr = new <span class="function"><span class="title">XMLHttpRequest</span><span class="params">()</span></span></span><br><span class="line">xhr.<span class="function"><span class="title">open</span><span class="params">(<span class="string">'POST'</span>, <span class="string">'url'</span>, true)</span></span></span><br><span class="line">xhr<span class="class">.withCredentials</span> = true</span><br><span class="line">xhr.<span class="function"><span class="title">send</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure>
<p>这段代码可以正常执行，并不会抛出异常<br>为什么 <code>xhr.withCredentials</code> 赋值在 <code>xhr.open()</code> 方法之前就会出错呢？</p>
<p>秉着科(xian)学(de)严(dan)谨(teng)的态度，翻看了 W3C 在 2011 年和 2012 年关于 <code>XMLHttpRequest</code> 的规范文档，发现使用 <code>withCredentials</code> 属性的规范发生了改变。</p>
<p>2011 年的规范：<br><img src="http://jdc.jd.com/fd/blog_image/cors_pic_03.png" alt="2011 CORS"></p>
<p>2012 年的规范：<br><img src="http://jdc.jd.com/fd/blog_image/cors_pic_04.png" alt="2012 CORS"></p>
<p>对比两份文档，我们重点看一下 step 1：<br>2011 年的规范中规定当 <code>XMLHttpRequest</code> 的 <code>readyState</code> 状态不是 <code>OPENED</code> 时，会报错；<br>2012 年的规范中规定当 <code>XMLHttpRequest</code> 的 <code>readyState</code> 状态不是 <code>UNSENT</code> 或 <code>OPENDED</code> 时，会报错；</p>
<p>下面简单介绍一下 <code>XMLHttpRequest</code> 的 <code>readyState</code> 值：</p>
<table>
<thead>
<tr>
<th>Value</th>
<th>State</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>0</td>
<td>UNSENT</td>
<td>open() has not been called yet.</td>
</tr>
<tr>
<td>1</td>
<td>OPENED</td>
<td>send() has not been called yet.</td>
</tr>
<tr>
<td>2</td>
<td>HEADERS_RECEIVED</td>
<td>send() has been called,and headers and status are available.</td>
</tr>
<tr>
<td>3</td>
<td>LOADING</td>
<td>Downloading;responseText holds partial data</td>
</tr>
<tr>
<td>4</td>
<td>DONE</td>
<td>The operation is complete</td>
</tr>
</tbody>
</table>
<p>由此可以看出，当一个 <code>XMLHttpRequest</code> 对象被创建时，默认的 <code>readyState</code> 状态为 <code>UNSENT</code>，只有执行了 open() 方法并且还没有执行 send() 方法时，<code>readyState</code> 的状态才为 <code>OPENED</code>。</p>
<p>由于一些老版本的浏览器是按照 2012 年之前的规范来实现的，所以这一部分浏览器中，open() 方法要在设置 <code>withCredentials</code> 属性之前调用。因此为了兼容，正确的做法应该是在 open() 方法之后再设置 <code>withCredentials</code> 属性。</p>
<p>下面来看看 zepto.js v1.1.3 的源码：<br><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (settings.xhrFields) <span class="keyword">for</span> (name <span class="keyword">in</span> settings.xhrFields) xhr[name] = settings.xhrFields[name]</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="keyword">async</span> = <span class="string">'async'</span> <span class="keyword">in</span> settings ? settings.<span class="keyword">async</span> : <span class="keyword">true</span></span><br><span class="line"></span><br><span class="line">xhr.open(settings.<span class="keyword">type</span>, settings.url, <span class="keyword">async</span>, settings.username, settings.password)</span><br></pre></td></tr></table></figure></p>
<p><code>zepto</code> 是在 open() 方法之前设置 <code>XMLHttpRequest</code> 的属性值的，所以这会导致在使用 <code>CORS</code> 并且设置 <code>withCredentials</code> 的时候，代码在部分浏览器中报错。Android webview 中重现的几率很大。</p>
<hr>
<p>总结：在使用 <code>CORS</code> 时，如果要给 <code>withCredentials</code> 赋值，请务必要在 open() 方法之后，否则无法向后兼容。</p>
<p>对于 zepto.js 的问题，已经有用户向作者提交了 PR，作者也表示会在下个版本中修复（可是直到今天，都更新到 v1.1.6 版本了，还是没有修复这个问题，更改一下代码顺序就那么难吗？！难怪阿里也嫌 zepto 更新速度太慢，问题多，所以自己 fork 代码进行了定制化）。</p>
<p>所以目前如果要用 <code>zepto</code> 来进行 <code>CORS</code> 的话，还是需要自己更改 <code>zepto</code> 的 ajax 模块代码，然后手动构建。</p>
<hr>
<h3 id="参考资料：">参考资料：</h3><p><a href="http://www.w3.org/TR/2011/WD-XMLHttpRequest2-20110816/#the-withcredentials-attribute" target="_blank" rel="external">XMLHttpRequest Level 2 2011</a><br><a href="http://www.w3.org/TR/XMLHttpRequest/" target="_blank" rel="external">XMLHttpRequest Level 1 2014</a><br><a href="http://www.w3.org/TR/XMLHttpRequest2/" target="_blank" rel="external">XMLHttpRequest Level 2 2014</a><br><a href="https://github.com/madrobby/zepto/issues/921" target="_blank" rel="external">Zepto issues</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<p>众所周知，现在移动 Web 开发中，<code>Zepto.js</code> 是使用频率比较高的库之一。由于它的体积小，加载速度快，有着和 <code>jquery</code> 类似的 API，而备受开发者喜爱。可随着时间的推移，我们遇到了不少 <code>Zepto<]]>
    </summary>
    
      <category term="CORS" scheme="http://aotu.io/tags/CORS/"/>
    
      <category term="Zepto" scheme="http://aotu.io/tags/Zepto/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[探究transform动画元素的z-index]]></title>
    <link href="http://aotu.io/notes/2015/10/21/z-index-and-translate3d/"/>
    <id>http://aotu.io/notes/2015/10/21/z-index-and-translate3d/</id>
    <published>2015-10-21T00:24:35.000Z</published>
    <updated>2015-12-10T02:02:53.000Z</updated>
    <content type="html"><![CDATA[<h2 id="z-index_和_translate3d">z-index 和 translate3d</h2><p>在一次需求中，需要做出三张卡牌走马灯式滚动的效果，由于在前面的一张卡牌需要挡住后面的卡牌，自然而然地就用 z-index 使前面的卡牌显示在最上面，配以 transform 动画让“走马灯”滚起来，在开发过程中，在 PC 侧 Chrome 中表现良好，在本人手机浏览器中也表现良好，最后测试时却发现，在微信客户端或 QQ 客户端中打开页面出现问题，“走马灯”滚动时，卡牌先通过 transform 就位后，才把 z-index 设置较大的卡牌置于上面，感觉上非常的不流畅。</p>
<p><img src="http://labs.qiang.it/manjiz/postimgs/2015/151116_card.png" alt="image"></p>
<p>究其原因，发现这是某些浏览器的渲染规则，涉及到 <code>stacking context</code> 的概念，transform 的元素会创建新的 DOM，层级会在普通元素的上面，除了 transform ,还有哪些情况会创建新 <code>stacking context</code>呢？</p>
<p>MDN 上有相关介绍：</p>
<blockquote>
<ul>
<li>the root element (HTML),</li>
<li><strong>positioned (absolutely or relatively) with a z-index value other than “auto”,</strong></li>
<li><strong>a flex item with a z-index value other than “auto”,</strong></li>
<li><strong>elements with an opacity value less than 1,</strong></li>
<li><strong>elements with a transform value other than “none”,</strong></li>
<li>elements with a mix-blend-mode value other than “normal”,</li>
<li>elements with isolation set to “isolate”, on mobile WebKit and Chrome 22+, position: fixed always creates a new stacking context, even when z-index is “auto”,</li>
<li>specifing any attribute above in will-change even you don’t write themselves directly</li>
</ul>
</blockquote>
<p>下图是对 transform 和 opacity 的测试结果：</p>
<p><img src="http://labs.qiang.it/manjiz/postimgs/2015/151117_twotest.png" alt="image"></p>
<p>很明显，红色 div 都在绿色 div 上面了，说明真的有创建了个更高层级的 <code>stacking context</code>。再做进一步测试，我给两组的 div 都加了 <code>position:relative;z-index:1;</code>，结果绿色的都在上面了，手机微信上也一样，这能不能说明 z-index 对层级的影响大于 transform 和 opacity 呢。</p>
<p>至于 transform 变换的时候会让 z-index “临时失效”，其实并非 z-index 失效了，只是 z-index 被用在不同的 <code>stacking context</code> 上，而非在默认的 context 上同等地比较层级了。所以 DOM 在 transform 的工程中，DOM 处于一个新的 <code>stacking context</code> 里，z-index 也是相对于这个 <code>stacking context</code> 的，所以表现出来的实际是 <code>stacking context</code> 的层次，动画一结束，DOM 又回到默认的 context 里，这时的 z-index 才是在同一个 context 上的比较。</p>
<p>那该用什么方法来控制卡牌的层级，又能让动画流畅地表现呢，当然是 translate3d 中的 z-axis，很多时候我们并不知道它是用来做什么的，平常用得最多的只是它的 x-axis 和 y-axis，不妨先看个例子：</p>
<pre><code><span class="class">.box1</span> <span class="rules">{<span class="rule"><span class="attribute">width</span>:<span class="value"><span class="number">100px</span></span></span>;<span class="rule"><span class="attribute">height</span>:<span class="value"><span class="number">100px</span></span></span>;<span class="rule"><span class="attribute">background</span>:<span class="value">red</span></span>;<span class="rule"><span class="attribute">transform</span>:<span class="value"><span class="function">perspective</span>(<span class="number">100px</span>) <span class="function">translate3d</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">100px</span>)</span></span>;}</span>
<span class="class">.box2</span> <span class="rules">{<span class="rule"><span class="attribute">width</span>:<span class="value"><span class="number">100px</span></span></span>;<span class="rule"><span class="attribute">height</span>:<span class="value"><span class="number">100px</span></span></span>;<span class="rule"><span class="attribute">background</span>:<span class="value">blue</span></span>;<span class="rule"><span class="attribute">transform</span>:<span class="value"><span class="function">perspective</span>(<span class="number">100px</span>) <span class="function">translate3d</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">200px</span>)</span></span>;}</span>
</code></pre><p>实际效果是，看不到它们，然后我们再设置 perspective 为 201px，这时可以很明显地看到，box2 占据了整个屏幕，而 box1 宽高约为 200px，唯有设置 translate3d(0,0,0) 时，宽高才为 100px。</p>
<p>现在可以来理解下 perspective 和 translate3d 的关系，perspective 可以比作镜头和 DOM 的距离，实际上设置多少都没影响，因为它通过跟 z-axis 上的数值比例来影响样式，它更像是一个刻度，而 translate3d 的 z-axis 则表示了 DOM 和屏幕的距离。假定镜头跟屏幕的距离固定了，z-axis 越大，DOM 逐渐远离屏幕，靠近镜头，这时 DOM 看起来也就越大，当 z-axis 大于或等于 perspective 时，DOM元素已经在我们镜头的后面了，所以也就看不到它了。</p>
<p><img src="http://labs.qiang.it/manjiz/postimgs/2015/151116_perspective.png" alt="image"></p>
<p>现在也就好理解为什么 perspective 和 translate3d 能够影响 DOM 的层级了，它们在屏幕和镜头之间的距离不同，所以就有了层次，移动端设备很好地表现了这个结论，但在 PC 的 Chrome 上测试则不然，我们仍需要 z-index 才会表现出我们需要的 层次关系。</p>
<p><strong>参考</strong></p>
<ul>
<li><a href="http://segmentfault.com/q/1010000002480824" target="_blank" rel="external">http://segmentfault.com/q/1010000002480824</a></li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="z-index_和_translate3d">z-index 和 translate3d</h2><p>在一次需求中，需要做出三张卡牌走马灯式滚动的效果，由于在前面的一张卡牌需要挡住后面的卡牌，自然而然地就用 z-index 使前面的卡牌显示在最上面，配以 tra]]>
    </summary>
    
      <category term="translate3d" scheme="http://aotu.io/tags/translate3d/"/>
    
      <category term="zindex" scheme="http://aotu.io/tags/zindex/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[我的vim二三事]]></title>
    <link href="http://aotu.io/notes/2015/10/16/vim-list/"/>
    <id>http://aotu.io/notes/2015/10/16/vim-list/</id>
    <published>2015-10-16T10:24:35.000Z</published>
    <updated>2015-12-10T02:02:53.000Z</updated>
    <content type="html"><![CDATA[<h2 id="前言">前言</h2><blockquote>
<p>选择你所喜欢的，爱你所选择的–列夫·托尔斯泰</p>
</blockquote>
<h3 id="不是理由的理由">不是理由的理由</h3><p>用了几年Vim，我发现我越来越喜欢它了，和好多人一样喜欢它，也许喜欢的理由各不相同，但大抵有如下几个：</p>
<ul>
<li>即使你用了几年了，你还是会在某天惊呼原来还可以这么操作，<strong>它总会给你带来惊喜</strong>。</li>
<li>当你要操作的时候你根本不用去想那些快捷键(也许不能叫快捷键，它是谓语{operator}和宾语{text-objects}，组合在一起形成不同指令,好像自然语言)，它们就在你意识里。也许开始的时候你需要去记一些快捷键（别的编辑器不用吗？），但记住以后你熟练了，就像是骑自行车，你就忘记它的存在，你只用输出你的思想，<strong>它让你更专注你要做的事情本身</strong>。</li>
<li>虽然会有很多的快捷键以便让不同的人找到他们最佳的操作方式，但是<strong>每个人常用的不外乎特定的十几个快捷键</strong>，而这些快捷键都是有内在逻辑让你记住的，比如：d(elete)删除,D(elete)删除到行尾,d(elete)<br>a w(ord) 删除一个词。</li>
<li>如果懒，那么你学Vim是没错的，它是<strong>变化中的永恒</strong>，那么多的编辑器更新迭代，它们都有vi模式或vi插件，你可以用你所学，一如既往。</li>
<li>它有<strong>非常多的插件</strong>，你可以定制一些自己喜欢的强大功能。（这其实也是个缺点的吧，毕竟自己配置多费时间呀，不过好些人一个配置用了十多年）。<a href="http://www.zhihu.com/question/20151659" target="_blank" rel="external">到底有多强大呢，看看知乎上这篇文章。</a></li>
</ul>
<p>我知道上面这些说得太抽象了，也许我们应该来点具体的，你可以边看边对比一下你使用的编辑器的操作：</p>
<table>
<thead>
<tr>
<th style="text-align:left">编辑</th>
<th style="text-align:left">用 Vim</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">如何向下移动7行</td>
<td style="text-align:left">7j</td>
</tr>
<tr>
<td style="text-align:left">如何删除一个词（word）</td>
<td style="text-align:left">dw</td>
</tr>
<tr>
<td style="text-align:left">如何删除一行</td>
<td style="text-align:left">dd</td>
</tr>
<tr>
<td style="text-align:left">如何删除｛｝里的内容</td>
<td style="text-align:left">di{</td>
</tr>
<tr>
<td style="text-align:left">光标移动到第80行</td>
<td style="text-align:left">80G</td>
</tr>
<tr>
<td style="text-align:left">如何在当前文件里搜索光标所在位置的词</td>
<td style="text-align:left">*(#)</td>
</tr>
<tr>
<td style="text-align:left">如何在50行到100行之间查找并替换</td>
<td style="text-align:left">:50,100/old/new/g</td>
</tr>
<tr>
<td style="text-align:left">如果你想在同一文件中对比两个不同的块时怎么做</td>
<td style="text-align:left">:sp (to ‘split’ the view)</td>
</tr>
<tr>
<td style="text-align:left">如果你想要打开光标所在文件名的文件</td>
<td style="text-align:left">gf (which means ‘g’o to this ‘f’ile)</td>
</tr>
<tr>
<td style="text-align:left">如果你想要得到每行前10个字母而它后面的数据不是你想要的</td>
<td style="text-align:left">ctrl-v (win 下是ctrl-q)</td>
</tr>
<tr>
<td style="text-align:left">如果你想要转换别人给到你的混合大小的文件变成小写</td>
<td style="text-align:left">1GVG u</td>
</tr>
<tr>
<td style="text-align:left">录制一系列命令然后执行</td>
<td style="text-align:left">用宏</td>
</tr>
<tr>
<td style="text-align:left">在width:16px的数字16上加20</td>
<td style="text-align:left">20 ctrl+a</td>
</tr>
<tr>
<td style="text-align:left">输入23+45+119的结果</td>
<td style="text-align:left">ctrl+r=23+45+119</td>
</tr>
</tbody>
</table>
<p>以上的这些操作都是直接在键盘上操作的，没有用鼠标。</p>
<p>喜欢一个人的时候总能说出好多的理由，而不喜欢却只需要一个理由。此时我赞美我的女神你也在心里列举了你心中女神的诸多可爱美丽特点。所以可以想象各种关于编辑器文章下的各种互喷吐槽，即使是同一个编辑器的文章下也不免相互吐槽，毕竟不同人理念也是不一样的。</p>
<h3 id="有所为有所不为">有所为有所不为</h3><p>vim是个高效的文本编辑器，在文本编辑这一领域可谓是独步天下，高手<a href="http://zhuanlan.zhihu.com/vim-non-programming/19918627" target="_blank" rel="external">使用vim处理SRT字幕内容</a>，痴迷者除了使用vim写代码、<a href="http://www.vimer.cn?p=1222" target="_blank" rel="external">发邮件</a>、<a href="http://bluegene8210.is-programmer.com/posts/67910.html" target="_blank" rel="external">看股票</a>、写博客、写markdown(这篇文章就是vim写的markdown)还<a href="http://www.iplaysoft.com/vimium-and-vimperator.html" target="_blank" rel="external">使用vim浏览网页</a>，普通人可以把它作为<a href="http://blog.sina.com.cn/s/blog_45dac66f010005kw.html" target="_blank" rel="external">普通人的编辑利器</a>。在文本编辑领域，后来者只有模仿而无法超越vim。小李飞刀独步天下却也砍不了骨头，在代码编程领域，公认的最适合的场景是做Unix/Linux服务器编程,不用下载服务器端的文件而直接修改；其次是编写html/css/javascript/shell/python/c等；最后在mac、linux下要改文件用系统带的vim随手改改。而编写Java<br>EE、Objective-C等还是用Eclipse、XCode等IDE的比较好。</p>
<h3 id="君子性非异也，善假于物也">君子性非异也，善假于物也</h3><p>vim只是一个工具而已，它并不能让你码代码的能力提升，只能帮你更快速地输出你的思维。每一个工具都有它特定的场景，聪明的人总会在适当的场景做出合适的选择。好多人都说学习起来好难的呀，投入的成本换来的收益是不是成正比的呢？我觉得还是值得的，上面也说过，它是万变中的不变，同时它真的是个高效的工具，另外也许最后出来的高效的编辑外还带给你一些东西，比如好奇发现带来的惊喜，又如你发现你用了几年还有好多不会的谦虚，还有用宏解决了一个棘手问题的喜悦。最后它只是一个工具，是雕刻林诗音松木人像的小刀，或是冠绝武林的小李飞刀，关键在人。</p>
<h3 id="不积跬步无以至千里">不积跬步无以至千里</h3><p>佛渡有缘人，细想这个‘有缘人’还挺有意思的，其实就是信的人，不信的说再多也是没有用的。如果想学，不必卸载你的是编辑器，做出破釜沉舟之势，万一用了两天觉得不方便或是有紧急的要修改的内容，要换回来用熟悉的编辑器。另外也不要觉得一时学不会就感觉挫折，毕竟很多东西都不可一蹴而就的，需要一点积累，所以慢慢来的。那些《7天XX》《21精通XX》真的害了好多人，慢慢来，实在不行认为自己笨了，不还有勤能补拙吗？好多的编辑器都有vi插件或模式，你可以找一找然后装上试试的，等熟悉了觉得不满足了再换成vim，要是觉得一直用vi插件也不错的就一直用着，能解决问题的顺手的才是最高效的。</p>
<h3 id="选择你所喜欢的，爱你所选择的">选择你所喜欢的，爱你所选择的</h3><p>我在小学的时候搞了个小霸王说要学习五笔，然后字根没有背完就忘记了，大学时候再一个想起这个事决定再学五笔，然后没有几天又放弃了，毕业两年后想起学五笔这个事，心里有个结，于是又学起来了，然后一直在用，虽然是五笔混合模式，偶尔也用纯五笔模式。vim就是在我可以用五笔的时候开始学的，当时拿同事的vimrc来直接就用了，现在也在用的，只是改了少许的地方，一直在够用就好的状态，然后在用的时候觉得有什么不自然的地方就找一下答案的，慢慢地越来越顺手了。细想我这个慢方法还是可取的，那么多我的命令我只会我常用的十几个，但那也是够用的了，并且是越来越喜欢，看着别人用的也还常发现还有很多不会的东西。</p>
<p>再回首，一切是那样自然，一如vim的理念keep it simple，我也只装了平时常用的几个插件，还有一些比较强大的插件也没有用得着，所以没有装上。最近为了给同事们讲一下vim,才意识到虽然平时说vim有几个模式，但是用的时候自己也没有区分得很清楚，觉得就是一个整体，应该那样，有时候我们只是为了区分和认识一个东西才把它解构了，就像一首好的歌曲，我们只用觉得好听，那些乐评人说的为什么好感觉都很有道理。vim命令有多难记也还是有逻辑的；vim里可以快速精确的查找定位；vim真的好像一切文本皆对象，操作针对字符，词，行，块，文件这些对象；vim的设计哲学是如果你的工作只需要做一次，那没问题，怎么搞都行，如果你的工作是要重复地完成某些工作，则vim总可以帮你找到更少的按键方式来实现相同的目标。如<a href="http://vimgolf.com/" target="_blank" rel="external">VimGolf</a>所说Real Vim ninjas count every keystroke - do you?  </p>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="前言">前言</h2><blockquote>
<p>选择你所喜欢的，爱你所选择的–列夫·托尔斯泰</p>
</blockquote>
<h3 id="不是理由的理由">不是理由的理由</h3><p>用了几年Vim，我发现我越来越喜欢它了，和好多人一样喜欢它，也许]]>
    </summary>
    
      <category term="Vim" scheme="http://aotu.io/tags/Vim/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[PostCSS快速入门使用]]></title>
    <link href="http://aotu.io/notes/2015/10/13/start-postcss/"/>
    <id>http://aotu.io/notes/2015/10/13/start-postcss/</id>
    <published>2015-10-13T09:34:25.000Z</published>
    <updated>2015-12-10T02:02:53.000Z</updated>
    <content type="html"><![CDATA[<h2 id="初识PostCSS">初识PostCSS</h2><p>如果你第一次听说<code>PostCSS</code>这个东西，那么请看下面摘自官方<code>Github</code>的介绍：</p>
<blockquote>
<p>PostCSS is a tool for transforming CSS with JS Plugins. These plugins can support variables and mixins, transpile future CSS syntax, inline images, and more</p>
</blockquote>
<p>翻译成中文的意思如下：</p>
<blockquote>
<p>PostCSS 是一套利用JS插件实现的用来改变CSS的工具.这些插件能够支持变量和混合语法，转换未来CSS语法，内联图片，还有更多</p>
</blockquote>
<p>我们用过<code>Less</code>、<code>SASS</code>等工具来对CSS做<code>预处理</code>操作，按照它们约定的语法来书写并且最终转换成可用的样式，这付出的代价是<strong>必须先熟悉这个工具的书写语法</strong>。 </p>
<p>随着近几年 <a href="http://gruntjs.cn/" target="_blank" rel="external">Grunt</a>、<a href="http://gulpjs.com/" target="_blank" rel="external">Gulp</a>、<a href="http://webpack.github.io/docs/" target="_blank" rel="external">Webpack</a> 等自动化工具的兴起，<code>组合式应用</code>变得非常的热门，那<code>PostCSS</code>存在的意义是什么呢？答案是：<strong>CSS生态系统</strong></p>
<p><code>PostCSS</code>拥有非常多的插件，诸如自动为CSS添加浏览器前缀的插件<code>autoprefixer</code>、当前移动端最常用的<code>px</code>转<code>rem</code>插件<code>px2rem</code>，还有支持尚未成为CSS标准但特定可用的插件<code>cssnext</code>，还有很多很多。就连著名的<code>Bootstrap</code>在下一个版本<code>Bootstrap 5</code>也将使用<code>PostCSS</code>作为样式的基础。</p>
<p>一句话来概括PostCSS：<strong>CSS编译器能够做到的事情，它也可以做到，而且能够做得更好</strong></p>
<h2 id="快速使用PostCSS">快速使用PostCSS</h2><p>上面大致介绍了<code>PostCSS</code>，也许我们并没有在头脑里形成对它的认知，那下面我们就通过一个简单地实例来看看如何使用<code>PostCSS</code>。</p>
<p><code>PostCSS</code>得益于插件，支持Grunt,Gulp,webpack,Broccoli,Brunch还有ENB，这里我们将以<code>Gulp</code>作为实例来讲。</p>
<h3 id="环境准备">环境准备</h3><p>创建并进入我们的实例目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir postcss-demo &amp;&amp; <span class="built_in">cd</span> postcss-demo</span><br></pre></td></tr></table></figure>
<p>然后快速生成<code>package.json</code>文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># --yes 参数能够帮助我们快速生成默认的package.json</span></span><br><span class="line">npm init --yes</span><br></pre></td></tr></table></figure>
<p>将上面创建的<code>package.json</code>文件的<code>main</code>参数改为<code>gulpfile.js</code>，然后安装我们所需的依赖</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># gulp跟gulp-postcss是必须的，后面两个插件为了演示用途</span></span><br><span class="line">npm i gulp gulp-postcss autoprefixer autoprefixer-core cssnext --save-dev <span class="operator">-d</span></span><br></pre></td></tr></table></figure>
<p>创建<code>gulpfile.js</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这里用命令行进行创建，你也可以手动新建</span></span><br><span class="line">touch gulpfile.js</span><br></pre></td></tr></table></figure>
<h3 id="修改gulpfile-js">修改gulpfile.js</h3><p>将下面代码贴进<code>gulpfile.js</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">'gulp'</span>);</span><br><span class="line"><span class="keyword">var</span> postcss = <span class="built_in">require</span>(<span class="string">'gulp-postcss'</span>);</span><br><span class="line"><span class="keyword">var</span> autoprefixer = <span class="built_in">require</span>(<span class="string">'autoprefixer'</span>);</span><br><span class="line"><span class="keyword">var</span> cssnext = <span class="built_in">require</span>(<span class="string">'cssnext'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义css任务</span></span><br><span class="line">gulp.task(<span class="string">'css'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="comment">//定义postcss任务流数组</span></span><br><span class="line">  <span class="keyword">var</span> processors = [</span><br><span class="line">    autoprefixer(&#123;</span><br><span class="line">      browsers:[<span class="string">'last 3 version'</span>],</span><br><span class="line">      cascade: <span class="literal">false</span>,</span><br><span class="line">      remove: <span class="literal">false</span></span><br><span class="line">    &#125;),</span><br><span class="line">    cssnext()</span><br><span class="line">  ];</span><br><span class="line">  <span class="keyword">return</span> gulp.src(<span class="string">'./src/css/*.css'</span>)</span><br><span class="line">             .pipe(postcss(processors))</span><br><span class="line">             .pipe(gulp.dest(<span class="string">'./dist'</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="创建示例样式">创建示例样式</h3><p>在项目根目录下创建src目录，再在src目录下面创建css目录，然后创建style.css文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这里用命令创建，你也可以手动创建</span></span><br><span class="line">mkdir -p src/css &amp;&amp; touch style.css</span><br></pre></td></tr></table></figure>
<p>编辑样式如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">h1</span><span class="rules">&#123;</span><br><span class="line">  <span class="rule"><span class="attribute">display</span>:<span class="value">flex</span></span>;</span><br><span class="line">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="pseudo">:root</span> <span class="rules">&#123;</span><br><span class="line"><span class="rule"><span class="attribute">--fontSize</span>:<span class="value"> <span class="number">1rem</span></span></span>;</span><br><span class="line"><span class="rule"><span class="attribute">--mainColor</span>:<span class="value"> <span class="hexcolor">#12345678</span></span></span>;</span><br><span class="line"><span class="rule"><span class="attribute">--highlightColor</span>:<span class="value"> <span class="function">hwb</span>(<span class="number">190</span>, <span class="number">35%</span>, <span class="number">20%</span>)</span></span>;</span><br><span class="line">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">body</span> <span class="rules">&#123;</span><br><span class="line"><span class="rule"><span class="attribute">color</span>:<span class="value"> <span class="function">var</span>(--mainColor)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="rule"><span class="attribute">font-size</span>:<span class="value"> <span class="function">var</span>(--fontSize)</span></span>;</span><br><span class="line"><span class="rule"><span class="attribute">line-height</span>:<span class="value"> <span class="function">calc</span>(<span class="function">var</span>(--fontSize) * <span class="number">1.5</span>)</span></span>;</span><br><span class="line"><span class="rule"><span class="attribute">padding</span>:<span class="value"> <span class="function">calc</span>((<span class="function">var</span>(--fontSize) / <span class="number">2</span>) + <span class="number">1px</span>)</span></span>;</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="运行实例">运行实例</h3><p>一切准备就绪之后可以在项目根目录下执行刚才我们定义的任务</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gulp css</span><br></pre></td></tr></table></figure>
<p>如果不出什么意外的话就会在根目录下面生成一个<code>dist</code>文件夹，里面有一个样式文件，内容如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">body</span><span class="rules">&#123;</span><br><span class="line">  <span class="rule"><span class="attribute">display</span>:<span class="value">-webkit-flex</span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">display</span>:<span class="value">-ms-flexbox</span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">display</span>:<span class="value">-webkit-box</span></span>;</span><br><span class="line">  <span class="rule"><span class="attribute">display</span>:<span class="value">flex</span></span>;</span><br><span class="line">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">body</span> <span class="rules">&#123;</span><br><span class="line"><span class="rule"><span class="attribute">color</span>:<span class="value"><span class="hexcolor">#123456</span></span></span>;</span><br><span class="line"><span class="rule"><span class="attribute">color</span>:<span class="value"><span class="function">rgba</span>(<span class="number">18</span>, <span class="number">52</span>, <span class="number">86</span>, <span class="number">0.47059</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="rule"><span class="attribute">font-size</span>:<span class="value"><span class="number">16px</span></span></span>;</span><br><span class="line"><span class="rule"><span class="attribute">font-size</span>:<span class="value"><span class="number">1rem</span></span></span>;</span><br><span class="line"><span class="rule"><span class="attribute">line-height</span>:<span class="value"><span class="number">24px</span></span></span>;</span><br><span class="line"><span class="rule"><span class="attribute">line-height</span>:<span class="value"><span class="number">1.5rem</span></span></span>;</span><br><span class="line"><span class="rule"><span class="attribute">padding</span>:<span class="value"><span class="function">calc</span>(<span class="number">0.5rem</span> + <span class="number">1px</span>)</span></span>;</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<p>我们可以看到我们写的样式自动添加了浏览器前缀，并且一些未来CSS语法也被转换了。</p>
<h2 id="了解PostCSS">了解PostCSS</h2><p>通过上面的实例我们应该知道<code>PostCSS</code>的使用方法，此时让我们先回想一下<code>CSS预处理器</code>的使用历程：</p>
<ol>
<li>学习该CSS预处理器的语法特性，诸如：变量定义、嵌套、继承</li>
<li>在特定后缀名(.less/.scss等)的文件按照上面的语法进行编写</li>
<li>通过Gulp/Grunt/Webpack等自动化工具或者手动编译成CSS样式</li>
</ol>
<p>而<code>PostCSS</code>的使用历程：</p>
<ol>
<li>直接按照CSS标准语法来书写CSS样式文件</li>
<li>通过Gulp/Grunt/Webpack等自动化工具加载PostCSS插件转换输出</li>
</ol>
<p>通过对比我们类比一个结论：<em>CSS预处理器好比给你一个工具箱，工具箱里面有什么东西该怎么拿已经跟你约定好，你必须按照这个规则来拿；而PostCSS好比给你一个盒子，你可以从旁边选择自己需要的工具放进盒子打包拿走，如果还不够用你可以自己造一个工具</em></p>
<h2 id="深入PostCSS">深入PostCSS</h2><p><code>PostCSS</code>自身只包括了<code>CSS分析器</code>，<code>CSS节点树API</code>，<code>source map生成器</code>，<code>CSS节点拼接器</code>，而基于<code>PostCSS</code>的插件都是使用了<code>CSS节点树API</code>来实现的。</p>
<p>我们都知道CSS的组成如下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">element &#123;</span><br><span class="line">  prop1 : rule1 rule2 ...;</span><br><span class="line">  prop2 : rule1 rule2 ...;</span><br><span class="line">  prop2 : rule1 rule2 ...;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>也就是一条一条的样式规则组成，每一条样式规则包含一个或多个属性跟值。所以<code>PostCSS</code>的执行过程大致如下：</p>
<ol>
<li><p>Parser<br> 利用<code>CSS分析器</code>读取CSS字符内容，得到一个完整的<code>节点树</code></p>
</li>
<li><p>Plugin<br> 对上面拿到的<code>节点树</code>利用<code>CSS节点树API</code>进行一系列的转换操作</p>
</li>
<li><p>Plugin<br> 利用<code>CSS节点拼接器</code>将上面转换之后的节点树重新组成CSS字符</p>
</li>
<li><p>Stringifier<br> 在上面转换期间可利用<code>source map生成器</code>表明转换前后字符的对应关系</p>
</li>
</ol>
<h3 id="PostCSS性能">PostCSS性能</h3><p>在PostCSS官方推特上看到，由JavaScript编写的PostCSS比C++编写的libsass还要快3倍，下面来自官方推特的截图:</p>
<p class="user_img"><img title="PostCSS性能对比图" class="test_img" src="/img/post/cnt1992/postcss.png" alt="PostCSS性能对比图"></p>
<p>如果你对上面的性能截图有疑问，可以亲自来<a href="https://github.com/postcss/benchmark" target="_blank" rel="external">这里</a>测试看看。</p>
<h3 id="开始编写自己的PostCSS插件">开始编写自己的PostCSS插件</h3><p><code>PostCSS</code>在自己的<a href="https://github.com/postcss/postcss#plugins" target="_blank" rel="external">Github</a>上放了一些常用的插件，更多的插件可以在<a href="http://postcss.parts/" target="_blank" rel="external">postcss.parts</a>进行搜索。</p>
<p>但有时候已有的插件不满足我们的需求，这个时候需要编写自己的PostCSS插件，下面我们将一步步创建一个简单的插件，这个插件功能非常简单，如下：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span><br><span class="line">  文件位置：src/css/style.css</span><br><span class="line"> */</span></span><br><span class="line"><span class="tag">h1</span> <span class="rules">&#123;</span><br><span class="line">  <span class="rule"><span class="attribute">font-family</span>:<span class="value"> <span class="string">"\5FAE\8F6F\96C5\9ED1"</span>,<span class="function">fontstack</span>(<span class="string">'Arial'</span>)</span></span>;</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<p>当输入上面的样式时，会生成下面的样式：</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span><br><span class="line">  文件位置：dist/style.css</span><br><span class="line"> */</span></span><br><span class="line"><span class="tag">h1</span> <span class="rules">&#123;</span><br><span class="line">  <span class="rule"><span class="attribute">font-family</span>:<span class="value"> <span class="string">"\5FAE\8F6F\96C5\9ED1"</span>,tahoma,arial</span></span>;</span><br><span class="line">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="环境准备-1">环境准备</h3><p>我们将以<code>Gulp</code>作为基础来实现我们的插件，首先创建项目文件夹</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir postcss-plugin &amp;&amp; <span class="built_in">cd</span> postcss-plugin</span><br></pre></td></tr></table></figure>
<p>然后快速创建<code>package.json</code>文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init --yes</span><br></pre></td></tr></table></figure>
<p>紧接着先安装必备的包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i gulp postcss gulp-postcss --save-dev <span class="operator">-d</span></span><br></pre></td></tr></table></figure>
<p>再创建<code>gulpfile.js</code>并且输入下面内容:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">'gulp'</span>);</span><br><span class="line"><span class="keyword">var</span> postcss = <span class="built_in">require</span>(<span class="string">'gulp-postcss'</span>);</span><br><span class="line"></span><br><span class="line">gulp.task(<span class="string">'css'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> processors = [</span><br><span class="line">  ];</span><br><span class="line">  <span class="keyword">return</span> gulp.src(<span class="string">'./src/css/*.css'</span>)</span><br><span class="line">             .pipe(postcss(processors))</span><br><span class="line">             .pipe(gulp.dest(<span class="string">'./dist'</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="创建插件文件夹">创建插件文件夹</h3><p>我们在执行<code>npm install</code>安装的包都放置在<code>node_modules</code>文件夹下面，这里我们创建PostCSS的插件文件夹，注意：<strong>PostCSS的插件命名格式为：postcss-插件名字</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这里采用命令新建文件夹，你也可以手动创建</span></span><br><span class="line">mkdir node_modules/postcss-fontstack</span><br></pre></td></tr></table></figure>
<h3 id="创建插件入口文件">创建插件入口文件</h3><p>现在我们可以在<code>postcss-fontstack</code>文件夹创建入口文件<code>index.js</code>，<code>PostCSS</code>创建插件的方式如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> postcss = <span class="built_in">require</span>(<span class="string">'postcss'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = postcss.plugin(<span class="string">'插件名字'</span>, <span class="function"><span class="keyword">function</span> 插件名字(<span class="params">选项</span>)</span>&#123;</span><br><span class="line">  <span class="comment">//这里写插件代码</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>那我们可以在<code>index.js</code>里面贴入下面代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> postcss = <span class="built_in">require</span>(<span class="string">'postcss'</span>);</span><br><span class="line"></span><br><span class="line">modules.exports = postcss.plugin(<span class="string">'fontstack'</span>, <span class="function"><span class="keyword">function</span> <span class="title">fontstack</span>(<span class="params"> options </span>)</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"> css </span>)</span>&#123;</span><br><span class="line">    options = options || &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> fontstack_config = &#123;</span><br><span class="line">      <span class="string">'Arial'</span>: <span class="string">'tahoma,arial'</span>,</span><br><span class="line">      <span class="string">'Times New Roman'</span>: <span class="string">'TimesNewRoman, "Times New Roman", Times, Baskerville, Georgia, serif'</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">toTitleCase</span>(<span class="params"> str </span>)</span>&#123;</span><br><span class="line">      <span class="keyword">return</span> str.replace(<span class="regexp">/\w\S*/g</span>,<span class="function"><span class="keyword">function</span>(<span class="params"> txt </span>)</span>&#123;</span><br><span class="line">          <span class="keyword">return</span> txt.charAt(<span class="number">0</span>).toUpperCase() + txt.substr(<span class="number">1</span>).toLowerCase();</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// css.walkRules方法用来遍历每一条css规则</span></span><br><span class="line">    css.walkRules( <span class="function"><span class="keyword">function</span>(<span class="params"> rule </span>)</span>&#123;</span><br><span class="line">        <span class="comment">// walkDecls方法用来解析属性跟值</span></span><br><span class="line">        rule.walkDecls( <span class="function"><span class="keyword">function</span>(<span class="params"> decl, i </span>)</span>&#123;</span><br><span class="line">            <span class="keyword">var</span> value = decl.value;</span><br><span class="line">            <span class="keyword">if</span>( value.indexOf( <span class="string">'fontstack('</span> ) !== -<span class="number">1</span> )&#123;</span><br><span class="line">                <span class="keyword">var</span> fontstack_requested = value.match(<span class="regexp">/\(([^)]+)\)/</span>)[<span class="number">1</span>].replace(<span class="regexp">/["']/g</span>,<span class="string">""</span>);</span><br><span class="line">                fontstack_requested = toTitleCase( fontstack_requested );</span><br><span class="line"></span><br><span class="line">                <span class="keyword">var</span> fontstack = fontstack_config[ fontstack_requested ];</span><br><span class="line"></span><br><span class="line">                <span class="keyword">var</span> firstFont = value.substr( <span class="number">0</span>, value.indexOf(<span class="string">'fontstack('</span>) );</span><br><span class="line"></span><br><span class="line">                <span class="keyword">var</span> newValue = firstFont + fontstack;</span><br><span class="line"></span><br><span class="line">                decl.value = newValue;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>在<code>gulpfile.js</code>引入上面的插件，代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">'gulp'</span>);</span><br><span class="line"><span class="keyword">var</span> postcss = <span class="built_in">require</span>(<span class="string">'gulp-postcss'</span>);</span><br><span class="line"></span><br><span class="line">gulp.task(<span class="string">'css'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> processors = [</span><br><span class="line">  ];</span><br><span class="line">  <span class="keyword">return</span> gulp.src(<span class="string">'./src/css/*.css'</span>)</span><br><span class="line">             .pipe(postcss(processors))</span><br><span class="line">             .pipe(gulp.dest(<span class="string">'./dist'</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="运行实例-1">运行实例</h3><p>在项目根目录下运行实例，最终实现我们的效果</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gulp css</span><br></pre></td></tr></table></figure>
<h2 id="再谈PostCSS">再谈PostCSS</h2><p>基于<code>PostCSS</code>能够做到很多<code>CSS预处理器</code>做不到的事情，未来发展前景还是挺不错的，而且最新的<code>Atom</code>编辑器也可以下载插件来支持<code>PostCSS</code>这种语法。</p>
<p>但这就意味着<code>CSS预处理器</code>过时了么？不会。<code>PostCSS</code>的出现并不是为了替换掉之前的技术，只是提供多一种思路让我们去考虑，就比如Sass编译后再加<code>autoprefixer</code>自动补齐浏览器前缀这种做法当前还是比较流行的。</p>
<p>再回到文章最开始说的，<code>PostCSS</code>其实是在打造一个改变CSS开发方式的生态系统。也许暂时我们还是保持传统的开发方式，但未来对于<code>PostCSS</code>我还是保持关注，它是值得期待的。</p>
]]></content>
    <summary type="html">
    <![CDATA[<h2 id="初识PostCSS">初识PostCSS</h2><p>如果你第一次听说<code>PostCSS</code>这个东西，那么请看下面摘自官方<code>Github</code>的介绍：</p>
<blockquote>
<p>PostCSS is a tool]]>
    </summary>
    
      <category term="PostCSS" scheme="http://aotu.io/tags/PostCSS/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[凹凸实验室博客V1.0.0发布]]></title>
    <link href="http://aotu.io/notes/2015/10/08/aotu-blog-v1/"/>
    <id>http://aotu.io/notes/2015/10/08/aotu-blog-v1/</id>
    <published>2015-10-08T00:24:35.000Z</published>
    <updated>2015-12-10T02:02:53.000Z</updated>
    <content type="html"><![CDATA[<p>筹备了两周多，凹凸实验室博客 V1.0.0 正式发布啦，欢迎同学们体验并提供建议。<br>它是一个托管于Github的静态博客，基于HEXO搭建，主题的定做参考自<a href="http://html5up.net/future-imperfect" target="_blank" rel="external">future-imperfect</a>的扁平简约，暂且命名为<code>o2</code>。主题单独开源于 <a href="o2team/hexo-theme-o2">hexo-theme-o2</a>，有兴趣的朋友可以自由下载使用。</p>
<a id="more"></a>
<h2 id="博客的一些特性">博客的一些特性</h2><ol>
<li><p>使用github头像</p>
<p>记得将你们在github的头像更新到最帅，将你github的用户名在文章内头部填好即可！</p>
</li>
<li><p><a href="https://npmjs.org/package/hexo-wordcount" target="_blank" rel="external">hexo-wordcount</a> 显示博文字数</p>
</li>
<li><a href="http://ibruce.info/2015/04/04/busuanzi/" target="_blank" rel="external">不蒜子</a> 统计博文的pv</li>
<li>每日一句英文警句</li>
<li><a href="http://duoshuo.com" target="_blank" rel="external">多说</a>评论</li>
</ol>
<h2 id="使用指引">使用指引</h2><ol>
<li><p>安装hexo</p>
 <figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i hexo-<span class="keyword">cli</span> -<span class="keyword">g</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>将o2team.github.io的源码拉到本地</p>
 <figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone git@github<span class="class">.com</span>:o2team/o2team<span class="class">.github</span><span class="class">.io</span><span class="class">.git</span> o2team</span><br></pre></td></tr></table></figure>
</li>
<li><p>初始化子模块(submodules)</p>
 <figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> o2team</span><br><span class="line">git submodule init</span><br><span class="line">git submodule <span class="keyword">update</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 切换至themes/o2目录，签出master分支</span></span><br><span class="line"><span class="keyword">cd</span> ../themes/o2</span><br><span class="line">git checkout master</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装nodejs包</p>
 <figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 切换回根目录下</span></span><br><span class="line">cd ..<span class="regexp">/../</span></span><br><span class="line"><span class="built_in">npm</span> install</span><br></pre></td></tr></table></figure>
</li>
<li><p>运行<code>hexo s --watch</code></p>
<p> 运行上述命令后，浏览器打开 <a href="http://localhost:4000" target="_blank" rel="external">http://localhost:4000</a> 即可本地访问我们的网站</p>
</li>
</ol>
<h2 id="创建文章">创建文章</h2><p>有两种方法创建文章，可任选其一：</p>
<blockquote>
<p>注意：文件名不要出现中文!!!</p>
</blockquote>
<ol>
<li><p>使用<code>hexo new</code> 命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>拷贝现有的文章进行修改</p>
<p>hexo使用markdown来编辑文章，在source目录下，拷贝任意md文件进行创建新的文章。具体可参考下hexo的官方说明</p>
</li>
</ol>
<h2 id="文章规范">文章规范</h2><ol>
<li>使用markdown写博文 </li>
<li><p>博文图片统一位置：<code>source/img/post/</code><br> 在博客内容中可以使用 <code>pimg</code> 自定义标签来引用图片。注意别覆盖了别人的图片!!!<br> 其语法格式为：<br> <code>{% pimg imageName [alt text] [JSONImageAttibutes] %}</code><br> 例如：<br> <code>{% pimg post-aotu.jpg "空格请用%20来区分" "{"title":"hello","class":"test_img"}" %}</code><br> 需要注意的是：<code>pimg</code> 利用空格来划分字段属性，如果一个属性的值需要空格，请将空格用<code>%20</code>代替!!!    </p>
</li>
<li><p>为了保证博客整体美观，每个文章需要一张配图(大小：840x340)</p>
</li>
<li><p>指明文章的副标题、作者信息、封面图片地址</p>
 <figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">subtitle</span>: <span class="string">"凹凸实验室博客是一个托管于Github的静态博客，基于HEXO搭建..."</span></span><br><span class="line"><span class="attribute">date</span>: <span class="number">2015</span>-<span class="number">11</span>-<span class="number">20</span> <span class="number">00</span>:<span class="number">24</span>:<span class="number">35</span></span><br><span class="line"><span class="attribute">cover</span>: <span class="string">"封面图片地址"</span></span><br><span class="line"><span class="attribute">tags</span>:</span><br><span class="line">- Hexo</span><br><span class="line"><span class="attribute">author</span>:</span><br><span class="line">    <span class="attribute">nick</span>: LV主唱大人</span><br><span class="line">    <span class="attribute">github_name</span>: mamboer</span><br></pre></td></tr></table></figure>
</li>
<li><p>利用<code>&lt;!-- more --&gt;</code>设置文章的摘要</p>
<p> 示例：</p>
 <figure class="highlight django"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="xml">title: 文章标题</span><br><span class="line">---</span><br><span class="line">这部分是文章摘要，这部分是文章摘要。在hexo模版里可通过 </span><span class="template_tag">&#123;% raw %&#125;</span><span class="xml"></span><span class="variable">&#123;&#123; post.excerpt &#125;&#125;</span><span class="xml"></span><span class="template_tag">&#123;% endraw %&#125;</span><span class="xml"> 来引用。</span><br><span class="line"><span class="comment">&lt;!-- more --&gt;</span> </span><br><span class="line">这里是文章的剩余部分。在hexo模版里可通过</span><span class="template_tag">&#123;% raw %&#125;</span><span class="xml"></span><span class="variable">&#123;&#123; post.more &#125;&#125;</span><span class="xml"></span><span class="template_tag">&#123;% endraw %&#125;</span><span class="xml"> 来引用。</span></span><br></pre></td></tr></table></figure>
<p> 实际使用请参考<a href="!--￼9--">本文</a>。</p>
</li>
</ol>
<h2 id="关于博客的发布">关于博客的发布</h2><p>为了便于统一维护，博客的发布由<code>LV</code>负责。同学们写好博文并在本地预览OK后直接提交Github即可。  </p>
]]></content>
    <summary type="html">
    <![CDATA[<p>筹备了两周多，凹凸实验室博客 V1.0.0 正式发布啦，欢迎同学们体验并提供建议。<br>它是一个托管于Github的静态博客，基于HEXO搭建，主题的定做参考自<a href="http://html5up.net/future-imperfect">future-imperfect</a>的扁平简约，暂且命名为<code>o2</code>。主题单独开源于 <a href="o2team/hexo-theme-o2">hexo-theme-o2</a>，有兴趣的朋友可以自由下载使用。</p>]]>
    
    </summary>
    
      <category term="Hexo" scheme="http://aotu.io/tags/Hexo/"/>
    
  </entry>
  
</feed>
